const MidiFurAlles=(()=>{const t=(()=>{const e={};return{once:(r,n)=>{e[r]||(e[r]=[]),e[r].unshift(()=>{n(),t.off(r,n)})},on:(t,r)=>{e[t]||(e[t]=[]),e[t].unshift(r)},off:(t,r)=>{if(!e[t])return;let n=e[t].indexOf(r);e[t].splice(n,1)},emit:(t,r)=>{if(!e[t])return;let n={type:t,detail:r,isCanceled:!1,cancelBubble:()=>{this.isCanceled=!0}},o=e[t].length;for(;o--;){if(n.isCanceled)return;e[t][o](n)}return n.detail}}})(),e=function(){let t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(e){var r,n=void 0!==(e=e||{})?e:{},o={};for(r in n)n.hasOwnProperty(r)&&(o[r]=n[r]);var i,a,s=[],u=!0,l=!1,c="";(u||l)&&(l?c=self.location.href:document.currentScript&&(c=document.currentScript.src),t&&(c=t),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"",i=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},l&&(a=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),function(t,e,r){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?e(n.response):r()},n.onerror=r,n.send(null)});var d=n.print||console.log.bind(console),f=n.printErr||console.warn.bind(console);for(r in o)o.hasOwnProperty(r)&&(n[r]=o[r]);o=null,n.arguments&&(s=n.arguments),n.thisProgram&&n.thisProgram,n.quit&&n.quit;var _,p,h={"f64-rem":function(t,e){return t%e},debugger:function(){}};new Array(0);n.wasmBinary&&(_=n.wasmBinary),n.noExitRuntime&&n.noExitRuntime,"object"!=typeof WebAssembly&&f("no native wasm support detected");var m=!1;var g="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(t,e,r){for(var n=e+r,o=e;t[o]&&!(o>=n);)++o;if(o-e>16&&t.subarray&&g)return g.decode(t.subarray(e,o));for(var i="";e<o;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var u=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&t[e++])<65536)i+=String.fromCharCode(a);else{var l=a-65536;i+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else i+=String.fromCharCode((31&a)<<6|s)}else i+=String.fromCharCode(a)}return i}function v(t,e){return t?w(D,t,e):""}function y(t,e,r,n){if(!(n>0))return 0;for(var o=r,i=r+n-1,a=0;a<t.length;++a){var s=t.charCodeAt(a);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&t.charCodeAt(++a);if(s<=127){if(r>=i)break;e[r++]=s}else if(s<=2047){if(r+1>=i)break;e[r++]=192|s>>6,e[r++]=128|63&s}else if(s<=65535){if(r+2>=i)break;e[r++]=224|s>>12,e[r++]=128|s>>6&63,e[r++]=128|63&s}else{if(r+3>=i)break;e[r++]=240|s>>18,e[r++]=128|s>>12&63,e[r++]=128|s>>6&63,e[r++]=128|63&s}}return e[r]=0,r-o}function E(t){for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&t.charCodeAt(++r)),n<=127?++e:e+=n<=2047?2:n<=65535?3:4}return e}var b,k,D,T,S;"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");function P(t,e){return t%e>0&&(t+=e-t%e),t}function F(t){b=t,n.HEAP8=k=new Int8Array(t),n.HEAP16=T=new Int16Array(t),n.HEAP32=S=new Int32Array(t),n.HEAPU8=D=new Uint8Array(t),n.HEAPU16=new Uint16Array(t),n.HEAPU32=new Uint32Array(t),n.HEAPF32=new Float32Array(t),n.HEAPF64=new Float64Array(t)}var A=10848,x=n.TOTAL_MEMORY||16777216;function M(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var r=e.func;"number"==typeof r?void 0===e.arg?n.dynCall_v(r):n.dynCall_vi(r,e.arg):r(void 0===e.arg?null:e.arg)}else e()}}(p=n.wasmMemory?n.wasmMemory:new WebAssembly.Memory({initial:x/65536}))&&(b=p.buffer),x=b.byteLength,F(b),S[A>>2]=5253760;var B=[],R=[],C=[],O=[];var I=Math.abs,z=Math.ceil,N=Math.floor,L=Math.min,H=0,U=null,j=null;function q(t){H++,n.monitorRunDependencies&&n.monitorRunDependencies(H)}function W(t){if(H--,n.monitorRunDependencies&&n.monitorRunDependencies(H),0==H&&(null!==U&&(clearInterval(U),U=null),j)){var e=j;j=null,e()}}n.preloadedImages={},n.preloadedAudios={};var G="data:application/octet-stream;base64,";function X(t){return String.prototype.startsWith?t.startsWith(G):0===t.indexOf(G)}var V,K,$,Y="libmfa.wasm";function Z(){try{if(_)return new Uint8Array(_);if(a)return a(Y);throw"both async and sync fetching of the wasm failed"}catch(t){ht(t)}}function J(t){var e={env:t,wasi_unstable:t,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:h};function r(t,e){var r=t.exports;n.asm=r,W()}function o(t){r(t.instance)}function i(t){return(_||!u&&!l||"function"!=typeof fetch?new Promise((function(t,e){t(Z())})):fetch(Y,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+Y+"'";return t.arrayBuffer()})).catch((function(){return Z()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(t){f("failed to asynchronously prepare wasm: "+t),ht(t)}))}if(q(),n.instantiateWasm)try{return n.instantiateWasm(e,r)}catch(t){return f("Module.instantiateWasm callback failed with error: "+t),!1}return function(){if(_||"function"!=typeof WebAssembly.instantiateStreaming||X(Y)||"function"!=typeof fetch)return i(o);fetch(Y,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(o,(function(t){f("wasm streaming compile failed: "+t),f("falling back to ArrayBuffer instantiation"),i(o)}))}))}(),{}}function Q(){var t=function(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}();return n.extraStackTrace&&(t+="\n"+n.extraStackTrace()),t.replace(/\b__Z[\w\d_]+/g,(function(t){return t==t?t:t+" ["+t+"]"}))}X(Y)||(V=Y,Y=n.locateFile?n.locateFile(V,c):c+V),n.asm=function(t,e,r){return e.memory=p,e.table=new WebAssembly.Table({initial:26,maximum:26,element:"anyfunc"}),e.__memory_base=1024,e.__table_base=0,J(e)};var tt={splitPath:function(t){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1)},normalizeArray:function(t,e){for(var r=0,n=t.length-1;n>=0;n--){var o=t[n];"."===o?t.splice(n,1):".."===o?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r;r--)t.unshift("..");return t},normalize:function(t){var e="/"===t.charAt(0),r="/"===t.substr(-1);return(t=tt.normalizeArray(t.split("/").filter((function(t){return!!t})),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t},dirname:function(t){var e=tt.splitPath(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(t){if("/"===t)return"/";var e=t.lastIndexOf("/");return-1===e?t:t.substr(e+1)},extname:function(t){return tt.splitPath(t)[3]},join:function(){var t=Array.prototype.slice.call(arguments,0);return tt.normalize(t.join("/"))},join2:function(t,e){return tt.normalize(t+"/"+e)}};function et(t){return n.___errno_location&&(S[n.___errno_location()>>2]=t),t}var rt={resolve:function(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var n=r>=0?arguments[r]:it.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,e="/"===n.charAt(0)}return(e?"/":"")+(t=tt.normalizeArray(t.split("/").filter((function(t){return!!t})),!e).join("/"))||"."},relative:function(t,e){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=rt.resolve(t).substr(1),e=rt.resolve(e).substr(1);for(var n=r(t.split("/")),o=r(e.split("/")),i=Math.min(n.length,o.length),a=i,s=0;s<i;s++)if(n[s]!==o[s]){a=s;break}var u=[];for(s=a;s<n.length;s++)u.push("..");return(u=u.concat(o.slice(a))).join("/")}},nt={ttys:[],init:function(){},shutdown:function(){},register:function(t,e){nt.ttys[t]={input:[],output:[],ops:e},it.registerDevice(t,nt.stream_ops)},stream_ops:{open:function(t){var e=nt.ttys[t.node.rdev];if(!e)throw new it.ErrnoError(19);t.tty=e,t.seekable=!1},close:function(t){t.tty.ops.flush(t.tty)},flush:function(t){t.tty.ops.flush(t.tty)},read:function(t,e,r,n,o){if(!t.tty||!t.tty.ops.get_char)throw new it.ErrnoError(6);for(var i=0,a=0;a<n;a++){var s;try{s=t.tty.ops.get_char(t.tty)}catch(t){throw new it.ErrnoError(5)}if(void 0===s&&0===i)throw new it.ErrnoError(11);if(null==s)break;i++,e[r+a]=s}return i&&(t.node.timestamp=Date.now()),i},write:function(t,e,r,n,o){if(!t.tty||!t.tty.ops.put_char)throw new it.ErrnoError(6);try{for(var i=0;i<n;i++)t.tty.ops.put_char(t.tty,e[r+i])}catch(t){throw new it.ErrnoError(5)}return n&&(t.node.timestamp=Date.now()),i}},default_tty_ops:{get_char:function(t){if(!t.input.length){var e=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(e=window.prompt("Input: "))&&(e+="\n"):"function"==typeof readline&&null!==(e=readline())&&(e+="\n"),!e)return null;t.input=lt(e,!0)}return t.input.shift()},put_char:function(t,e){null===e||10===e?(d(w(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(d(w(t.output,0)),t.output=[])}},default_tty1_ops:{put_char:function(t,e){null===e||10===e?(f(w(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(f(w(t.output,0)),t.output=[])}}},ot={ops_table:null,mount:function(t){return ot.createNode(null,"/",16895,0)},createNode:function(t,e,r,n){if(it.isBlkdev(r)||it.isFIFO(r))throw new it.ErrnoError(1);ot.ops_table||(ot.ops_table={dir:{node:{getattr:ot.node_ops.getattr,setattr:ot.node_ops.setattr,lookup:ot.node_ops.lookup,mknod:ot.node_ops.mknod,rename:ot.node_ops.rename,unlink:ot.node_ops.unlink,rmdir:ot.node_ops.rmdir,readdir:ot.node_ops.readdir,symlink:ot.node_ops.symlink},stream:{llseek:ot.stream_ops.llseek}},file:{node:{getattr:ot.node_ops.getattr,setattr:ot.node_ops.setattr},stream:{llseek:ot.stream_ops.llseek,read:ot.stream_ops.read,write:ot.stream_ops.write,allocate:ot.stream_ops.allocate,mmap:ot.stream_ops.mmap,msync:ot.stream_ops.msync}},link:{node:{getattr:ot.node_ops.getattr,setattr:ot.node_ops.setattr,readlink:ot.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ot.node_ops.getattr,setattr:ot.node_ops.setattr},stream:it.chrdev_stream_ops}});var o=it.createNode(t,e,r,n);return it.isDir(o.mode)?(o.node_ops=ot.ops_table.dir.node,o.stream_ops=ot.ops_table.dir.stream,o.contents={}):it.isFile(o.mode)?(o.node_ops=ot.ops_table.file.node,o.stream_ops=ot.ops_table.file.stream,o.usedBytes=0,o.contents=null):it.isLink(o.mode)?(o.node_ops=ot.ops_table.link.node,o.stream_ops=ot.ops_table.link.stream):it.isChrdev(o.mode)&&(o.node_ops=ot.ops_table.chrdev.node,o.stream_ops=ot.ops_table.chrdev.stream),o.timestamp=Date.now(),t&&(t.contents[e]=o),o},getFileDataAsRegularArray:function(t){if(t.contents&&t.contents.subarray){for(var e=[],r=0;r<t.usedBytes;++r)e.push(t.contents[r]);return e}return t.contents},getFileDataAsTypedArray:function(t){return t.contents?t.contents.subarray?t.contents.subarray(0,t.usedBytes):new Uint8Array(t.contents):new Uint8Array},expandFileStorage:function(t,e){var r=t.contents?t.contents.length:0;if(!(r>=e)){e=Math.max(e,r*(r<1048576?2:1.125)|0),0!=r&&(e=Math.max(e,256));var n=t.contents;t.contents=new Uint8Array(e),t.usedBytes>0&&t.contents.set(n.subarray(0,t.usedBytes),0)}},resizeFileStorage:function(t,e){if(t.usedBytes!=e){if(0==e)return t.contents=null,void(t.usedBytes=0);if(!t.contents||t.contents.subarray){var r=t.contents;return t.contents=new Uint8Array(new ArrayBuffer(e)),r&&t.contents.set(r.subarray(0,Math.min(e,t.usedBytes))),void(t.usedBytes=e)}if(t.contents||(t.contents=[]),t.contents.length>e)t.contents.length=e;else for(;t.contents.length<e;)t.contents.push(0);t.usedBytes=e}},node_ops:{getattr:function(t){var e={};return e.dev=it.isChrdev(t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,it.isDir(t.mode)?e.size=4096:it.isFile(t.mode)?e.size=t.usedBytes:it.isLink(t.mode)?e.size=t.link.length:e.size=0,e.atime=new Date(t.timestamp),e.mtime=new Date(t.timestamp),e.ctime=new Date(t.timestamp),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},setattr:function(t,e){void 0!==e.mode&&(t.mode=e.mode),void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.size&&ot.resizeFileStorage(t,e.size)},lookup:function(t,e){throw it.genericErrors[2]},mknod:function(t,e,r,n){return ot.createNode(t,e,r,n)},rename:function(t,e,r){if(it.isDir(t.mode)){var n;try{n=it.lookupNode(e,r)}catch(t){}if(n)for(var o in n.contents)throw new it.ErrnoError(39)}delete t.parent.contents[t.name],t.name=r,e.contents[r]=t,t.parent=e},unlink:function(t,e){delete t.contents[e]},rmdir:function(t,e){var r=it.lookupNode(t,e);for(var n in r.contents)throw new it.ErrnoError(39);delete t.contents[e]},readdir:function(t){var e=[".",".."];for(var r in t.contents)t.contents.hasOwnProperty(r)&&e.push(r);return e},symlink:function(t,e,r){var n=ot.createNode(t,e,41471,0);return n.link=r,n},readlink:function(t){if(!it.isLink(t.mode))throw new it.ErrnoError(22);return t.link}},stream_ops:{read:function(t,e,r,n,o){var i=t.node.contents;if(o>=t.node.usedBytes)return 0;var a=Math.min(t.node.usedBytes-o,n);if(a>8&&i.subarray)e.set(i.subarray(o,o+a),r);else for(var s=0;s<a;s++)e[r+s]=i[o+s];return a},write:function(t,e,r,n,o,i){if(!1,!n)return 0;var a=t.node;if(a.timestamp=Date.now(),e.subarray&&(!a.contents||a.contents.subarray)){if(0===a.usedBytes&&0===o)return a.contents=new Uint8Array(e.subarray(r,r+n)),a.usedBytes=n,n;if(o+n<=a.usedBytes)return a.contents.set(e.subarray(r,r+n),o),n}if(ot.expandFileStorage(a,o+n),a.contents.subarray&&e.subarray)a.contents.set(e.subarray(r,r+n),o);else for(var s=0;s<n;s++)a.contents[o+s]=e[r+s];return a.usedBytes=Math.max(a.usedBytes,o+n),n},llseek:function(t,e,r){var n=e;if(1===r?n+=t.position:2===r&&it.isFile(t.node.mode)&&(n+=t.node.usedBytes),n<0)throw new it.ErrnoError(22);return n},allocate:function(t,e,r){ot.expandFileStorage(t.node,e+r),t.node.usedBytes=Math.max(t.node.usedBytes,e+r)},mmap:function(t,e,r,n,o,i,a){if(!it.isFile(t.node.mode))throw new it.ErrnoError(19);var s,u,l=t.node.contents;if(2&a||l.buffer!==e&&l.buffer!==e.buffer){(o>0||o+n<t.node.usedBytes)&&(l=l.subarray?l.subarray(o,o+n):Array.prototype.slice.call(l,o,o+n)),u=!0;var c=e.buffer==k.buffer;if(!(s=_t(n)))throw new it.ErrnoError(12);(c?k:e).set(l,s)}else u=!1,s=l.byteOffset;return{ptr:s,allocated:u}},msync:function(t,e,r,n,o){if(!it.isFile(t.node.mode))throw new it.ErrnoError(19);if(2&o)return 0;ot.stream_ops.write(t,e,0,n,r,!1);return 0}}},it={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,handleFSError:function(t){if(!(t instanceof it.ErrnoError))throw t+" : "+Q();return et(t.errno)},lookupPath:function(t,e){if(e=e||{},!(t=rt.resolve(it.cwd(),t)))return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===e[n]&&(e[n]=r[n]);if(e.recurse_count>8)throw new it.ErrnoError(40);for(var o=tt.normalizeArray(t.split("/").filter((function(t){return!!t})),!1),i=it.root,a="/",s=0;s<o.length;s++){var u=s===o.length-1;if(u&&e.parent)break;if(i=it.lookupNode(i,o[s]),a=tt.join2(a,o[s]),it.isMountpoint(i)&&(!u||u&&e.follow_mount)&&(i=i.mounted.root),!u||e.follow)for(var l=0;it.isLink(i.mode);){var c=it.readlink(a);if(a=rt.resolve(tt.dirname(a),c),i=it.lookupPath(a,{recurse_count:e.recurse_count}).node,l++>40)throw new it.ErrnoError(40)}}return{path:a,node:i}},getPath:function(t){for(var e;;){if(it.isRoot(t)){var r=t.mount.mountpoint;return e?"/"!==r[r.length-1]?r+"/"+e:r+e:r}e=e?t.name+"/"+e:t.name,t=t.parent}},hashName:function(t,e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)|0;return(t+r>>>0)%it.nameTable.length},hashAddNode:function(t){var e=it.hashName(t.parent.id,t.name);t.name_next=it.nameTable[e],it.nameTable[e]=t},hashRemoveNode:function(t){var e=it.hashName(t.parent.id,t.name);if(it.nameTable[e]===t)it.nameTable[e]=t.name_next;else for(var r=it.nameTable[e];r;){if(r.name_next===t){r.name_next=t.name_next;break}r=r.name_next}},lookupNode:function(t,e){var r=it.mayLookup(t);if(r)throw new it.ErrnoError(r,t);for(var n=it.hashName(t.id,e),o=it.nameTable[n];o;o=o.name_next){var i=o.name;if(o.parent.id===t.id&&i===e)return o}return it.lookup(t,e)},createNode:function(t,e,r,n){if(!it.FSNode){it.FSNode=function(t,e,r,n){t||(t=this),this.parent=t,this.mount=t.mount,this.mounted=null,this.id=it.nextInode++,this.name=e,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n},it.FSNode.prototype={};Object.defineProperties(it.FSNode.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(t){t?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(t){t?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return it.isDir(this.mode)}},isDevice:{get:function(){return it.isChrdev(this.mode)}}})}var o=new it.FSNode(t,e,r,n);return it.hashAddNode(o),o},destroyNode:function(t){it.hashRemoveNode(t)},isRoot:function(t){return t===t.parent},isMountpoint:function(t){return!!t.mounted},isFile:function(t){return 32768==(61440&t)},isDir:function(t){return 16384==(61440&t)},isLink:function(t){return 40960==(61440&t)},isChrdev:function(t){return 8192==(61440&t)},isBlkdev:function(t){return 24576==(61440&t)},isFIFO:function(t){return 4096==(61440&t)},isSocket:function(t){return 49152==(49152&t)},flagModes:{r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218},modeStringToFlags:function(t){var e=it.flagModes[t];if(void 0===e)throw new Error("Unknown file open mode: "+t);return e},flagsToPermissionString:function(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e},nodePermissions:function(t,e){return it.ignorePermissions?0:(-1===e.indexOf("r")||292&t.mode)&&(-1===e.indexOf("w")||146&t.mode)&&(-1===e.indexOf("x")||73&t.mode)?0:13},mayLookup:function(t){var e=it.nodePermissions(t,"x");return e||(t.node_ops.lookup?0:13)},mayCreate:function(t,e){try{it.lookupNode(t,e);return 17}catch(t){}return it.nodePermissions(t,"wx")},mayDelete:function(t,e,r){var n;try{n=it.lookupNode(t,e)}catch(t){return t.errno}var o=it.nodePermissions(t,"wx");if(o)return o;if(r){if(!it.isDir(n.mode))return 20;if(it.isRoot(n)||it.getPath(n)===it.cwd())return 16}else if(it.isDir(n.mode))return 21;return 0},mayOpen:function(t,e){return t?it.isLink(t.mode)?40:it.isDir(t.mode)&&("r"!==it.flagsToPermissionString(e)||512&e)?21:it.nodePermissions(t,it.flagsToPermissionString(e)):2},MAX_OPEN_FDS:4096,nextfd:function(t,e){t=t||0,e=e||it.MAX_OPEN_FDS;for(var r=t;r<=e;r++)if(!it.streams[r])return r;throw new it.ErrnoError(24)},getStream:function(t){return it.streams[t]},createStream:function(t,e,r){it.FSStream||(it.FSStream=function(){},it.FSStream.prototype={},Object.defineProperties(it.FSStream.prototype,{object:{get:function(){return this.node},set:function(t){this.node=t}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}}));var n=new it.FSStream;for(var o in t)n[o]=t[o];t=n;var i=it.nextfd(e,r);return t.fd=i,it.streams[i]=t,t},closeStream:function(t){it.streams[t]=null},chrdev_stream_ops:{open:function(t){var e=it.getDevice(t.node.rdev);t.stream_ops=e.stream_ops,t.stream_ops.open&&t.stream_ops.open(t)},llseek:function(){throw new it.ErrnoError(29)}},major:function(t){return t>>8},minor:function(t){return 255&t},makedev:function(t,e){return t<<8|e},registerDevice:function(t,e){it.devices[t]={stream_ops:e}},getDevice:function(t){return it.devices[t]},getMounts:function(t){for(var e=[],r=[t];r.length;){var n=r.pop();e.push(n),r.push.apply(r,n.mounts)}return e},syncfs:function(t,e){"function"==typeof t&&(e=t,t=!1),it.syncFSRequests++,it.syncFSRequests>1&&console.log("warning: "+it.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=it.getMounts(it.root.mount),n=0;function o(t){return it.syncFSRequests--,e(t)}function i(t){if(t)return i.errored?void 0:(i.errored=!0,o(t));++n>=r.length&&o(null)}r.forEach((function(e){if(!e.type.syncfs)return i(null);e.type.syncfs(e,t,i)}))},mount:function(t,e,r){var n,o="/"===r,i=!r;if(o&&it.root)throw new it.ErrnoError(16);if(!o&&!i){var a=it.lookupPath(r,{follow_mount:!1});if(r=a.path,n=a.node,it.isMountpoint(n))throw new it.ErrnoError(16);if(!it.isDir(n.mode))throw new it.ErrnoError(20)}var s={type:t,opts:e,mountpoint:r,mounts:[]},u=t.mount(s);return u.mount=s,s.root=u,o?it.root=u:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),u},unmount:function(t){var e=it.lookupPath(t,{follow_mount:!1});if(!it.isMountpoint(e.node))throw new it.ErrnoError(22);var r=e.node,n=r.mounted,o=it.getMounts(n);Object.keys(it.nameTable).forEach((function(t){for(var e=it.nameTable[t];e;){var r=e.name_next;-1!==o.indexOf(e.mount)&&it.destroyNode(e),e=r}})),r.mounted=null;var i=r.mount.mounts.indexOf(n);r.mount.mounts.splice(i,1)},lookup:function(t,e){return t.node_ops.lookup(t,e)},mknod:function(t,e,r){var n=it.lookupPath(t,{parent:!0}).node,o=tt.basename(t);if(!o||"."===o||".."===o)throw new it.ErrnoError(22);var i=it.mayCreate(n,o);if(i)throw new it.ErrnoError(i);if(!n.node_ops.mknod)throw new it.ErrnoError(1);return n.node_ops.mknod(n,o,e,r)},create:function(t,e){return e=void 0!==e?e:438,e&=4095,e|=32768,it.mknod(t,e,0)},mkdir:function(t,e){return e=void 0!==e?e:511,e&=1023,e|=16384,it.mknod(t,e,0)},mkdirTree:function(t,e){for(var r=t.split("/"),n="",o=0;o<r.length;++o)if(r[o]){n+="/"+r[o];try{it.mkdir(n,e)}catch(t){if(17!=t.errno)throw t}}},mkdev:function(t,e,r){return void 0===r&&(r=e,e=438),e|=8192,it.mknod(t,e,r)},symlink:function(t,e){if(!rt.resolve(t))throw new it.ErrnoError(2);var r=it.lookupPath(e,{parent:!0}).node;if(!r)throw new it.ErrnoError(2);var n=tt.basename(e),o=it.mayCreate(r,n);if(o)throw new it.ErrnoError(o);if(!r.node_ops.symlink)throw new it.ErrnoError(1);return r.node_ops.symlink(r,n,t)},rename:function(t,e){var r,n,o=tt.dirname(t),i=tt.dirname(e),a=tt.basename(t),s=tt.basename(e);try{r=it.lookupPath(t,{parent:!0}).node,n=it.lookupPath(e,{parent:!0}).node}catch(t){throw new it.ErrnoError(16)}if(!r||!n)throw new it.ErrnoError(2);if(r.mount!==n.mount)throw new it.ErrnoError(18);var u,l=it.lookupNode(r,a),c=rt.relative(t,i);if("."!==c.charAt(0))throw new it.ErrnoError(22);if("."!==(c=rt.relative(e,o)).charAt(0))throw new it.ErrnoError(39);try{u=it.lookupNode(n,s)}catch(t){}if(l!==u){var d=it.isDir(l.mode),f=it.mayDelete(r,a,d);if(f)throw new it.ErrnoError(f);if(f=u?it.mayDelete(n,s,d):it.mayCreate(n,s))throw new it.ErrnoError(f);if(!r.node_ops.rename)throw new it.ErrnoError(1);if(it.isMountpoint(l)||u&&it.isMountpoint(u))throw new it.ErrnoError(16);if(n!==r&&(f=it.nodePermissions(r,"w")))throw new it.ErrnoError(f);try{it.trackingDelegate.willMovePath&&it.trackingDelegate.willMovePath(t,e)}catch(r){console.log("FS.trackingDelegate['willMovePath']('"+t+"', '"+e+"') threw an exception: "+r.message)}it.hashRemoveNode(l);try{r.node_ops.rename(l,n,s)}catch(t){throw t}finally{it.hashAddNode(l)}try{it.trackingDelegate.onMovePath&&it.trackingDelegate.onMovePath(t,e)}catch(r){console.log("FS.trackingDelegate['onMovePath']('"+t+"', '"+e+"') threw an exception: "+r.message)}}},rmdir:function(t){var e=it.lookupPath(t,{parent:!0}).node,r=tt.basename(t),n=it.lookupNode(e,r),o=it.mayDelete(e,r,!0);if(o)throw new it.ErrnoError(o);if(!e.node_ops.rmdir)throw new it.ErrnoError(1);if(it.isMountpoint(n))throw new it.ErrnoError(16);try{it.trackingDelegate.willDeletePath&&it.trackingDelegate.willDeletePath(t)}catch(e){console.log("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+e.message)}e.node_ops.rmdir(e,r),it.destroyNode(n);try{it.trackingDelegate.onDeletePath&&it.trackingDelegate.onDeletePath(t)}catch(e){console.log("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+e.message)}},readdir:function(t){var e=it.lookupPath(t,{follow:!0}).node;if(!e.node_ops.readdir)throw new it.ErrnoError(20);return e.node_ops.readdir(e)},unlink:function(t){var e=it.lookupPath(t,{parent:!0}).node,r=tt.basename(t),n=it.lookupNode(e,r),o=it.mayDelete(e,r,!1);if(o)throw new it.ErrnoError(o);if(!e.node_ops.unlink)throw new it.ErrnoError(1);if(it.isMountpoint(n))throw new it.ErrnoError(16);try{it.trackingDelegate.willDeletePath&&it.trackingDelegate.willDeletePath(t)}catch(e){console.log("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+e.message)}e.node_ops.unlink(e,r),it.destroyNode(n);try{it.trackingDelegate.onDeletePath&&it.trackingDelegate.onDeletePath(t)}catch(e){console.log("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+e.message)}},readlink:function(t){var e=it.lookupPath(t).node;if(!e)throw new it.ErrnoError(2);if(!e.node_ops.readlink)throw new it.ErrnoError(22);return rt.resolve(it.getPath(e.parent),e.node_ops.readlink(e))},stat:function(t,e){var r=it.lookupPath(t,{follow:!e}).node;if(!r)throw new it.ErrnoError(2);if(!r.node_ops.getattr)throw new it.ErrnoError(1);return r.node_ops.getattr(r)},lstat:function(t){return it.stat(t,!0)},chmod:function(t,e,r){var n;"string"==typeof t?n=it.lookupPath(t,{follow:!r}).node:n=t;if(!n.node_ops.setattr)throw new it.ErrnoError(1);n.node_ops.setattr(n,{mode:4095&e|-4096&n.mode,timestamp:Date.now()})},lchmod:function(t,e){it.chmod(t,e,!0)},fchmod:function(t,e){var r=it.getStream(t);if(!r)throw new it.ErrnoError(9);it.chmod(r.node,e)},chown:function(t,e,r,n){var o;"string"==typeof t?o=it.lookupPath(t,{follow:!n}).node:o=t;if(!o.node_ops.setattr)throw new it.ErrnoError(1);o.node_ops.setattr(o,{timestamp:Date.now()})},lchown:function(t,e,r){it.chown(t,e,r,!0)},fchown:function(t,e,r){var n=it.getStream(t);if(!n)throw new it.ErrnoError(9);it.chown(n.node,e,r)},truncate:function(t,e){if(e<0)throw new it.ErrnoError(22);var r;"string"==typeof t?r=it.lookupPath(t,{follow:!0}).node:r=t;if(!r.node_ops.setattr)throw new it.ErrnoError(1);if(it.isDir(r.mode))throw new it.ErrnoError(21);if(!it.isFile(r.mode))throw new it.ErrnoError(22);var n=it.nodePermissions(r,"w");if(n)throw new it.ErrnoError(n);r.node_ops.setattr(r,{size:e,timestamp:Date.now()})},ftruncate:function(t,e){var r=it.getStream(t);if(!r)throw new it.ErrnoError(9);if(0==(2097155&r.flags))throw new it.ErrnoError(22);it.truncate(r.node,e)},utime:function(t,e,r){var n=it.lookupPath(t,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(e,r)})},open:function(t,e,r,o,i){if(""===t)throw new it.ErrnoError(2);var a;if(r=void 0===r?438:r,r=64&(e="string"==typeof e?it.modeStringToFlags(e):e)?4095&r|32768:0,"object"==typeof t)a=t;else{t=tt.normalize(t);try{a=it.lookupPath(t,{follow:!(131072&e)}).node}catch(t){}}var s=!1;if(64&e)if(a){if(128&e)throw new it.ErrnoError(17)}else a=it.mknod(t,r,0),s=!0;if(!a)throw new it.ErrnoError(2);if(it.isChrdev(a.mode)&&(e&=-513),65536&e&&!it.isDir(a.mode))throw new it.ErrnoError(20);if(!s){var u=it.mayOpen(a,e);if(u)throw new it.ErrnoError(u)}512&e&&it.truncate(a,0),e&=-641;var l=it.createStream({node:a,path:it.getPath(a),flags:e,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1},o,i);l.stream_ops.open&&l.stream_ops.open(l),!n.logReadFiles||1&e||(it.readFiles||(it.readFiles={}),t in it.readFiles||(it.readFiles[t]=1,console.log("FS.trackingDelegate error on read file: "+t)));try{if(it.trackingDelegate.onOpenFile){var c=0;1!=(2097155&e)&&(c|=it.tracking.openFlags.READ),0!=(2097155&e)&&(c|=it.tracking.openFlags.WRITE),it.trackingDelegate.onOpenFile(t,c)}}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return l},close:function(t){if(it.isClosed(t))throw new it.ErrnoError(9);t.getdents&&(t.getdents=null);try{t.stream_ops.close&&t.stream_ops.close(t)}catch(t){throw t}finally{it.closeStream(t.fd)}t.fd=null},isClosed:function(t){return null===t.fd},llseek:function(t,e,r){if(it.isClosed(t))throw new it.ErrnoError(9);if(!t.seekable||!t.stream_ops.llseek)throw new it.ErrnoError(29);if(0!=r&&1!=r&&2!=r)throw new it.ErrnoError(22);return t.position=t.stream_ops.llseek(t,e,r),t.ungotten=[],t.position},read:function(t,e,r,n,o){if(n<0||o<0)throw new it.ErrnoError(22);if(it.isClosed(t))throw new it.ErrnoError(9);if(1==(2097155&t.flags))throw new it.ErrnoError(9);if(it.isDir(t.node.mode))throw new it.ErrnoError(21);if(!t.stream_ops.read)throw new it.ErrnoError(22);var i=void 0!==o;if(i){if(!t.seekable)throw new it.ErrnoError(29)}else o=t.position;var a=t.stream_ops.read(t,e,r,n,o);return i||(t.position+=a),a},write:function(t,e,r,n,o,i){if(n<0||o<0)throw new it.ErrnoError(22);if(it.isClosed(t))throw new it.ErrnoError(9);if(0==(2097155&t.flags))throw new it.ErrnoError(9);if(it.isDir(t.node.mode))throw new it.ErrnoError(21);if(!t.stream_ops.write)throw new it.ErrnoError(22);1024&t.flags&&it.llseek(t,0,2);var a=void 0!==o;if(a){if(!t.seekable)throw new it.ErrnoError(29)}else o=t.position;var s=t.stream_ops.write(t,e,r,n,o,i);a||(t.position+=s);try{t.path&&it.trackingDelegate.onWriteToFile&&it.trackingDelegate.onWriteToFile(t.path)}catch(e){console.log("FS.trackingDelegate['onWriteToFile']('"+t.path+"') threw an exception: "+e.message)}return s},allocate:function(t,e,r){if(it.isClosed(t))throw new it.ErrnoError(9);if(e<0||r<=0)throw new it.ErrnoError(22);if(0==(2097155&t.flags))throw new it.ErrnoError(9);if(!it.isFile(t.node.mode)&&!it.isDir(t.node.mode))throw new it.ErrnoError(19);if(!t.stream_ops.allocate)throw new it.ErrnoError(95);t.stream_ops.allocate(t,e,r)},mmap:function(t,e,r,n,o,i,a){if(0!=(2&i)&&0==(2&a)&&2!=(2097155&t.flags))throw new it.ErrnoError(13);if(1==(2097155&t.flags))throw new it.ErrnoError(13);if(!t.stream_ops.mmap)throw new it.ErrnoError(19);return t.stream_ops.mmap(t,e,r,n,o,i,a)},msync:function(t,e,r,n,o){return t&&t.stream_ops.msync?t.stream_ops.msync(t,e,r,n,o):0},munmap:function(t){return 0},ioctl:function(t,e,r){if(!t.stream_ops.ioctl)throw new it.ErrnoError(25);return t.stream_ops.ioctl(t,e,r)},readFile:function(t,e){if((e=e||{}).flags=e.flags||"r",e.encoding=e.encoding||"binary","utf8"!==e.encoding&&"binary"!==e.encoding)throw new Error('Invalid encoding type "'+e.encoding+'"');var r,n=it.open(t,e.flags),o=it.stat(t).size,i=new Uint8Array(o);return it.read(n,i,0,o,0),"utf8"===e.encoding?r=w(i,0):"binary"===e.encoding&&(r=i),it.close(n),r},writeFile:function(t,e,r){(r=r||{}).flags=r.flags||"w";var n=it.open(t,r.flags,r.mode);if("string"==typeof e){var o=new Uint8Array(E(e)+1),i=y(e,o,0,o.length);it.write(n,o,0,i,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(e))throw new Error("Unsupported data type");it.write(n,e,0,e.byteLength,void 0,r.canOwn)}it.close(n)},cwd:function(){return it.currentPath},chdir:function(t){var e=it.lookupPath(t,{follow:!0});if(null===e.node)throw new it.ErrnoError(2);if(!it.isDir(e.node.mode))throw new it.ErrnoError(20);var r=it.nodePermissions(e.node,"x");if(r)throw new it.ErrnoError(r);it.currentPath=e.path},createDefaultDirectories:function(){it.mkdir("/tmp"),it.mkdir("/home"),it.mkdir("/home/web_user")},createDefaultDevices:function(){var t;if(it.mkdir("/dev"),it.registerDevice(it.makedev(1,3),{read:function(){return 0},write:function(t,e,r,n,o){return n}}),it.mkdev("/dev/null",it.makedev(1,3)),nt.register(it.makedev(5,0),nt.default_tty_ops),nt.register(it.makedev(6,0),nt.default_tty1_ops),it.mkdev("/dev/tty",it.makedev(5,0)),it.mkdev("/dev/tty1",it.makedev(6,0)),"object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);t=function(){return crypto.getRandomValues(e),e[0]}}t||(t=function(){ht("random_device")}),it.createDevice("/dev","random",t),it.createDevice("/dev","urandom",t),it.mkdir("/dev/shm"),it.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){it.mkdir("/proc"),it.mkdir("/proc/self"),it.mkdir("/proc/self/fd"),it.mount({mount:function(){var t=it.createNode("/proc/self","fd",16895,73);return t.node_ops={lookup:function(t,e){var r=+e,n=it.getStream(r);if(!n)throw new it.ErrnoError(9);var o={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return n.path}}};return o.parent=o,o}},t}},{},"/proc/self/fd")},createStandardStreams:function(){n.stdin?it.createDevice("/dev","stdin",n.stdin):it.symlink("/dev/tty","/dev/stdin"),n.stdout?it.createDevice("/dev","stdout",null,n.stdout):it.symlink("/dev/tty","/dev/stdout"),n.stderr?it.createDevice("/dev","stderr",null,n.stderr):it.symlink("/dev/tty1","/dev/stderr");it.open("/dev/stdin","r"),it.open("/dev/stdout","w"),it.open("/dev/stderr","w")},ensureErrnoError:function(){it.ErrnoError||(it.ErrnoError=function(t,e){this.node=e,this.setErrno=function(t){this.errno=t},this.setErrno(t),this.message="FS error"},it.ErrnoError.prototype=new Error,it.ErrnoError.prototype.constructor=it.ErrnoError,[2].forEach((function(t){it.genericErrors[t]=new it.ErrnoError(t),it.genericErrors[t].stack="<generic error, no stack>"})))},staticInit:function(){it.ensureErrnoError(),it.nameTable=new Array(4096),it.mount(ot,{},"/"),it.createDefaultDirectories(),it.createDefaultDevices(),it.createSpecialDirectories(),it.filesystems={MEMFS:ot}},init:function(t,e,r){it.init.initialized=!0,it.ensureErrnoError(),n.stdin=t||n.stdin,n.stdout=e||n.stdout,n.stderr=r||n.stderr,it.createStandardStreams()},quit:function(){it.init.initialized=!1;var t=n._fflush;t&&t(0);for(var e=0;e<it.streams.length;e++){var r=it.streams[e];r&&it.close(r)}},getMode:function(t,e){var r=0;return t&&(r|=365),e&&(r|=146),r},joinPath:function(t,e){var r=tt.join.apply(null,t);return e&&"/"==r[0]&&(r=r.substr(1)),r},absolutePath:function(t,e){return rt.resolve(e,t)},standardizePath:function(t){return tt.normalize(t)},findObject:function(t,e){var r=it.analyzePath(t,e);return r.exists?r.object:(et(r.error),null)},analyzePath:function(t,e){try{t=(n=it.lookupPath(t,{follow:!e})).path}catch(t){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=it.lookupPath(t,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=tt.basename(t),n=it.lookupPath(t,{follow:!e}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot="/"===n.path}catch(t){r.error=t.errno}return r},createFolder:function(t,e,r,n){var o=tt.join2("string"==typeof t?t:it.getPath(t),e),i=it.getMode(r,n);return it.mkdir(o,i)},createPath:function(t,e,r,n){t="string"==typeof t?t:it.getPath(t);for(var o=e.split("/").reverse();o.length;){var i=o.pop();if(i){var a=tt.join2(t,i);try{it.mkdir(a)}catch(t){}t=a}}return a},createFile:function(t,e,r,n,o){var i=tt.join2("string"==typeof t?t:it.getPath(t),e),a=it.getMode(n,o);return it.create(i,a)},createDataFile:function(t,e,r,n,o,i){var a=e?tt.join2("string"==typeof t?t:it.getPath(t),e):t,s=it.getMode(n,o),u=it.create(a,s);if(r){if("string"==typeof r){for(var l=new Array(r.length),c=0,d=r.length;c<d;++c)l[c]=r.charCodeAt(c);r=l}it.chmod(u,146|s);var f=it.open(u,"w");it.write(f,r,0,r.length,0,i),it.close(f),it.chmod(u,s)}return u},createDevice:function(t,e,r,n){var o=tt.join2("string"==typeof t?t:it.getPath(t),e),i=it.getMode(!!r,!!n);it.createDevice.major||(it.createDevice.major=64);var a=it.makedev(it.createDevice.major++,0);return it.registerDevice(a,{open:function(t){t.seekable=!1},close:function(t){n&&n.buffer&&n.buffer.length&&n(10)},read:function(t,e,n,o,i){for(var a=0,s=0;s<o;s++){var u;try{u=r()}catch(t){throw new it.ErrnoError(5)}if(void 0===u&&0===a)throw new it.ErrnoError(11);if(null==u)break;a++,e[n+s]=u}return a&&(t.node.timestamp=Date.now()),a},write:function(t,e,r,o,i){for(var a=0;a<o;a++)try{n(e[r+a])}catch(t){throw new it.ErrnoError(5)}return o&&(t.node.timestamp=Date.now()),a}}),it.mkdev(o,i,a)},createLink:function(t,e,r,n,o){var i=tt.join2("string"==typeof t?t:it.getPath(t),e);return it.symlink(r,i)},forceLoadFile:function(t){if(t.isDevice||t.isFolder||t.link||t.contents)return!0;var e=!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!i)throw new Error("Cannot load without read() or XMLHttpRequest.");try{t.contents=lt(i(t.url),!0),t.usedBytes=t.contents.length}catch(t){e=!1}return e||et(5),e},createLazyFile:function(t,e,r,n,o){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(t){if(!(t>this.length-1||t<0)){var e=t%this.chunkSize,r=t/this.chunkSize|0;return this.getter(r)[e]}},i.prototype.setDataGetter=function(t){this.getter=t},i.prototype.cacheLength=function(){var t=new XMLHttpRequest;if(t.open("HEAD",r,!1),t.send(null),!(t.status>=200&&t.status<300||304===t.status))throw new Error("Couldn't load "+r+". Status: "+t.status);var e,n=Number(t.getResponseHeader("Content-length")),o=(e=t.getResponseHeader("Accept-Ranges"))&&"bytes"===e,i=(e=t.getResponseHeader("Content-Encoding"))&&"gzip"===e,a=1048576;o||(a=n);var s=this;s.setDataGetter((function(t){var e=t*a,o=(t+1)*a-1;if(o=Math.min(o,n-1),void 0===s.chunks[t]&&(s.chunks[t]=function(t,e){if(t>e)throw new Error("invalid range ("+t+", "+e+") or no bytes requested!");if(e>n-1)throw new Error("only "+n+" bytes available! programmer error!");var o=new XMLHttpRequest;if(o.open("GET",r,!1),n!==a&&o.setRequestHeader("Range","bytes="+t+"-"+e),"undefined"!=typeof Uint8Array&&(o.responseType="arraybuffer"),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.send(null),!(o.status>=200&&o.status<300||304===o.status))throw new Error("Couldn't load "+r+". Status: "+o.status);return void 0!==o.response?new Uint8Array(o.response||[]):lt(o.responseText||"",!0)}(e,o)),void 0===s.chunks[t])throw new Error("doXHR failed!");return s.chunks[t]})),!i&&n||(a=n=1,n=this.getter(0).length,a=n,console.log("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!l)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a=new i;Object.defineProperties(a,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var s={isDevice:!1,contents:a}}else s={isDevice:!1,url:r};var u=it.createFile(t,e,s,n,o);s.contents?u.contents=s.contents:s.url&&(u.contents=null,u.url=s.url),Object.defineProperties(u,{usedBytes:{get:function(){return this.contents.length}}});var c={};return Object.keys(u.stream_ops).forEach((function(t){var e=u.stream_ops[t];c[t]=function(){if(!it.forceLoadFile(u))throw new it.ErrnoError(5);return e.apply(null,arguments)}})),c.read=function(t,e,r,n,o){if(!it.forceLoadFile(u))throw new it.ErrnoError(5);var i=t.node.contents;if(o>=i.length)return 0;var a=Math.min(i.length-o,n);if(i.slice)for(var s=0;s<a;s++)e[r+s]=i[o+s];else for(s=0;s<a;s++)e[r+s]=i.get(o+s);return a},u.stream_ops=c,u},createPreloadedFile:function(t,e,r,o,i,a,s,u,l,c){Browser.init();var d=e?rt.resolve(tt.join2(t,e)):t;function f(r){function f(r){c&&c(),u||it.createDataFile(t,e,r,o,i,l),a&&a(),W()}var _=!1;n.preloadPlugins.forEach((function(t){_||t.canHandle(d)&&(t.handle(r,d,f,(function(){s&&s(),W()})),_=!0)})),_||f(r)}q(),"string"==typeof r?Browser.asyncLoad(r,(function(t){f(t)}),s):f(r)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(t,e,r){e=e||function(){},r=r||function(){};var n=it.indexedDB();try{var o=n.open(it.DB_NAME(),it.DB_VERSION)}catch(t){return r(t)}o.onupgradeneeded=function(){console.log("creating db"),o.result.createObjectStore(it.DB_STORE_NAME)},o.onsuccess=function(){var n=o.result.transaction([it.DB_STORE_NAME],"readwrite"),i=n.objectStore(it.DB_STORE_NAME),a=0,s=0,u=t.length;function l(){0==s?e():r()}t.forEach((function(t){var e=i.put(it.analyzePath(t).object.contents,t);e.onsuccess=function(){++a+s==u&&l()},e.onerror=function(){s++,a+s==u&&l()}})),n.onerror=r},o.onerror=r},loadFilesFromDB:function(t,e,r){e=e||function(){},r=r||function(){};var n=it.indexedDB();try{var o=n.open(it.DB_NAME(),it.DB_VERSION)}catch(t){return r(t)}o.onupgradeneeded=r,o.onsuccess=function(){var n=o.result;try{var i=n.transaction([it.DB_STORE_NAME],"readonly")}catch(t){return void r(t)}var a=i.objectStore(it.DB_STORE_NAME),s=0,u=0,l=t.length;function c(){0==u?e():r()}t.forEach((function(t){var e=a.get(t);e.onsuccess=function(){it.analyzePath(t).exists&&it.unlink(t),it.createDataFile(tt.dirname(t),tt.basename(t),e.result,!0,!0,!0),++s+u==l&&c()},e.onerror=function(){u++,s+u==l&&c()}})),i.onerror=r},o.onerror=r}},at={DEFAULT_POLLMASK:5,mappings:{},umask:511,calculateAt:function(t,e){if("/"!==e[0]){var r;if(-100===t)r=it.cwd();else{var n=it.getStream(t);if(!n)throw new it.ErrnoError(9);r=n.path}e=tt.join2(r,e)}return e},doStat:function(t,e,r){try{var n=t(e)}catch(t){if(t&&t.node&&tt.normalize(e)!==tt.normalize(it.getPath(t.node)))return-20;throw t}return S[r>>2]=n.dev,S[r+4>>2]=0,S[r+8>>2]=n.ino,S[r+12>>2]=n.mode,S[r+16>>2]=n.nlink,S[r+20>>2]=n.uid,S[r+24>>2]=n.gid,S[r+28>>2]=n.rdev,S[r+32>>2]=0,$=[n.size>>>0,(K=n.size,+I(K)>=1?K>0?(0|L(+N(K/4294967296),4294967295))>>>0:~~+z((K-+(~~K>>>0))/4294967296)>>>0:0)],S[r+40>>2]=$[0],S[r+44>>2]=$[1],S[r+48>>2]=4096,S[r+52>>2]=n.blocks,S[r+56>>2]=n.atime.getTime()/1e3|0,S[r+60>>2]=0,S[r+64>>2]=n.mtime.getTime()/1e3|0,S[r+68>>2]=0,S[r+72>>2]=n.ctime.getTime()/1e3|0,S[r+76>>2]=0,$=[n.ino>>>0,(K=n.ino,+I(K)>=1?K>0?(0|L(+N(K/4294967296),4294967295))>>>0:~~+z((K-+(~~K>>>0))/4294967296)>>>0:0)],S[r+80>>2]=$[0],S[r+84>>2]=$[1],0},doMsync:function(t,e,r,n){var o=new Uint8Array(D.subarray(t,t+r));it.msync(e,o,0,r,n)},doMkdir:function(t,e){return"/"===(t=tt.normalize(t))[t.length-1]&&(t=t.substr(0,t.length-1)),it.mkdir(t,e,0),0},doMknod:function(t,e,r){switch(61440&e){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-22}return it.mknod(t,e,r),0},doReadlink:function(t,e,r){if(r<=0)return-22;var n=it.readlink(t),o=Math.min(r,E(n)),i=k[e+o];return y(n,D,e,r+1),k[e+o]=i,o},doAccess:function(t,e){if(-8&e)return-22;var r;if(!(r=it.lookupPath(t,{follow:!0}).node))return-2;var n="";return 4&e&&(n+="r"),2&e&&(n+="w"),1&e&&(n+="x"),n&&it.nodePermissions(r,n)?-13:0},doDup:function(t,e,r){var n=it.getStream(r);return n&&it.close(n),it.open(t,e,0,r,r).fd},doReadv:function(t,e,r,n){for(var o=0,i=0;i<r;i++){var a=S[e+8*i>>2],s=S[e+(8*i+4)>>2],u=it.read(t,k,a,s,n);if(u<0)return-1;if(o+=u,u<s)break}return o},doWritev:function(t,e,r,n){for(var o=0,i=0;i<r;i++){var a=S[e+8*i>>2],s=S[e+(8*i+4)>>2],u=it.write(t,k,a,s,n);if(u<0)return-1;o+=u}return o},varargs:0,get:function(t){return at.varargs+=4,S[at.varargs-4>>2]},getStr:function(){return v(at.get())},getStreamFromFD:function(){var t=it.getStream(at.get());if(!t)throw new it.ErrnoError(9);return t},get64:function(){var t=at.get();at.get();return t},getZero:function(){at.get()}};function st(t,e,r,n){try{if(!(t=it.getStream(t)))throw new it.ErrnoError(9);var o=at.doWritev(t,e,r);return S[n>>2]=o,0}catch(t){return void 0!==it&&t instanceof it.ErrnoError||ht(t),-t.errno}}function ut(){return k.length}function lt(t,e,r){var n=r>0?r:E(t)+1,o=new Array(n),i=y(t,o,0,o.length);return e&&(o.length=i),o}it.staticInit();var ct={b:ht,p:function(){},f:et,j:function(t,e){at.varargs=e;try{var r=at.getStreamFromFD(),n=at.get(),o=at.get(),i=at.get(),a=at.get(),s=4294967296*n+(o>>>0);return s<=-9007199254740992||s>=9007199254740992?-75:(it.llseek(r,s,a),$=[r.position>>>0,(K=r.position,+I(K)>=1?K>0?(0|L(+N(K/4294967296),4294967295))>>>0:~~+z((K-+(~~K>>>0))/4294967296)>>>0:0)],S[i>>2]=$[0],S[i+4>>2]=$[1],r.getdents&&0===s&&0===a&&(r.getdents=null),0)}catch(t){return void 0!==it&&t instanceof it.ErrnoError||ht(t),-t.errno}},i:function(t,e){at.varargs=e;try{var r=at.getStreamFromFD(),n=at.get(),o=at.get();return at.doReadv(r,n,o)}catch(t){return void 0!==it&&t instanceof it.ErrnoError||ht(t),-t.errno}},c:function(t,e){at.varargs=e;try{var r=at.getStreamFromFD();switch(at.get()){case 0:return(n=at.get())<0?-22:it.open(r.path,r.flags,0,n).fd;case 1:case 2:return 0;case 3:return r.flags;case 4:var n=at.get();return r.flags|=n,0;case 12:n=at.get();return T[n+0>>1]=2,0;case 13:case 14:return 0;case 16:case 8:return-22;case 9:return et(22),-1;default:return-22}}catch(t){return void 0!==it&&t instanceof it.ErrnoError||ht(t),-t.errno}},h:function(t,e){at.varargs=e;try{var r=at.getStr(),n=at.get(),o=at.get();return it.open(r,n,o).fd}catch(t){return void 0!==it&&t instanceof it.ErrnoError||ht(t),-t.errno}},g:function(t,e){at.varargs=e;try{var r=at.getStreamFromFD(),n=at.get();switch(n){case 21509:case 21505:return r.tty?0:-25;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return r.tty?0:-25;case 21519:if(!r.tty)return-25;var o=at.get();return S[o>>2]=0,0;case 21520:return r.tty?-22:-25;case 21531:o=at.get();return it.ioctl(r,n,o);case 21523:case 21524:return r.tty?0:-25;default:ht("bad ioctl syscall "+n)}}catch(t){return void 0!==it&&t instanceof it.ErrnoError||ht(t),-t.errno}},e:function(t,e){at.varargs=e;try{var r=at.getStreamFromFD();return it.close(r),0}catch(t){return void 0!==it&&t instanceof it.ErrnoError||ht(t),-t.errno}},d:function(){},o:function(){return st.apply(null,arguments)},n:ut,m:function(t,e,r){D.set(D.subarray(e,e+r),t)},l:function(t){var e=ut();if(t>2147418112)return!1;for(var r=Math.max(e,16777216);r<t;)r=r<=536870912?P(2*r,65536):Math.min(P((3*r+2147483648)/4,65536),2147418112);return!!function(t){try{return p.grow(t-b.byteLength+65535>>16),F(p.buffer),1}catch(t){}}(r)},k:function(t){ht("OOM")},a:A},dt=n.asm({},ct,b);n.asm=dt;n.___errno_location=function(){return n.asm.q.apply(null,arguments)},n._free=function(){return n.asm.r.apply(null,arguments)};var ft,_t=n._malloc=function(){return n.asm.s.apply(null,arguments)};n._mid_alloc_options=function(){return n.asm.t.apply(null,arguments)},n._mid_exit=function(){return n.asm.u.apply(null,arguments)},n._mid_get_load_request=function(){return n.asm.v.apply(null,arguments)},n._mid_get_load_request_count=function(){return n.asm.w.apply(null,arguments)},n._mid_init=function(){return n.asm.x.apply(null,arguments)},n._mid_istream_close=function(){return n.asm.y.apply(null,arguments)},n._mid_istream_open_mem=function(){return n.asm.z.apply(null,arguments)},n._mid_song_free=function(){return n.asm.A.apply(null,arguments)},n._mid_song_get_time=function(){return n.asm.B.apply(null,arguments)},n._mid_song_get_total_time=function(){return n.asm.C.apply(null,arguments)},n._mid_song_load=function(){return n.asm.D.apply(null,arguments)},n._mid_song_read_wave=function(){return n.asm.E.apply(null,arguments)},n._mid_song_seek=function(){return n.asm.F.apply(null,arguments)},n._mid_song_start=function(){return n.asm.G.apply(null,arguments)},n.stackAlloc=function(){return n.asm.H.apply(null,arguments)};function pt(t){function e(){ft||(ft=!0,m||(!0,n.noFSInit||it.init.initialized||it.init(),nt.init(),M(R),it.ignorePermissions=!1,M(C),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)t=n.postRun.shift(),O.unshift(t);var t;M(O)}()))}t=t||s,H>0||(!function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)t=n.preRun.shift(),B.unshift(t);var t;M(B)}(),H>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),e()}),1)):e()))}function ht(t){throw n.onAbort&&n.onAbort(t),d(t+=""),f(t),m=!0,1,"abort("+t+"). Build with -s ASSERTIONS=1 for more info."}if(n.asm=dt,n.UTF8ToString=v,n.FS=it,n.then=function(t){if(ft)t(n);else{var e=n.onRuntimeInitialized;n.onRuntimeInitialized=function(){e&&e(),t(n)}}return n},j=function t(){ft||pt(),ft||(j=t)},n.run=pt,n.abort=ht,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return!0,pt(),e}}(),r="\ndrumset 0\n\n 25\tDrum_000/025_Snare_Roll.pat \n 26\tDrum_000/026_Snap.pat \n 27\tDrum_000/027_High_Q.pat \n 31\tDrum_000/031_Sticks.pat \n 32\tDrum_000/032_Square_Click.pat \n 33\tDrum_000/033_Metronome_Click.pat \n 34\tDrum_000/034_Metronome_Bell.pat \n 35\tDrum_000/035_Kick_1.pat amp=100\n 36\tDrum_000/036_Kick_2.pat amp=100\n 37\tDrum_000/037_Stick_Rim.pat \n 38\tDrum_000/038_Snare_1.pat \n 39\tDrum_000/039_Clap_Hand.pat amp=100\n 40\tDrum_000/040_Snare_2.pat \n 41\tDrum_000/041_Tom_Low_2.pat amp=100\n 42\tDrum_000/042_Hi-Hat_Closed.pat \n 43\tDrum_000/043_Tom_Low_1.pat amp=100\n 44\tDrum_000/044_Hi-Hat_Pedal.pat \n 45\tDrum_000/045_Tom_Mid_2.pat amp=100\n 46\tDrum_000/046_Hi-Hat_Open.pat \n 47\tDrum_000/047_Tom_Mid_1.pat amp=100\n 48\tDrum_000/048_Tom_High_2.pat amp=100\n 49\tDrum_000/049_Cymbal_Crash_1.pat \n 50\tDrum_000/050_Tom_High_1.pat amp=100\n 51\tDrum_000/051_Cymbal_Ride_1.pat \n 52\tDrum_000/052_Cymbal_Chinese.pat \n 53\tDrum_000/053_Cymbal_Ride_Bell.pat amp=100\n 54\tDrum_000/054_Tombourine.pat \n 55\tDrum_000/055_Cymbal_Splash.pat \n 56\tDrum_000/056_Cow_Bell.pat \n 57\tDrum_000/057_Cymbal_Crash_2.pat \n 58\tDrum_000/058_Vibra-Slap.pat \n 59\tDrum_000/059_Cymbal_Ride_2.pat \n 60\tDrum_000/060_Bongo_High.pat \n 61\tDrum_000/061_Bongo_Low.pat \n 62\tDrum_000/062_Conga_High_1_Mute.pat \n 63\tDrum_000/063_Conga_High_2_Open.pat \n 64\tDrum_000/064_Conga_Low.pat \n 65\tDrum_000/065_Timbale_High.pat \n 66\tDrum_000/066_Timbale_Low.pat \n 67\tDrum_000/067_Agogo_High.pat \n 68\tDrum_000/068_Agogo_Low.pat \n 69\tDrum_000/069_Cabasa.pat amp=100\n 70\tDrum_000/070_Maracas.pat \n 71\tDrum_000/071_Whistle_1_High_Short.pat \n 72\tDrum_000/072_Whistle_2_Low_Long.pat \n 73\tDrum_000/073_Guiro_1_Short.pat \n 74\tDrum_000/074_Guiro_2_Long.pat \n 75\tDrum_000/075_Claves.pat amp=100\n 76\tDrum_000/076_Wood_Block_1_High.pat \n 77\tDrum_000/077_Wood_Block_2_Low.pat \n 78\tDrum_000/078_Cuica_1_Mute.pat amp=100\n 79\tDrum_000/079_Cuica_2_Open.pat amp=100\n 80\tDrum_000/080_Triangle_1_Mute.pat \n 81\tDrum_000/081_Triangle_2_Open.pat \n 82\tDrum_000/082_Shaker.pat \n 84\tDrum_000/084_Belltree.pat \n\nbank 0\n\n 0\tTone_000/000_Acoustic_Grand_Piano.pat amp=120 pan=center\n 1\tTone_000/001_Acoustic_Brite_Piano.pat \n 2\tTone_000/002_Electric_Grand_Piano.pat \n 4\tTone_000/004_Electric_Piano_1_Rhodes.pat \n 5\tTone_000/005_Electric_Piano_2_Chorused_Yamaha_DX.pat \n 6\tTone_000/006_Harpsichord.pat \n 7\tTone_000/007_Clavinet.pat \n 8\tTone_000/008_Celesta.pat \n 9\tTone_000/009_Glockenspiel.pat \n 13\tTone_000/013_Xylophone.pat \n 14\tTone_000/014_Tubular_Bells.pat \n 15\tTone_000/015_Dulcimer.pat \n 16\tTone_000/016_Hammond_Organ.pat \n 19\tTone_000/019_Church_Organ.pat \n 21\tTone_000/021_Accordion.pat \n 23\tTone_000/023_Tango_Accordion.pat \n 24\tTone_000/024_Nylon_Guitar.pat \n 25\tTone_000/025_Steel_Guitar.pat \n 26\tTone_000/026_Jazz_Guitar.pat \n 27\tTone_000/027_Clean_Electric_Guitar.pat \n 28\tTone_000/028_Muted_Electric_Guitar.pat \n 29\tTone_000/029_Overdriven_Guitar.pat \n 30\tTone_000/030_Distortion_Guitar.pat \n 32\tTone_000/032_Acoustic_Bass.pat \n 33\tTone_000/033_Finger_Bass.pat \n 34\tTone_000/034_Pick_Bass.pat \n 35\tTone_000/035_Fretless_Bass.pat \n 36\tTone_000/036_Slap_Bass_1.pat \n 37\tTone_000/037_Slap_Bass_2.pat \n 38\tTone_000/038_Synth_Bass_1.pat \n 40\tTone_000/040_Violin.pat \n 42\tTone_000/042_Cello.pat \n 44\tTone_000/044_Tremolo_Strings.pat \n 45\tTone_000/045_Pizzicato_Strings.pat \n 46\tTone_000/046_Harp.pat \n 47\tTone_000/047_Timpani.pat \n 48\tTone_000/048_String_Ensemble_1_Marcato.pat \n 53\tTone_000/053_Voice_Oohs.pat \n 56\tTone_000/056_Trumpet.pat \n 57\tTone_000/057_Trombone.pat \n 58\tTone_000/058_Tuba.pat \n 59\tTone_000/059_Muted_Trumpet.pat \n 60\tTone_000/060_French_Horn.pat \n 61\tTone_000/061_Brass_Section.pat \n 64\tTone_000/064_Soprano_Sax.pat \n 65\tTone_000/065_Alto_Sax.pat \n 66\tTone_000/066_Tenor_Sax.pat \n 67\tTone_000/067_Baritone_Sax.pat \n 68\tTone_000/068_Oboe.pat \n 69\tTone_000/069_English_Horn.pat \n 70\tTone_000/070_Bassoon.pat \n 71\tTone_000/071_Clarinet.pat \n 72\tTone_000/072_Piccolo.pat \n 73\tTone_000/073_Flute.pat \n 74\tTone_000/074_Recorder.pat \n 75\tTone_000/075_Pan_Flute.pat \n 76\tTone_000/076_Bottle_Blow.pat \n 79\tTone_000/079_Ocarina.pat \n 80\tTone_000/080_Square_Wave.pat \n 84\tTone_000/084_Charang.pat \n 88\tTone_000/088_New_Age.pat \n 94\tTone_000/094_Halo_Pad.pat \n 95\tTone_000/095_Sweep_Pad.pat \n 98\tTone_000/098_Crystal.pat \n 101\tTone_000/101_Goblins--Unicorn.pat \n 102\tTone_000/102_Echo_Voice.pat \n 104\tTone_000/104_Sitar.pat \n 114\tTone_000/114_Steel_Drums.pat \n 115\tTone_000/115_Wood_Block.pat \n 120\tTone_000/120_Guitar_Fret_Noise.pat \n 122\tTone_000/122_Seashore.pat \n 125\tTone_000/125_Helicopter.pat \n\n",n=44100,o=32784,i=2,a=2*i,s=16384,u=window.AudioContext||window.webkitAudioContext;return class{constructor(r=""){this.destroyed=!1,r.endsWith("/")||(r+="/"),this._baseUrl=new URL(r,window.location.origin).href,this._ready=!1,this._playing=!1,this._pendingFetches={},this._songPtr=0,this._bufferPtr=0,this._array=new Int16Array(2*s),this._currentUrlOrBuf=null,this._interval=null,this.on=t.on,this._startInterval=this._startInterval.bind(this),this._stopInterval=this._stopInterval.bind(this),this._audioContext=new u,this._node=this._audioContext.createScriptProcessor(s,0,i),this._onAudioProcess=this._onAudioProcess.bind(this),this._node.addEventListener("audioprocess",this._onAudioProcess),this._node.connect(this._audioContext.destination),this._lib=e({locateFile:t=>new URL(t,this._baseUrl).href,onRuntimeInitialized:()=>this._onLibReady()})}_onLibReady(){if(this._lib.FS.writeFile("/timidity.cfg",r),0!==this._lib._mid_init("/timidity.cfg"))return this._destroy(new Error("Failed to initialize libmfa"));this._bufferPtr=this._lib._malloc(s*a),this._ready=!0,t.emit("_ready")}async load(e){if(this.destroyed)throw new Error("load() called after destroy()");if(this._audioContext.resume(),this._songPtr&&this._destroySong(),t.emit("unstarted"),this._stopInterval(),!this._ready)return t.once("_ready",()=>this.load(e));let r;if(t.emit("buffering"),this._currentUrlOrBuf=e,"string"==typeof e){if(r=await this._fetch(new URL(this._baseUrl+e,this._baseUrl)),this._currentUrlOrBuf!==e)return}else{if(!(e instanceof Uint8Array))throw new Error("load() expects a `string` or `Uint8Array` argument");r=e}let n=this._loadSong(r),o=this._lib._mid_get_load_request_count(n);if(o>0){let t=this._getMissingInstruments(n,o);if(await Promise.all(t.map(t=>this._fetchInstrument(t))),this._currentUrlOrBuf!==e)return;this._lib._mid_song_free(n),n=this._loadSong(r),o=this._lib._mid_get_load_request_count(n),o>0&&(t=this._getMissingInstruments(n,o))}this._songPtr=n,this._lib._mid_song_start(this._songPtr)}_getMissingInstruments(t,e){const r=[];for(let n=0;n<e;n++){const e=this._lib._mid_get_load_request(t,n),o=this._lib.UTF8ToString(e);r.push(o)}return r}_loadSong(t){const e=this._lib._mid_alloc_options(n,o,i,s),r=this._lib._malloc(t.byteLength);this._lib.HEAPU8.set(t,r);const a=this._lib._mid_istream_open_mem(r,t.byteLength),u=this._lib._mid_song_load(a,e);return this._lib._mid_istream_close(a),this._lib._free(e),this._lib._free(r),0===u?this._destroy(new Error("Failed to load MIDI file")):u}async _fetchInstrument(t){if(this._pendingFetches[t])return this._pendingFetches[t];const e=new URL(t,this._baseUrl),r=this._fetch(e);this._pendingFetches[t]=r;const n=await r;return this._writeInstrumentFile(t,n),delete this._pendingFetches[t],n}_writeInstrumentFile(t,e){const r=t.split("/").slice(0,-1).join("/");this._mkdirp(r),this._lib.FS.writeFile(t,e,{encoding:"binary"})}_mkdirp(t){const e=t.split("/");let r="/";for(let t=0;t<e.length;t++){const n=e[t];try{this._lib.FS.mkdir(`${r}${n}`)}catch(t){}r+=`${n}/`}}async _fetch(t){const e=await window.fetch(t,{mode:"cors",credentials:"same-origin"});if(200!==e.status)throw new Error(`Could not load ${t}`);const r=await e.arrayBuffer();return new Uint8Array(r)}play(){if(this.destroyed)throw new Error("play() called after destroy()");this._audioContext.resume(),this._playing=!0,this._ready&&!this._currentUrlOrBuf&&(t.emit("playing"),this._startInterval())}_onAudioProcess(e){const r=this._songPtr&&this._playing?this._readMidiData():0;r>0&&this._currentUrlOrBuf&&(this._currentUrlOrBuf=null,t.emit("playing"),this._startInterval());const n=e.outputBuffer.getChannelData(0),o=e.outputBuffer.getChannelData(1);for(let t=0;t<r;t++)n[t]=this._array[2*t]/32767,o[t]=this._array[2*t+1]/32767;for(let t=r;t<s;t++)n[t]=0,o[t]=0;this._songPtr&&this._playing&&0===r&&(this.seek(0),this.pause(),this._lib._mid_song_start(this._songPtr),t.emit("ended"))}_readMidiData(){const t=this._lib._mid_song_read_wave(this._songPtr,this._bufferPtr,s*a),e=t/a;return 0===e?0:(this._array.set(this._lib.HEAP16.subarray(this._bufferPtr/2,(this._bufferPtr+t)/2)),e)}pause(){if(this.destroyed)throw new Error("pause() called after destroy()");this._playing=!1,this._stopInterval(),t.emit("paused")}seek(t){if(this.destroyed)throw new Error("seek() called after destroy()");if(!this._songPtr)return;const e=Math.floor(1e3*t);this._lib._mid_song_seek(this._songPtr,e),this._onTimeupdate()}get currentTime(){return this.destroyed||!this._songPtr?0:this._lib._mid_song_get_time(this._songPtr)/1e3}get duration(){return this.destroyed||!this._songPtr?1:this._lib._mid_song_get_total_time(this._songPtr)/1e3}_onTimeupdate(){t.emit("timeupdate",this.currentTime)}_startInterval(){this._onTimeupdate(),this._interval=setInterval(()=>this._onTimeupdate(),1e3)}_stopInterval(){this._onTimeupdate(),clearInterval(this._interval),this._interval=null}destroy(){if(this.destroyed)throw new Error("destroy() called after destroy()");this._destroy()}_destroy(e){this.destroyed||(this.destroyed=!0,this._stopInterval(),this._array=null,this._songPtr&&this._destroySong(),this._bufferPtr&&(this._lib._free(this._bufferPtr),this._bufferPtr=0),this._node&&(this._node.disconnect(),this._node.removeEventListener("audioprocess",this._onAudioProcess)),this._audioContext&&this._audioContext.close(),e&&t.emit("error",e))}_destroySong(){this._lib._mid_song_free(this._songPtr),this._songPtr=0}}})();