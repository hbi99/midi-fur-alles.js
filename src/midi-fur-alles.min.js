!function(t,e){const r=(()=>{const t={};return{once(e,n){t[e]||(t[e]=[]),t[e].unshift(()=>{n(),r.off(e,n)})},on(e,r){t[e]||(t[e]=[]),t[e].unshift(r)},off(e,r){if(!t[e])return;let n=t[e].indexOf(r);t[e].splice(n,1)},emit(e,r){if(!t[e])return;let n={type:e,detail:r,isCanceled:!1,cancelBubble:()=>{this.isCanceled=!0}},o=t[e].length;for(;o--;){if(n.isCanceled)return;t[e][o](n)}return n.detail}}})(),n=function(){let e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(r){var n,o=void 0!==(r=r||{})?r:{},i={};for(n in o)o.hasOwnProperty(n)&&(i[n]=o[n]);var a,s,u=[],l="";document.currentScript&&(l=document.currentScript.src),e&&(l=e),l=0!==l.indexOf("blob:")?l.substr(0,l.lastIndexOf("/")+1):"",a=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText};var c=o.print||console.log.bind(console),d=o.printErr||console.warn.bind(console);for(n in i)i.hasOwnProperty(n)&&(o[n]=i[n]);i=null,o.arguments&&(u=o.arguments),o.thisProgram&&o.thisProgram,o.quit&&o.quit;var f,_,p={"f64-rem":function(t,e){return t%e},debugger:function(){}};new Array(0);o.wasmBinary&&(f=o.wasmBinary),o.noExitRuntime&&o.noExitRuntime,"object"!=typeof WebAssembly&&d("no native wasm support detected");var m=!1;var h="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function g(t,e,r){for(var n=e+r,o=e;t[o]&&!(o>=n);)++o;if(o-e>16&&t.subarray&&h)return h.decode(t.subarray(e,o));for(var i="";e<o;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var u=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&t[e++])<65536)i+=String.fromCharCode(a);else{var l=a-65536;i+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else i+=String.fromCharCode((31&a)<<6|s)}else i+=String.fromCharCode(a)}return i}function w(t,e){return t?g(k,t,e):""}function y(t,e,r,n){if(!(n>0))return 0;for(var o=r,i=r+n-1,a=0;a<t.length;++a){var s=t.charCodeAt(a);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&t.charCodeAt(++a);if(s<=127){if(r>=i)break;e[r++]=s}else if(s<=2047){if(r+1>=i)break;e[r++]=192|s>>6,e[r++]=128|63&s}else if(s<=65535){if(r+2>=i)break;e[r++]=224|s>>12,e[r++]=128|s>>6&63,e[r++]=128|63&s}else{if(r+3>=i)break;e[r++]=240|s>>18,e[r++]=128|s>>12&63,e[r++]=128|s>>6&63,e[r++]=128|63&s}}return e[r]=0,r-o}function v(t){for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&t.charCodeAt(++r)),n<=127?++e:e+=n<=2047?2:n<=65535?3:4}return e}var E,b,k,D,S;"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");function T(t,e){return t%e>0&&(t+=e-t%e),t}function P(t){E=t,o.HEAP8=b=new Int8Array(t),o.HEAP16=D=new Int16Array(t),o.HEAP32=S=new Int32Array(t),o.HEAPU8=k=new Uint8Array(t),o.HEAPU16=new Uint16Array(t),o.HEAPU32=new Uint32Array(t),o.HEAPF32=new Float32Array(t),o.HEAPF64=new Float64Array(t)}var F=10848,A=o.TOTAL_MEMORY||16777216;function x(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var r=e.func;"number"==typeof r?void 0===e.arg?o.dynCall_v(r):o.dynCall_vi(r,e.arg):r(void 0===e.arg?null:e.arg)}else e()}}(_=o.wasmMemory?o.wasmMemory:new WebAssembly.Memory({initial:A/65536}))&&(E=_.buffer),A=E.byteLength,P(E),S[F>>2]=5253760;var M=[],B=[],R=[],C=[];var O=Math.abs,I=Math.ceil,N=Math.floor,z=Math.min,L=0,U=null,H=null;function j(t){L++,o.monitorRunDependencies&&o.monitorRunDependencies(L)}function W(t){if(L--,o.monitorRunDependencies&&o.monitorRunDependencies(L),0==L&&(null!==U&&(clearInterval(U),U=null),H)){var e=H;H=null,e()}}o.preloadedImages={},o.preloadedAudios={};function q(t){return String.prototype.startsWith?t.startsWith("data:application/octet-stream;base64,"):0===t.indexOf("data:application/octet-stream;base64,")}var G,X,V,K="libmfa.wasm";function $(){try{if(f)return new Uint8Array(f);if(s)return s(K);throw"both async and sync fetching of the wasm failed"}catch(t){_t(t)}}function Y(t){var e={env:t,wasi_unstable:t,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:p};function r(t,e){var r=t.exports;o.asm=r,W()}function n(t){r(t.instance)}function i(t){return(f||"function"!=typeof fetch?new Promise((function(t,e){t($())})):fetch(K,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+K+"'";return t.arrayBuffer()})).catch((function(){return $()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(t){d("failed to asynchronously prepare wasm: "+t),_t(t)}))}if(j(),o.instantiateWasm)try{return o.instantiateWasm(e,r)}catch(t){return d("Module.instantiateWasm callback failed with error: "+t),!1}return function(){if(f||"function"!=typeof WebAssembly.instantiateStreaming||q(K)||"function"!=typeof fetch)return i(n);fetch(K,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(t){d("wasm streaming compile failed: "+t),d("falling back to ArrayBuffer instantiation"),i(n)}))}))}(),{}}function Z(){var t=function(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}();return o.extraStackTrace&&(t+="\n"+o.extraStackTrace()),t.replace(/\b__Z[\w\d_]+/g,(function(t){return t==t?t:t+" ["+t+"]"}))}q(K)||(G=K,K=o.locateFile?o.locateFile(G,l):l+G),o.asm=function(t,e,r){return e.memory=_,e.table=new WebAssembly.Table({initial:26,maximum:26,element:"anyfunc"}),e.__memory_base=1024,e.__table_base=0,Y(e)};var J={splitPath:function(t){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1)},normalizeArray:function(t,e){for(var r=0,n=t.length-1;n>=0;n--){var o=t[n];"."===o?t.splice(n,1):".."===o?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r;r--)t.unshift("..");return t},normalize:function(t){var e="/"===t.charAt(0),r="/"===t.substr(-1);return(t=J.normalizeArray(t.split("/").filter((function(t){return!!t})),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t},dirname:function(t){var e=J.splitPath(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(t){if("/"===t)return"/";var e=t.lastIndexOf("/");return-1===e?t:t.substr(e+1)},extname:function(t){return J.splitPath(t)[3]},join:function(){var t=Array.prototype.slice.call(arguments,0);return J.normalize(t.join("/"))},join2:function(t,e){return J.normalize(t+"/"+e)}};function Q(t){return o.___errno_location&&(S[o.___errno_location()>>2]=t),t}var tt={resolve:function(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var n=r>=0?arguments[r]:nt.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,e="/"===n.charAt(0)}return(e?"/":"")+(t=J.normalizeArray(t.split("/").filter((function(t){return!!t})),!e).join("/"))||"."},relative:function(t,e){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=tt.resolve(t).substr(1),e=tt.resolve(e).substr(1);for(var n=r(t.split("/")),o=r(e.split("/")),i=Math.min(n.length,o.length),a=i,s=0;s<i;s++)if(n[s]!==o[s]){a=s;break}var u=[];for(s=a;s<n.length;s++)u.push("..");return(u=u.concat(o.slice(a))).join("/")}},et={ttys:[],init:function(){},shutdown:function(){},register:function(t,e){et.ttys[t]={input:[],output:[],ops:e},nt.registerDevice(t,et.stream_ops)},stream_ops:{open:function(t){var e=et.ttys[t.node.rdev];if(!e)throw new nt.ErrnoError(19);t.tty=e,t.seekable=!1},close:function(t){t.tty.ops.flush(t.tty)},flush:function(t){t.tty.ops.flush(t.tty)},read:function(t,e,r,n,o){if(!t.tty||!t.tty.ops.get_char)throw new nt.ErrnoError(6);for(var i=0,a=0;a<n;a++){var s;try{s=t.tty.ops.get_char(t.tty)}catch(t){throw new nt.ErrnoError(5)}if(void 0===s&&0===i)throw new nt.ErrnoError(11);if(null==s)break;i++,e[r+a]=s}return i&&(t.node.timestamp=Date.now()),i},write:function(t,e,r,n,o){if(!t.tty||!t.tty.ops.put_char)throw new nt.ErrnoError(6);try{for(var i=0;i<n;i++)t.tty.ops.put_char(t.tty,e[r+i])}catch(t){throw new nt.ErrnoError(5)}return n&&(t.node.timestamp=Date.now()),i}},default_tty_ops:{get_char:function(e){if(!e.input.length){var r=null;if(void 0!==t&&"function"==typeof t.prompt?null!==(r=t.prompt("Input: "))&&(r+="\n"):"function"==typeof readline&&null!==(r=readline())&&(r+="\n"),!r)return null;e.input=st(r,!0)}return e.input.shift()},put_char:function(t,e){null===e||10===e?(c(g(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(c(g(t.output,0)),t.output=[])}},default_tty1_ops:{put_char:function(t,e){null===e||10===e?(d(g(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(d(g(t.output,0)),t.output=[])}}},rt={ops_table:null,mount:function(t){return rt.createNode(null,"/",16895,0)},createNode:function(t,e,r,n){if(nt.isBlkdev(r)||nt.isFIFO(r))throw new nt.ErrnoError(1);rt.ops_table||(rt.ops_table={dir:{node:{getattr:rt.node_ops.getattr,setattr:rt.node_ops.setattr,lookup:rt.node_ops.lookup,mknod:rt.node_ops.mknod,rename:rt.node_ops.rename,unlink:rt.node_ops.unlink,rmdir:rt.node_ops.rmdir,readdir:rt.node_ops.readdir,symlink:rt.node_ops.symlink},stream:{llseek:rt.stream_ops.llseek}},file:{node:{getattr:rt.node_ops.getattr,setattr:rt.node_ops.setattr},stream:{llseek:rt.stream_ops.llseek,read:rt.stream_ops.read,write:rt.stream_ops.write,allocate:rt.stream_ops.allocate,mmap:rt.stream_ops.mmap,msync:rt.stream_ops.msync}},link:{node:{getattr:rt.node_ops.getattr,setattr:rt.node_ops.setattr,readlink:rt.node_ops.readlink},stream:{}},chrdev:{node:{getattr:rt.node_ops.getattr,setattr:rt.node_ops.setattr},stream:nt.chrdev_stream_ops}});var o=nt.createNode(t,e,r,n);return nt.isDir(o.mode)?(o.node_ops=rt.ops_table.dir.node,o.stream_ops=rt.ops_table.dir.stream,o.contents={}):nt.isFile(o.mode)?(o.node_ops=rt.ops_table.file.node,o.stream_ops=rt.ops_table.file.stream,o.usedBytes=0,o.contents=null):nt.isLink(o.mode)?(o.node_ops=rt.ops_table.link.node,o.stream_ops=rt.ops_table.link.stream):nt.isChrdev(o.mode)&&(o.node_ops=rt.ops_table.chrdev.node,o.stream_ops=rt.ops_table.chrdev.stream),o.timestamp=Date.now(),t&&(t.contents[e]=o),o},getFileDataAsRegularArray:function(t){if(t.contents&&t.contents.subarray){for(var e=[],r=0;r<t.usedBytes;++r)e.push(t.contents[r]);return e}return t.contents},getFileDataAsTypedArray:function(t){return t.contents?t.contents.subarray?t.contents.subarray(0,t.usedBytes):new Uint8Array(t.contents):new Uint8Array},expandFileStorage:function(t,e){var r=t.contents?t.contents.length:0;if(!(r>=e)){e=Math.max(e,r*(r<1048576?2:1.125)|0),0!=r&&(e=Math.max(e,256));var n=t.contents;t.contents=new Uint8Array(e),t.usedBytes>0&&t.contents.set(n.subarray(0,t.usedBytes),0)}},resizeFileStorage:function(t,e){if(t.usedBytes!=e){if(0==e)return t.contents=null,void(t.usedBytes=0);if(!t.contents||t.contents.subarray){var r=t.contents;return t.contents=new Uint8Array(new ArrayBuffer(e)),r&&t.contents.set(r.subarray(0,Math.min(e,t.usedBytes))),void(t.usedBytes=e)}if(t.contents||(t.contents=[]),t.contents.length>e)t.contents.length=e;else for(;t.contents.length<e;)t.contents.push(0);t.usedBytes=e}},node_ops:{getattr:function(t){var e={};return e.dev=nt.isChrdev(t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,nt.isDir(t.mode)?e.size=4096:nt.isFile(t.mode)?e.size=t.usedBytes:nt.isLink(t.mode)?e.size=t.link.length:e.size=0,e.atime=new Date(t.timestamp),e.mtime=new Date(t.timestamp),e.ctime=new Date(t.timestamp),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},setattr:function(t,e){void 0!==e.mode&&(t.mode=e.mode),void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.size&&rt.resizeFileStorage(t,e.size)},lookup:function(t,e){throw nt.genericErrors[2]},mknod:function(t,e,r,n){return rt.createNode(t,e,r,n)},rename:function(t,e,r){if(nt.isDir(t.mode)){var n;try{n=nt.lookupNode(e,r)}catch(t){}if(n)for(var o in n.contents)throw new nt.ErrnoError(39)}delete t.parent.contents[t.name],t.name=r,e.contents[r]=t,t.parent=e},unlink:function(t,e){delete t.contents[e]},rmdir:function(t,e){var r=nt.lookupNode(t,e);for(var n in r.contents)throw new nt.ErrnoError(39);delete t.contents[e]},readdir:function(t){var e=[".",".."];for(var r in t.contents)t.contents.hasOwnProperty(r)&&e.push(r);return e},symlink:function(t,e,r){var n=rt.createNode(t,e,41471,0);return n.link=r,n},readlink:function(t){if(!nt.isLink(t.mode))throw new nt.ErrnoError(22);return t.link}},stream_ops:{read:function(t,e,r,n,o){var i=t.node.contents;if(o>=t.node.usedBytes)return 0;var a=Math.min(t.node.usedBytes-o,n);if(a>8&&i.subarray)e.set(i.subarray(o,o+a),r);else for(var s=0;s<a;s++)e[r+s]=i[o+s];return a},write:function(t,e,r,n,o,i){if(!1,!n)return 0;var a=t.node;if(a.timestamp=Date.now(),e.subarray&&(!a.contents||a.contents.subarray)){if(0===a.usedBytes&&0===o)return a.contents=new Uint8Array(e.subarray(r,r+n)),a.usedBytes=n,n;if(o+n<=a.usedBytes)return a.contents.set(e.subarray(r,r+n),o),n}if(rt.expandFileStorage(a,o+n),a.contents.subarray&&e.subarray)a.contents.set(e.subarray(r,r+n),o);else for(var s=0;s<n;s++)a.contents[o+s]=e[r+s];return a.usedBytes=Math.max(a.usedBytes,o+n),n},llseek:function(t,e,r){var n=e;if(1===r?n+=t.position:2===r&&nt.isFile(t.node.mode)&&(n+=t.node.usedBytes),n<0)throw new nt.ErrnoError(22);return n},allocate:function(t,e,r){rt.expandFileStorage(t.node,e+r),t.node.usedBytes=Math.max(t.node.usedBytes,e+r)},mmap:function(t,e,r,n,o,i,a){if(!nt.isFile(t.node.mode))throw new nt.ErrnoError(19);var s,u,l=t.node.contents;if(2&a||l.buffer!==e&&l.buffer!==e.buffer){(o>0||o+n<t.node.usedBytes)&&(l=l.subarray?l.subarray(o,o+n):Array.prototype.slice.call(l,o,o+n)),u=!0;var c=e.buffer==b.buffer;if(!(s=dt(n)))throw new nt.ErrnoError(12);(c?b:e).set(l,s)}else u=!1,s=l.byteOffset;return{ptr:s,allocated:u}},msync:function(t,e,r,n,o){if(!nt.isFile(t.node.mode))throw new nt.ErrnoError(19);if(2&o)return 0;rt.stream_ops.write(t,e,0,n,r,!1);return 0}}},nt={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,handleFSError:function(t){if(!(t instanceof nt.ErrnoError))throw t+" : "+Z();return Q(t.errno)},lookupPath:function(t,e){if(e=e||{},!(t=tt.resolve(nt.cwd(),t)))return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===e[n]&&(e[n]=r[n]);if(e.recurse_count>8)throw new nt.ErrnoError(40);for(var o=J.normalizeArray(t.split("/").filter((function(t){return!!t})),!1),i=nt.root,a="/",s=0;s<o.length;s++){var u=s===o.length-1;if(u&&e.parent)break;if(i=nt.lookupNode(i,o[s]),a=J.join2(a,o[s]),nt.isMountpoint(i)&&(!u||u&&e.follow_mount)&&(i=i.mounted.root),!u||e.follow)for(var l=0;nt.isLink(i.mode);){var c=nt.readlink(a);if(a=tt.resolve(J.dirname(a),c),i=nt.lookupPath(a,{recurse_count:e.recurse_count}).node,l++>40)throw new nt.ErrnoError(40)}}return{path:a,node:i}},getPath:function(t){for(var e;;){if(nt.isRoot(t)){var r=t.mount.mountpoint;return e?"/"!==r[r.length-1]?r+"/"+e:r+e:r}e=e?t.name+"/"+e:t.name,t=t.parent}},hashName:function(t,e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)|0;return(t+r>>>0)%nt.nameTable.length},hashAddNode:function(t){var e=nt.hashName(t.parent.id,t.name);t.name_next=nt.nameTable[e],nt.nameTable[e]=t},hashRemoveNode:function(t){var e=nt.hashName(t.parent.id,t.name);if(nt.nameTable[e]===t)nt.nameTable[e]=t.name_next;else for(var r=nt.nameTable[e];r;){if(r.name_next===t){r.name_next=t.name_next;break}r=r.name_next}},lookupNode:function(t,e){var r=nt.mayLookup(t);if(r)throw new nt.ErrnoError(r,t);for(var n=nt.hashName(t.id,e),o=nt.nameTable[n];o;o=o.name_next){var i=o.name;if(o.parent.id===t.id&&i===e)return o}return nt.lookup(t,e)},createNode:function(t,e,r,n){if(!nt.FSNode){nt.FSNode=function(t,e,r,n){t||(t=this),this.parent=t,this.mount=t.mount,this.mounted=null,this.id=nt.nextInode++,this.name=e,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n},nt.FSNode.prototype={};Object.defineProperties(nt.FSNode.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(t){t?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(t){t?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return nt.isDir(this.mode)}},isDevice:{get:function(){return nt.isChrdev(this.mode)}}})}var o=new nt.FSNode(t,e,r,n);return nt.hashAddNode(o),o},destroyNode:function(t){nt.hashRemoveNode(t)},isRoot:function(t){return t===t.parent},isMountpoint:function(t){return!!t.mounted},isFile:function(t){return 32768==(61440&t)},isDir:function(t){return 16384==(61440&t)},isLink:function(t){return 40960==(61440&t)},isChrdev:function(t){return 8192==(61440&t)},isBlkdev:function(t){return 24576==(61440&t)},isFIFO:function(t){return 4096==(61440&t)},isSocket:function(t){return 49152==(49152&t)},flagModes:{r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218},modeStringToFlags:function(t){var e=nt.flagModes[t];if(void 0===e)throw new Error("Unknown file open mode: "+t);return e},flagsToPermissionString:function(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e},nodePermissions:function(t,e){return nt.ignorePermissions||(-1===e.indexOf("r")||292&t.mode)&&(-1===e.indexOf("w")||146&t.mode)&&(-1===e.indexOf("x")||73&t.mode)?0:13},mayLookup:function(t){var e=nt.nodePermissions(t,"x");return e||(t.node_ops.lookup?0:13)},mayCreate:function(t,e){try{nt.lookupNode(t,e);return 17}catch(t){}return nt.nodePermissions(t,"wx")},mayDelete:function(t,e,r){var n;try{n=nt.lookupNode(t,e)}catch(t){return t.errno}var o=nt.nodePermissions(t,"wx");if(o)return o;if(r){if(!nt.isDir(n.mode))return 20;if(nt.isRoot(n)||nt.getPath(n)===nt.cwd())return 16}else if(nt.isDir(n.mode))return 21;return 0},mayOpen:function(t,e){return t?nt.isLink(t.mode)?40:nt.isDir(t.mode)&&("r"!==nt.flagsToPermissionString(e)||512&e)?21:nt.nodePermissions(t,nt.flagsToPermissionString(e)):2},MAX_OPEN_FDS:4096,nextfd:function(t,e){t=t||0,e=e||nt.MAX_OPEN_FDS;for(var r=t;r<=e;r++)if(!nt.streams[r])return r;throw new nt.ErrnoError(24)},getStream:function(t){return nt.streams[t]},createStream:function(t,e,r){nt.FSStream||(nt.FSStream=function(){},nt.FSStream.prototype={},Object.defineProperties(nt.FSStream.prototype,{object:{get:function(){return this.node},set:function(t){this.node=t}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}}));var n=new nt.FSStream;for(var o in t)n[o]=t[o];t=n;var i=nt.nextfd(e,r);return t.fd=i,nt.streams[i]=t,t},closeStream:function(t){nt.streams[t]=null},chrdev_stream_ops:{open:function(t){var e=nt.getDevice(t.node.rdev);t.stream_ops=e.stream_ops,t.stream_ops.open&&t.stream_ops.open(t)},llseek:function(){throw new nt.ErrnoError(29)}},major:function(t){return t>>8},minor:function(t){return 255&t},makedev:function(t,e){return t<<8|e},registerDevice:function(t,e){nt.devices[t]={stream_ops:e}},getDevice:function(t){return nt.devices[t]},getMounts:function(t){for(var e=[],r=[t];r.length;){var n=r.pop();e.push(n),r.push.apply(r,n.mounts)}return e},syncfs:function(t,e){"function"==typeof t&&(e=t,t=!1),nt.syncFSRequests++,nt.syncFSRequests>1&&console.log("warning: "+nt.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=nt.getMounts(nt.root.mount),n=0;function o(t){return nt.syncFSRequests--,e(t)}function i(t){if(t)return i.errored?void 0:(i.errored=!0,o(t));++n>=r.length&&o(null)}r.forEach((function(e){if(!e.type.syncfs)return i(null);e.type.syncfs(e,t,i)}))},mount:function(t,e,r){var n,o="/"===r,i=!r;if(o&&nt.root)throw new nt.ErrnoError(16);if(!o&&!i){var a=nt.lookupPath(r,{follow_mount:!1});if(r=a.path,n=a.node,nt.isMountpoint(n))throw new nt.ErrnoError(16);if(!nt.isDir(n.mode))throw new nt.ErrnoError(20)}var s={type:t,opts:e,mountpoint:r,mounts:[]},u=t.mount(s);return u.mount=s,s.root=u,o?nt.root=u:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),u},unmount:function(t){var e=nt.lookupPath(t,{follow_mount:!1});if(!nt.isMountpoint(e.node))throw new nt.ErrnoError(22);var r=e.node,n=r.mounted,o=nt.getMounts(n);Object.keys(nt.nameTable).forEach((function(t){for(var e=nt.nameTable[t];e;){var r=e.name_next;-1!==o.indexOf(e.mount)&&nt.destroyNode(e),e=r}})),r.mounted=null;var i=r.mount.mounts.indexOf(n);r.mount.mounts.splice(i,1)},lookup:function(t,e){return t.node_ops.lookup(t,e)},mknod:function(t,e,r){var n=nt.lookupPath(t,{parent:!0}).node,o=J.basename(t);if(!o||"."===o||".."===o)throw new nt.ErrnoError(22);var i=nt.mayCreate(n,o);if(i)throw new nt.ErrnoError(i);if(!n.node_ops.mknod)throw new nt.ErrnoError(1);return n.node_ops.mknod(n,o,e,r)},create:function(t,e){return e=void 0!==e?e:438,e&=4095,e|=32768,nt.mknod(t,e,0)},mkdir:function(t,e){return e=void 0!==e?e:511,e&=1023,e|=16384,nt.mknod(t,e,0)},mkdirTree:function(t,e){for(var r=t.split("/"),n="",o=0;o<r.length;++o)if(r[o]){n+="/"+r[o];try{nt.mkdir(n,e)}catch(t){if(17!=t.errno)throw t}}},mkdev:function(t,e,r){return void 0===r&&(r=e,e=438),e|=8192,nt.mknod(t,e,r)},symlink:function(t,e){if(!tt.resolve(t))throw new nt.ErrnoError(2);var r=nt.lookupPath(e,{parent:!0}).node;if(!r)throw new nt.ErrnoError(2);var n=J.basename(e),o=nt.mayCreate(r,n);if(o)throw new nt.ErrnoError(o);if(!r.node_ops.symlink)throw new nt.ErrnoError(1);return r.node_ops.symlink(r,n,t)},rename:function(t,e){var r,n,o=J.dirname(t),i=J.dirname(e),a=J.basename(t),s=J.basename(e);try{r=nt.lookupPath(t,{parent:!0}).node,n=nt.lookupPath(e,{parent:!0}).node}catch(t){throw new nt.ErrnoError(16)}if(!r||!n)throw new nt.ErrnoError(2);if(r.mount!==n.mount)throw new nt.ErrnoError(18);var u,l=nt.lookupNode(r,a),c=tt.relative(t,i);if("."!==c.charAt(0))throw new nt.ErrnoError(22);if("."!==(c=tt.relative(e,o)).charAt(0))throw new nt.ErrnoError(39);try{u=nt.lookupNode(n,s)}catch(t){}if(l!==u){var d=nt.isDir(l.mode),f=nt.mayDelete(r,a,d);if(f)throw new nt.ErrnoError(f);if(f=u?nt.mayDelete(n,s,d):nt.mayCreate(n,s))throw new nt.ErrnoError(f);if(!r.node_ops.rename)throw new nt.ErrnoError(1);if(nt.isMountpoint(l)||u&&nt.isMountpoint(u))throw new nt.ErrnoError(16);if(n!==r&&(f=nt.nodePermissions(r,"w")))throw new nt.ErrnoError(f);try{nt.trackingDelegate.willMovePath&&nt.trackingDelegate.willMovePath(t,e)}catch(r){console.log("FS.trackingDelegate['willMovePath']('"+t+"', '"+e+"') threw an exception: "+r.message)}nt.hashRemoveNode(l);try{r.node_ops.rename(l,n,s)}catch(t){throw t}finally{nt.hashAddNode(l)}try{nt.trackingDelegate.onMovePath&&nt.trackingDelegate.onMovePath(t,e)}catch(r){console.log("FS.trackingDelegate['onMovePath']('"+t+"', '"+e+"') threw an exception: "+r.message)}}},rmdir:function(t){var e=nt.lookupPath(t,{parent:!0}).node,r=J.basename(t),n=nt.lookupNode(e,r),o=nt.mayDelete(e,r,!0);if(o)throw new nt.ErrnoError(o);if(!e.node_ops.rmdir)throw new nt.ErrnoError(1);if(nt.isMountpoint(n))throw new nt.ErrnoError(16);try{nt.trackingDelegate.willDeletePath&&nt.trackingDelegate.willDeletePath(t)}catch(e){console.log("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+e.message)}e.node_ops.rmdir(e,r),nt.destroyNode(n);try{nt.trackingDelegate.onDeletePath&&nt.trackingDelegate.onDeletePath(t)}catch(e){console.log("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+e.message)}},readdir:function(t){var e=nt.lookupPath(t,{follow:!0}).node;if(!e.node_ops.readdir)throw new nt.ErrnoError(20);return e.node_ops.readdir(e)},unlink:function(t){var e=nt.lookupPath(t,{parent:!0}).node,r=J.basename(t),n=nt.lookupNode(e,r),o=nt.mayDelete(e,r,!1);if(o)throw new nt.ErrnoError(o);if(!e.node_ops.unlink)throw new nt.ErrnoError(1);if(nt.isMountpoint(n))throw new nt.ErrnoError(16);try{nt.trackingDelegate.willDeletePath&&nt.trackingDelegate.willDeletePath(t)}catch(e){console.log("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+e.message)}e.node_ops.unlink(e,r),nt.destroyNode(n);try{nt.trackingDelegate.onDeletePath&&nt.trackingDelegate.onDeletePath(t)}catch(e){console.log("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+e.message)}},readlink:function(t){var e=nt.lookupPath(t).node;if(!e)throw new nt.ErrnoError(2);if(!e.node_ops.readlink)throw new nt.ErrnoError(22);return tt.resolve(nt.getPath(e.parent),e.node_ops.readlink(e))},stat:function(t,e){var r=nt.lookupPath(t,{follow:!e}).node;if(!r)throw new nt.ErrnoError(2);if(!r.node_ops.getattr)throw new nt.ErrnoError(1);return r.node_ops.getattr(r)},lstat:function(t){return nt.stat(t,!0)},chmod:function(t,e,r){var n;"string"==typeof t?n=nt.lookupPath(t,{follow:!r}).node:n=t;if(!n.node_ops.setattr)throw new nt.ErrnoError(1);n.node_ops.setattr(n,{mode:4095&e|-4096&n.mode,timestamp:Date.now()})},lchmod:function(t,e){nt.chmod(t,e,!0)},fchmod:function(t,e){var r=nt.getStream(t);if(!r)throw new nt.ErrnoError(9);nt.chmod(r.node,e)},chown:function(t,e,r,n){var o;"string"==typeof t?o=nt.lookupPath(t,{follow:!n}).node:o=t;if(!o.node_ops.setattr)throw new nt.ErrnoError(1);o.node_ops.setattr(o,{timestamp:Date.now()})},lchown:function(t,e,r){nt.chown(t,e,r,!0)},fchown:function(t,e,r){var n=nt.getStream(t);if(!n)throw new nt.ErrnoError(9);nt.chown(n.node,e,r)},truncate:function(t,e){if(e<0)throw new nt.ErrnoError(22);var r;"string"==typeof t?r=nt.lookupPath(t,{follow:!0}).node:r=t;if(!r.node_ops.setattr)throw new nt.ErrnoError(1);if(nt.isDir(r.mode))throw new nt.ErrnoError(21);if(!nt.isFile(r.mode))throw new nt.ErrnoError(22);var n=nt.nodePermissions(r,"w");if(n)throw new nt.ErrnoError(n);r.node_ops.setattr(r,{size:e,timestamp:Date.now()})},ftruncate:function(t,e){var r=nt.getStream(t);if(!r)throw new nt.ErrnoError(9);if(0==(2097155&r.flags))throw new nt.ErrnoError(22);nt.truncate(r.node,e)},utime:function(t,e,r){var n=nt.lookupPath(t,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(e,r)})},open:function(t,e,r,n,i){if(""===t)throw new nt.ErrnoError(2);var a;if(r=void 0===r?438:r,r=64&(e="string"==typeof e?nt.modeStringToFlags(e):e)?4095&r|32768:0,"object"==typeof t)a=t;else{t=J.normalize(t);try{a=nt.lookupPath(t,{follow:!(131072&e)}).node}catch(t){}}var s=!1;if(64&e)if(a){if(128&e)throw new nt.ErrnoError(17)}else a=nt.mknod(t,r,0),s=!0;if(!a)throw new nt.ErrnoError(2);if(nt.isChrdev(a.mode)&&(e&=-513),65536&e&&!nt.isDir(a.mode))throw new nt.ErrnoError(20);if(!s){var u=nt.mayOpen(a,e);if(u)throw new nt.ErrnoError(u)}512&e&&nt.truncate(a,0),e&=-641;var l=nt.createStream({node:a,path:nt.getPath(a),flags:e,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1},n,i);l.stream_ops.open&&l.stream_ops.open(l),!o.logReadFiles||1&e||(nt.readFiles||(nt.readFiles={}),t in nt.readFiles||(nt.readFiles[t]=1,console.log("FS.trackingDelegate error on read file: "+t)));try{if(nt.trackingDelegate.onOpenFile){var c=0;1!=(2097155&e)&&(c|=nt.tracking.openFlags.READ),0!=(2097155&e)&&(c|=nt.tracking.openFlags.WRITE),nt.trackingDelegate.onOpenFile(t,c)}}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return l},close:function(t){if(nt.isClosed(t))throw new nt.ErrnoError(9);t.getdents&&(t.getdents=null);try{t.stream_ops.close&&t.stream_ops.close(t)}catch(t){throw t}finally{nt.closeStream(t.fd)}t.fd=null},isClosed:function(t){return null===t.fd},llseek:function(t,e,r){if(nt.isClosed(t))throw new nt.ErrnoError(9);if(!t.seekable||!t.stream_ops.llseek)throw new nt.ErrnoError(29);if(0!=r&&1!=r&&2!=r)throw new nt.ErrnoError(22);return t.position=t.stream_ops.llseek(t,e,r),t.ungotten=[],t.position},read:function(t,e,r,n,o){if(n<0||o<0)throw new nt.ErrnoError(22);if(nt.isClosed(t))throw new nt.ErrnoError(9);if(1==(2097155&t.flags))throw new nt.ErrnoError(9);if(nt.isDir(t.node.mode))throw new nt.ErrnoError(21);if(!t.stream_ops.read)throw new nt.ErrnoError(22);var i=void 0!==o;if(i){if(!t.seekable)throw new nt.ErrnoError(29)}else o=t.position;var a=t.stream_ops.read(t,e,r,n,o);return i||(t.position+=a),a},write:function(t,e,r,n,o,i){if(n<0||o<0)throw new nt.ErrnoError(22);if(nt.isClosed(t))throw new nt.ErrnoError(9);if(0==(2097155&t.flags))throw new nt.ErrnoError(9);if(nt.isDir(t.node.mode))throw new nt.ErrnoError(21);if(!t.stream_ops.write)throw new nt.ErrnoError(22);1024&t.flags&&nt.llseek(t,0,2);var a=void 0!==o;if(a){if(!t.seekable)throw new nt.ErrnoError(29)}else o=t.position;var s=t.stream_ops.write(t,e,r,n,o,i);a||(t.position+=s);try{t.path&&nt.trackingDelegate.onWriteToFile&&nt.trackingDelegate.onWriteToFile(t.path)}catch(e){console.log("FS.trackingDelegate['onWriteToFile']('"+t.path+"') threw an exception: "+e.message)}return s},allocate:function(t,e,r){if(nt.isClosed(t))throw new nt.ErrnoError(9);if(e<0||r<=0)throw new nt.ErrnoError(22);if(0==(2097155&t.flags))throw new nt.ErrnoError(9);if(!nt.isFile(t.node.mode)&&!nt.isDir(t.node.mode))throw new nt.ErrnoError(19);if(!t.stream_ops.allocate)throw new nt.ErrnoError(95);t.stream_ops.allocate(t,e,r)},mmap:function(t,e,r,n,o,i,a){if(0!=(2&i)&&0==(2&a)&&2!=(2097155&t.flags))throw new nt.ErrnoError(13);if(1==(2097155&t.flags))throw new nt.ErrnoError(13);if(!t.stream_ops.mmap)throw new nt.ErrnoError(19);return t.stream_ops.mmap(t,e,r,n,o,i,a)},msync:function(t,e,r,n,o){return t&&t.stream_ops.msync?t.stream_ops.msync(t,e,r,n,o):0},munmap:function(t){return 0},ioctl:function(t,e,r){if(!t.stream_ops.ioctl)throw new nt.ErrnoError(25);return t.stream_ops.ioctl(t,e,r)},readFile:function(t,e){if((e=e||{}).flags=e.flags||"r",e.encoding=e.encoding||"binary","utf8"!==e.encoding&&"binary"!==e.encoding)throw new Error('Invalid encoding type "'+e.encoding+'"');var r,n=nt.open(t,e.flags),o=nt.stat(t).size,i=new Uint8Array(o);return nt.read(n,i,0,o,0),"utf8"===e.encoding?r=g(i,0):"binary"===e.encoding&&(r=i),nt.close(n),r},writeFile:function(t,e,r){(r=r||{}).flags=r.flags||"w";var n=nt.open(t,r.flags,r.mode);if("string"==typeof e){var o=new Uint8Array(v(e)+1),i=y(e,o,0,o.length);nt.write(n,o,0,i,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(e))throw new Error("Unsupported data type");nt.write(n,e,0,e.byteLength,void 0,r.canOwn)}nt.close(n)},cwd:function(){return nt.currentPath},chdir:function(t){var e=nt.lookupPath(t,{follow:!0});if(null===e.node)throw new nt.ErrnoError(2);if(!nt.isDir(e.node.mode))throw new nt.ErrnoError(20);var r=nt.nodePermissions(e.node,"x");if(r)throw new nt.ErrnoError(r);nt.currentPath=e.path},createDefaultDirectories:function(){nt.mkdir("/tmp"),nt.mkdir("/home"),nt.mkdir("/home/web_user")},createDefaultDevices:function(){var t;if(nt.mkdir("/dev"),nt.registerDevice(nt.makedev(1,3),{read:function(){return 0},write:function(t,e,r,n,o){return n}}),nt.mkdev("/dev/null",nt.makedev(1,3)),et.register(nt.makedev(5,0),et.default_tty_ops),et.register(nt.makedev(6,0),et.default_tty1_ops),nt.mkdev("/dev/tty",nt.makedev(5,0)),nt.mkdev("/dev/tty1",nt.makedev(6,0)),"object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);t=function(){return crypto.getRandomValues(e),e[0]}}t||(t=function(){_t("random_device")}),nt.createDevice("/dev","random",t),nt.createDevice("/dev","urandom",t),nt.mkdir("/dev/shm"),nt.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){nt.mkdir("/proc"),nt.mkdir("/proc/self"),nt.mkdir("/proc/self/fd"),nt.mount({mount:function(){var t=nt.createNode("/proc/self","fd",16895,73);return t.node_ops={lookup:function(t,e){var r=+e,n=nt.getStream(r);if(!n)throw new nt.ErrnoError(9);var o={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return n.path}}};return o.parent=o,o}},t}},{},"/proc/self/fd")},createStandardStreams:function(){o.stdin?nt.createDevice("/dev","stdin",o.stdin):nt.symlink("/dev/tty","/dev/stdin"),o.stdout?nt.createDevice("/dev","stdout",null,o.stdout):nt.symlink("/dev/tty","/dev/stdout"),o.stderr?nt.createDevice("/dev","stderr",null,o.stderr):nt.symlink("/dev/tty1","/dev/stderr");nt.open("/dev/stdin","r"),nt.open("/dev/stdout","w"),nt.open("/dev/stderr","w")},ensureErrnoError:function(){nt.ErrnoError||(nt.ErrnoError=function(t,e){this.node=e,this.setErrno=function(t){this.errno=t},this.setErrno(t),this.message="FS error"},nt.ErrnoError.prototype=new Error,nt.ErrnoError.prototype.constructor=nt.ErrnoError,[2].forEach((function(t){nt.genericErrors[t]=new nt.ErrnoError(t),nt.genericErrors[t].stack="<generic error, no stack>"})))},staticInit:function(){nt.ensureErrnoError(),nt.nameTable=new Array(4096),nt.mount(rt,{},"/"),nt.createDefaultDirectories(),nt.createDefaultDevices(),nt.createSpecialDirectories(),nt.filesystems={MEMFS:rt}},init:function(t,e,r){nt.init.initialized=!0,nt.ensureErrnoError(),o.stdin=t||o.stdin,o.stdout=e||o.stdout,o.stderr=r||o.stderr,nt.createStandardStreams()},quit:function(){nt.init.initialized=!1;var t=o._fflush;t&&t(0);for(var e=0;e<nt.streams.length;e++){var r=nt.streams[e];r&&nt.close(r)}},getMode:function(t,e){var r=0;return t&&(r|=365),e&&(r|=146),r},joinPath:function(t,e){var r=J.join.apply(null,t);return e&&"/"==r[0]&&(r=r.substr(1)),r},absolutePath:function(t,e){return tt.resolve(e,t)},standardizePath:function(t){return J.normalize(t)},findObject:function(t,e){var r=nt.analyzePath(t,e);return r.exists?r.object:(Q(r.error),null)},analyzePath:function(t,e){try{t=(n=nt.lookupPath(t,{follow:!e})).path}catch(t){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=nt.lookupPath(t,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=J.basename(t),n=nt.lookupPath(t,{follow:!e}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot="/"===n.path}catch(t){r.error=t.errno}return r},createFolder:function(t,e,r,n){var o=J.join2("string"==typeof t?t:nt.getPath(t),e),i=nt.getMode(r,n);return nt.mkdir(o,i)},createPath:function(t,e,r,n){t="string"==typeof t?t:nt.getPath(t);for(var o=e.split("/").reverse();o.length;){var i=o.pop();if(i){var a=J.join2(t,i);try{nt.mkdir(a)}catch(t){}t=a}}return a},createFile:function(t,e,r,n,o){var i=J.join2("string"==typeof t?t:nt.getPath(t),e),a=nt.getMode(n,o);return nt.create(i,a)},createDataFile:function(t,e,r,n,o,i){var a=e?J.join2("string"==typeof t?t:nt.getPath(t),e):t,s=nt.getMode(n,o),u=nt.create(a,s);if(r){if("string"==typeof r){for(var l=new Array(r.length),c=0,d=r.length;c<d;++c)l[c]=r.charCodeAt(c);r=l}nt.chmod(u,146|s);var f=nt.open(u,"w");nt.write(f,r,0,r.length,0,i),nt.close(f),nt.chmod(u,s)}return u},createDevice:function(t,e,r,n){var o=J.join2("string"==typeof t?t:nt.getPath(t),e),i=nt.getMode(!!r,!!n);nt.createDevice.major||(nt.createDevice.major=64);var a=nt.makedev(nt.createDevice.major++,0);return nt.registerDevice(a,{open:function(t){t.seekable=!1},close:function(t){n&&n.buffer&&n.buffer.length&&n(10)},read:function(t,e,n,o,i){for(var a=0,s=0;s<o;s++){var u;try{u=r()}catch(t){throw new nt.ErrnoError(5)}if(void 0===u&&0===a)throw new nt.ErrnoError(11);if(null==u)break;a++,e[n+s]=u}return a&&(t.node.timestamp=Date.now()),a},write:function(t,e,r,o,i){for(var a=0;a<o;a++)try{n(e[r+a])}catch(t){throw new nt.ErrnoError(5)}return o&&(t.node.timestamp=Date.now()),a}}),nt.mkdev(o,i,a)},createLink:function(t,e,r,n,o){var i=J.join2("string"==typeof t?t:nt.getPath(t),e);return nt.symlink(r,i)},forceLoadFile:function(t){if(t.isDevice||t.isFolder||t.link||t.contents)return!0;var e=!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!a)throw new Error("Cannot load without read() or XMLHttpRequest.");try{t.contents=st(a(t.url),!0),t.usedBytes=t.contents.length}catch(t){e=!1}return e||Q(5),e},createLazyFile:function(t,e,r,n,o){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(t){if(!(t>this.length-1||t<0)){var e=t%this.chunkSize,r=t/this.chunkSize|0;return this.getter(r)[e]}},i.prototype.setDataGetter=function(t){this.getter=t},i.prototype.cacheLength=function(){var t=new XMLHttpRequest;if(t.open("HEAD",r,!1),t.send(null),!(t.status>=200&&t.status<300||304===t.status))throw new Error("Couldn't load "+r+". Status: "+t.status);var e,n=Number(t.getResponseHeader("Content-length")),o=(e=t.getResponseHeader("Accept-Ranges"))&&"bytes"===e,i=(e=t.getResponseHeader("Content-Encoding"))&&"gzip"===e,a=1048576;o||(a=n);var s=this;s.setDataGetter((function(t){var e=t*a,o=(t+1)*a-1;if(o=Math.min(o,n-1),void 0===s.chunks[t]&&(s.chunks[t]=function(t,e){if(t>e)throw new Error("invalid range ("+t+", "+e+") or no bytes requested!");if(e>n-1)throw new Error("only "+n+" bytes available! programmer error!");var o=new XMLHttpRequest;if(o.open("GET",r,!1),n!==a&&o.setRequestHeader("Range","bytes="+t+"-"+e),"undefined"!=typeof Uint8Array&&(o.responseType="arraybuffer"),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.send(null),!(o.status>=200&&o.status<300||304===o.status))throw new Error("Couldn't load "+r+". Status: "+o.status);return void 0!==o.response?new Uint8Array(o.response||[]):st(o.responseText||"",!0)}(e,o)),void 0===s.chunks[t])throw new Error("doXHR failed!");return s.chunks[t]})),!i&&n||(a=n=1,n=this.getter(0).length,a=n,console.log("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a={isDevice:!1,url:r},s=nt.createFile(t,e,a,n,o);a.contents?s.contents=a.contents:a.url&&(s.contents=null,s.url=a.url),Object.defineProperties(s,{usedBytes:{get:function(){return this.contents.length}}});var u={};return Object.keys(s.stream_ops).forEach((function(t){var e=s.stream_ops[t];u[t]=function(){if(!nt.forceLoadFile(s))throw new nt.ErrnoError(5);return e.apply(null,arguments)}})),u.read=function(t,e,r,n,o){if(!nt.forceLoadFile(s))throw new nt.ErrnoError(5);var i=t.node.contents;if(o>=i.length)return 0;var a=Math.min(i.length-o,n);if(i.slice)for(var u=0;u<a;u++)e[r+u]=i[o+u];else for(u=0;u<a;u++)e[r+u]=i.get(o+u);return a},s.stream_ops=u,s},createPreloadedFile:function(t,e,r,n,i,a,s,u,l,c){Browser.init();var d=e?tt.resolve(J.join2(t,e)):t;function f(r){function f(r){c&&c(),u||nt.createDataFile(t,e,r,n,i,l),a&&a(),W()}var _=!1;o.preloadPlugins.forEach((function(t){_||t.canHandle(d)&&(t.handle(r,d,f,(function(){s&&s(),W()})),_=!0)})),_||f(r)}j(),"string"==typeof r?Browser.asyncLoad(r,(function(t){f(t)}),s):f(r)},indexedDB:function(){return t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB},DB_NAME:function(){return"EM_FS_"+t.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(t,e,r){e=e||function(){},r=r||function(){};var n=nt.indexedDB();try{var o=n.open(nt.DB_NAME(),nt.DB_VERSION)}catch(t){return r(t)}o.onupgradeneeded=function(){console.log("creating db"),o.result.createObjectStore(nt.DB_STORE_NAME)},o.onsuccess=function(){var n=o.result.transaction([nt.DB_STORE_NAME],"readwrite"),i=n.objectStore(nt.DB_STORE_NAME),a=0,s=0,u=t.length;function l(){0==s?e():r()}t.forEach((function(t){var e=i.put(nt.analyzePath(t).object.contents,t);e.onsuccess=function(){++a+s==u&&l()},e.onerror=function(){s++,a+s==u&&l()}})),n.onerror=r},o.onerror=r},loadFilesFromDB:function(t,e,r){e=e||function(){},r=r||function(){};var n=nt.indexedDB();try{var o=n.open(nt.DB_NAME(),nt.DB_VERSION)}catch(t){return r(t)}o.onupgradeneeded=r,o.onsuccess=function(){var n=o.result;try{var i=n.transaction([nt.DB_STORE_NAME],"readonly")}catch(t){return void r(t)}var a=i.objectStore(nt.DB_STORE_NAME),s=0,u=0,l=t.length;function c(){0==u?e():r()}t.forEach((function(t){var e=a.get(t);e.onsuccess=function(){nt.analyzePath(t).exists&&nt.unlink(t),nt.createDataFile(J.dirname(t),J.basename(t),e.result,!0,!0,!0),++s+u==l&&c()},e.onerror=function(){u++,s+u==l&&c()}})),i.onerror=r},o.onerror=r}},ot={DEFAULT_POLLMASK:5,mappings:{},umask:511,calculateAt:function(t,e){if("/"!==e[0]){var r;if(-100===t)r=nt.cwd();else{var n=nt.getStream(t);if(!n)throw new nt.ErrnoError(9);r=n.path}e=J.join2(r,e)}return e},doStat:function(t,e,r){try{var n=t(e)}catch(t){if(t&&t.node&&J.normalize(e)!==J.normalize(nt.getPath(t.node)))return-20;throw t}return S[r>>2]=n.dev,S[r+4>>2]=0,S[r+8>>2]=n.ino,S[r+12>>2]=n.mode,S[r+16>>2]=n.nlink,S[r+20>>2]=n.uid,S[r+24>>2]=n.gid,S[r+28>>2]=n.rdev,S[r+32>>2]=0,V=[n.size>>>0,(X=n.size,+O(X)>=1?X>0?(0|z(+N(X/4294967296),4294967295))>>>0:~~+I((X-+(~~X>>>0))/4294967296)>>>0:0)],S[r+40>>2]=V[0],S[r+44>>2]=V[1],S[r+48>>2]=4096,S[r+52>>2]=n.blocks,S[r+56>>2]=n.atime.getTime()/1e3|0,S[r+60>>2]=0,S[r+64>>2]=n.mtime.getTime()/1e3|0,S[r+68>>2]=0,S[r+72>>2]=n.ctime.getTime()/1e3|0,S[r+76>>2]=0,V=[n.ino>>>0,(X=n.ino,+O(X)>=1?X>0?(0|z(+N(X/4294967296),4294967295))>>>0:~~+I((X-+(~~X>>>0))/4294967296)>>>0:0)],S[r+80>>2]=V[0],S[r+84>>2]=V[1],0},doMsync:function(t,e,r,n){var o=new Uint8Array(k.subarray(t,t+r));nt.msync(e,o,0,r,n)},doMkdir:function(t,e){return"/"===(t=J.normalize(t))[t.length-1]&&(t=t.substr(0,t.length-1)),nt.mkdir(t,e,0),0},doMknod:function(t,e,r){switch(61440&e){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-22}return nt.mknod(t,e,r),0},doReadlink:function(t,e,r){if(r<=0)return-22;var n=nt.readlink(t),o=Math.min(r,v(n)),i=b[e+o];return y(n,k,e,r+1),b[e+o]=i,o},doAccess:function(t,e){if(-8&e)return-22;var r;if(!(r=nt.lookupPath(t,{follow:!0}).node))return-2;var n="";return 4&e&&(n+="r"),2&e&&(n+="w"),1&e&&(n+="x"),n&&nt.nodePermissions(r,n)?-13:0},doDup:function(t,e,r){var n=nt.getStream(r);return n&&nt.close(n),nt.open(t,e,0,r,r).fd},doReadv:function(t,e,r,n){for(var o=0,i=0;i<r;i++){var a=S[e+8*i>>2],s=S[e+(8*i+4)>>2],u=nt.read(t,b,a,s,n);if(u<0)return-1;if(o+=u,u<s)break}return o},doWritev:function(t,e,r,n){for(var o=0,i=0;i<r;i++){var a=S[e+8*i>>2],s=S[e+(8*i+4)>>2],u=nt.write(t,b,a,s,n);if(u<0)return-1;o+=u}return o},varargs:0,get:function(t){return ot.varargs+=4,S[ot.varargs-4>>2]},getStr:function(){return w(ot.get())},getStreamFromFD:function(){var t=nt.getStream(ot.get());if(!t)throw new nt.ErrnoError(9);return t},get64:function(){var t=ot.get();ot.get();return t},getZero:function(){ot.get()}};function it(t,e,r,n){try{if(!(t=nt.getStream(t)))throw new nt.ErrnoError(9);var o=ot.doWritev(t,e,r);return S[n>>2]=o,0}catch(t){return void 0!==nt&&t instanceof nt.ErrnoError||_t(t),-t.errno}}function at(){return b.length}function st(t,e,r){var n=r>0?r:v(t)+1,o=new Array(n),i=y(t,o,0,o.length);return e&&(o.length=i),o}nt.staticInit();var ut={b:_t,p:function(){},f:Q,j:function(t,e){ot.varargs=e;try{var r=ot.getStreamFromFD(),n=ot.get(),o=ot.get(),i=ot.get(),a=ot.get(),s=4294967296*n+(o>>>0);return s<=-9007199254740992||s>=9007199254740992?-75:(nt.llseek(r,s,a),V=[r.position>>>0,(X=r.position,+O(X)>=1?X>0?(0|z(+N(X/4294967296),4294967295))>>>0:~~+I((X-+(~~X>>>0))/4294967296)>>>0:0)],S[i>>2]=V[0],S[i+4>>2]=V[1],r.getdents&&0===s&&0===a&&(r.getdents=null),0)}catch(t){return void 0!==nt&&t instanceof nt.ErrnoError||_t(t),-t.errno}},i:function(t,e){ot.varargs=e;try{var r=ot.getStreamFromFD(),n=ot.get(),o=ot.get();return ot.doReadv(r,n,o)}catch(t){return void 0!==nt&&t instanceof nt.ErrnoError||_t(t),-t.errno}},c:function(t,e){ot.varargs=e;try{var r=ot.getStreamFromFD();switch(ot.get()){case 0:return(n=ot.get())<0?-22:nt.open(r.path,r.flags,0,n).fd;case 1:case 2:return 0;case 3:return r.flags;case 4:var n=ot.get();return r.flags|=n,0;case 12:n=ot.get();return D[n+0>>1]=2,0;case 13:case 14:return 0;case 16:case 8:return-22;case 9:return Q(22),-1;default:return-22}}catch(t){return void 0!==nt&&t instanceof nt.ErrnoError||_t(t),-t.errno}},h:function(t,e){ot.varargs=e;try{var r=ot.getStr(),n=ot.get(),o=ot.get();return nt.open(r,n,o).fd}catch(t){return void 0!==nt&&t instanceof nt.ErrnoError||_t(t),-t.errno}},g:function(t,e){ot.varargs=e;try{var r=ot.getStreamFromFD(),n=ot.get();switch(n){case 21509:case 21505:return r.tty?0:-25;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return r.tty?0:-25;case 21519:if(!r.tty)return-25;var o=ot.get();return S[o>>2]=0,0;case 21520:return r.tty?-22:-25;case 21531:o=ot.get();return nt.ioctl(r,n,o);case 21523:case 21524:return r.tty?0:-25;default:_t("bad ioctl syscall "+n)}}catch(t){return void 0!==nt&&t instanceof nt.ErrnoError||_t(t),-t.errno}},e:function(t,e){ot.varargs=e;try{var r=ot.getStreamFromFD();return nt.close(r),0}catch(t){return void 0!==nt&&t instanceof nt.ErrnoError||_t(t),-t.errno}},d:function(){},o:function(){return it.apply(null,arguments)},n:at,m:function(t,e,r){k.set(k.subarray(e,e+r),t)},l:function(t){var e=at();if(t>2147418112)return!1;for(var r=Math.max(e,16777216);r<t;)r=r<=536870912?T(2*r,65536):Math.min(T((3*r+2147483648)/4,65536),2147418112);return!!function(t){try{return _.grow(t-E.byteLength+65535>>16),P(_.buffer),1}catch(t){}}(r)},k:function(t){_t("OOM")},a:F},lt=o.asm({},ut,E);o.asm=lt;o.___errno_location=function(){return o.asm.q.apply(null,arguments)},o._free=function(){return o.asm.r.apply(null,arguments)};var ct,dt=o._malloc=function(){return o.asm.s.apply(null,arguments)};o._mid_alloc_options=function(){return o.asm.t.apply(null,arguments)},o._mid_exit=function(){return o.asm.u.apply(null,arguments)},o._mid_get_load_request=function(){return o.asm.v.apply(null,arguments)},o._mid_get_load_request_count=function(){return o.asm.w.apply(null,arguments)},o._mid_init=function(){return o.asm.x.apply(null,arguments)},o._mid_istream_close=function(){return o.asm.y.apply(null,arguments)},o._mid_istream_open_mem=function(){return o.asm.z.apply(null,arguments)},o._mid_song_free=function(){return o.asm.A.apply(null,arguments)},o._mid_song_get_time=function(){return o.asm.B.apply(null,arguments)},o._mid_song_get_total_time=function(){return o.asm.C.apply(null,arguments)},o._mid_song_load=function(){return o.asm.D.apply(null,arguments)},o._mid_song_read_wave=function(){return o.asm.E.apply(null,arguments)},o._mid_song_seek=function(){return o.asm.F.apply(null,arguments)},o._mid_song_start=function(){return o.asm.G.apply(null,arguments)},o.stackAlloc=function(){return o.asm.H.apply(null,arguments)};function ft(t){function e(){ct||(ct=!0,m||(!0,o.noFSInit||nt.init.initialized||nt.init(),et.init(),x(B),nt.ignorePermissions=!1,x(R),o.onRuntimeInitialized&&o.onRuntimeInitialized(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)t=o.postRun.shift(),C.unshift(t);var t;x(C)}()))}t=t||u,L>0||(!function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)t=o.preRun.shift(),M.unshift(t);var t;x(M)}(),L>0||(o.setStatus?(o.setStatus("Running..."),setTimeout((function(){setTimeout((function(){o.setStatus("")}),1),e()}),1)):e()))}function _t(t){throw o.onAbort&&o.onAbort(t),c(t+=""),d(t),m=!0,1,"abort("+t+"). Build with -s ASSERTIONS=1 for more info."}if(o.asm=lt,o.UTF8ToString=w,o.FS=nt,o.then=function(t){if(ct)t(o);else{var e=o.onRuntimeInitialized;o.onRuntimeInitialized=function(){e&&e(),t(o)}}return o},H=function t(){ct||ft(),ct||(H=t)},o.run=ft,o.abort=_t,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return!0,ft(),r}}(),o=t.AudioContext||t.webkitAudioContext;class i{constructor(e){this.destroyed=!1,this._options={baseUrl:"/",instruments:"/",...e},this._options.baseUrl.endsWith("/")||(this._options.baseUrl+="/"),this._options.baseUrl=new URL(this._options.baseUrl,t.location.origin).href,this._options.instruments=new URL(this._options.instruments,t.location.origin).href,this._ready=!1,this._playing=!1,this._pendingFetches={},this._songPtr=0,this._bufferPtr=0,this._array=new Int16Array(32768),this._currentUrlOrBuf=null,this._interval=null,this.on=r.on,this.off=r.off,this.once=r.once,this._startInterval=this._startInterval.bind(this),this._stopInterval=this._stopInterval.bind(this),this._audioContext=new o,this._node=this._audioContext.createScriptProcessor(16384,0,2),this._onAudioProcess=this._onAudioProcess.bind(this),this._node.addEventListener("audioprocess",this._onAudioProcess),this._node.connect(this._audioContext.destination),this._lib=n({locateFile:t=>new URL(t,this._options.baseUrl).href,onRuntimeInitialized:()=>this._onLibReady()})}_onLibReady(){if(this._lib.FS.writeFile("/timidity.cfg","\ndrumset 0\n\n 25\tDrum_000/025_Snare_Roll.pat \n 26\tDrum_000/026_Snap.pat \n 27\tDrum_000/027_High_Q.pat \n 31\tDrum_000/031_Sticks.pat \n 32\tDrum_000/032_Square_Click.pat \n 33\tDrum_000/033_Metronome_Click.pat \n 34\tDrum_000/034_Metronome_Bell.pat \n 35\tDrum_000/035_Kick_1.pat amp=100\n 36\tDrum_000/036_Kick_2.pat amp=100\n 37\tDrum_000/037_Stick_Rim.pat \n 38\tDrum_000/038_Snare_1.pat \n 39\tDrum_000/039_Clap_Hand.pat amp=100\n 40\tDrum_000/040_Snare_2.pat \n 41\tDrum_000/041_Tom_Low_2.pat amp=100\n 42\tDrum_000/042_Hi-Hat_Closed.pat \n 43\tDrum_000/043_Tom_Low_1.pat amp=100\n 44\tDrum_000/044_Hi-Hat_Pedal.pat \n 45\tDrum_000/045_Tom_Mid_2.pat amp=100\n 46\tDrum_000/046_Hi-Hat_Open.pat \n 47\tDrum_000/047_Tom_Mid_1.pat amp=100\n 48\tDrum_000/048_Tom_High_2.pat amp=100\n 49\tDrum_000/049_Cymbal_Crash_1.pat \n 50\tDrum_000/050_Tom_High_1.pat amp=100\n 51\tDrum_000/051_Cymbal_Ride_1.pat \n 52\tDrum_000/052_Cymbal_Chinese.pat \n 53\tDrum_000/053_Cymbal_Ride_Bell.pat amp=100\n 54\tDrum_000/054_Tombourine.pat \n 55\tDrum_000/055_Cymbal_Splash.pat \n 56\tDrum_000/056_Cow_Bell.pat \n 57\tDrum_000/057_Cymbal_Crash_2.pat \n 58\tDrum_000/058_Vibra-Slap.pat \n 59\tDrum_000/059_Cymbal_Ride_2.pat \n 60\tDrum_000/060_Bongo_High.pat \n 61\tDrum_000/061_Bongo_Low.pat \n 62\tDrum_000/062_Conga_High_1_Mute.pat \n 63\tDrum_000/063_Conga_High_2_Open.pat \n 64\tDrum_000/064_Conga_Low.pat \n 65\tDrum_000/065_Timbale_High.pat \n 66\tDrum_000/066_Timbale_Low.pat \n 67\tDrum_000/067_Agogo_High.pat \n 68\tDrum_000/068_Agogo_Low.pat \n 69\tDrum_000/069_Cabasa.pat amp=100\n 70\tDrum_000/070_Maracas.pat \n 71\tDrum_000/071_Whistle_1_High_Short.pat \n 72\tDrum_000/072_Whistle_2_Low_Long.pat \n 73\tDrum_000/073_Guiro_1_Short.pat \n 74\tDrum_000/074_Guiro_2_Long.pat \n 75\tDrum_000/075_Claves.pat amp=100\n 76\tDrum_000/076_Wood_Block_1_High.pat \n 77\tDrum_000/077_Wood_Block_2_Low.pat \n 78\tDrum_000/078_Cuica_1_Mute.pat amp=100\n 79\tDrum_000/079_Cuica_2_Open.pat amp=100\n 80\tDrum_000/080_Triangle_1_Mute.pat \n 81\tDrum_000/081_Triangle_2_Open.pat \n 82\tDrum_000/082_Shaker.pat \n 84\tDrum_000/084_Belltree.pat \n\nbank 0\n\n 0\tTone_000/000_Acoustic_Grand_Piano.pat amp=120 pan=center\n 1\tTone_000/001_Acoustic_Brite_Piano.pat \n 2\tTone_000/002_Electric_Grand_Piano.pat \n 4\tTone_000/004_Electric_Piano_1_Rhodes.pat \n 5\tTone_000/005_Electric_Piano_2_Chorused_Yamaha_DX.pat \n 6\tTone_000/006_Harpsichord.pat \n 7\tTone_000/007_Clavinet.pat \n 8\tTone_000/008_Celesta.pat \n 9\tTone_000/009_Glockenspiel.pat \n 13\tTone_000/013_Xylophone.pat \n 14\tTone_000/014_Tubular_Bells.pat \n 15\tTone_000/015_Dulcimer.pat \n 16\tTone_000/016_Hammond_Organ.pat \n 19\tTone_000/019_Church_Organ.pat \n 21\tTone_000/021_Accordion.pat \n 23\tTone_000/023_Tango_Accordion.pat \n 24\tTone_000/024_Nylon_Guitar.pat \n 25\tTone_000/025_Steel_Guitar.pat \n 26\tTone_000/026_Jazz_Guitar.pat \n 27\tTone_000/027_Clean_Electric_Guitar.pat \n 28\tTone_000/028_Muted_Electric_Guitar.pat \n 29\tTone_000/029_Overdriven_Guitar.pat \n 30\tTone_000/030_Distortion_Guitar.pat \n 32\tTone_000/032_Acoustic_Bass.pat \n 33\tTone_000/033_Finger_Bass.pat \n 34\tTone_000/034_Pick_Bass.pat \n 35\tTone_000/035_Fretless_Bass.pat \n 36\tTone_000/036_Slap_Bass_1.pat \n 37\tTone_000/037_Slap_Bass_2.pat \n 38\tTone_000/038_Synth_Bass_1.pat \n 40\tTone_000/040_Violin.pat \n 42\tTone_000/042_Cello.pat \n 44\tTone_000/044_Tremolo_Strings.pat \n 45\tTone_000/045_Pizzicato_Strings.pat \n 46\tTone_000/046_Harp.pat \n 47\tTone_000/047_Timpani.pat \n 48\tTone_000/048_String_Ensemble_1_Marcato.pat \n 53\tTone_000/053_Voice_Oohs.pat \n 56\tTone_000/056_Trumpet.pat \n 57\tTone_000/057_Trombone.pat \n 58\tTone_000/058_Tuba.pat \n 59\tTone_000/059_Muted_Trumpet.pat \n 60\tTone_000/060_French_Horn.pat \n 61\tTone_000/061_Brass_Section.pat \n 64\tTone_000/064_Soprano_Sax.pat \n 65\tTone_000/065_Alto_Sax.pat \n 66\tTone_000/066_Tenor_Sax.pat \n 67\tTone_000/067_Baritone_Sax.pat \n 68\tTone_000/068_Oboe.pat \n 69\tTone_000/069_English_Horn.pat \n 70\tTone_000/070_Bassoon.pat \n 71\tTone_000/071_Clarinet.pat \n 72\tTone_000/072_Piccolo.pat \n 73\tTone_000/073_Flute.pat \n 74\tTone_000/074_Recorder.pat \n 75\tTone_000/075_Pan_Flute.pat \n 76\tTone_000/076_Bottle_Blow.pat \n 79\tTone_000/079_Ocarina.pat \n 80\tTone_000/080_Square_Wave.pat \n 84\tTone_000/084_Charang.pat \n 88\tTone_000/088_New_Age.pat \n 94\tTone_000/094_Halo_Pad.pat \n 95\tTone_000/095_Sweep_Pad.pat \n 98\tTone_000/098_Crystal.pat \n 101\tTone_000/101_Goblins--Unicorn.pat \n 102\tTone_000/102_Echo_Voice.pat \n 104\tTone_000/104_Sitar.pat \n 114\tTone_000/114_Steel_Drums.pat \n 115\tTone_000/115_Wood_Block.pat \n 120\tTone_000/120_Guitar_Fret_Noise.pat \n 122\tTone_000/122_Seashore.pat \n 125\tTone_000/125_Helicopter.pat \n\n"),0!==this._lib._mid_init("/timidity.cfg"))return this._destroy(new Error("Failed to initialize libmfa"));this._bufferPtr=this._lib._malloc(65536),this._ready=!0,r.emit("_ready")}async load(t){if(this.destroyed)throw new Error("load() called after destroy()");if(this._audioContext.resume(),this._songPtr&&this._destroySong(),r.emit("unstarted"),this._stopInterval(),!this._ready)return r.once("_ready",()=>this.load(t));let e;if(r.emit("buffering"),this._currentUrlOrBuf=t,"string"==typeof t){if(e=await this._fetch(new URL("/"===t.slice(0,1)?t:this._options.baseUrl+t,this._options.baseUrl)),this._currentUrlOrBuf!==t)return}else{if(!(t instanceof Uint8Array))throw new Error("load() expects a `string` or `Uint8Array` argument");e=t}let n=this._loadSong(e),o=this._lib._mid_get_load_request_count(n);if(o>0){let r=this._getMissingInstruments(n,o);if(await Promise.all(r.map(t=>this._fetchInstrument(t))),this._currentUrlOrBuf!==t)return;this._lib._mid_song_free(n),n=this._loadSong(e),o=this._lib._mid_get_load_request_count(n),o>0&&(r=this._getMissingInstruments(n,o))}this._songPtr=n,this._lib._mid_song_start(this._songPtr)}_getMissingInstruments(t,e){let r=[];for(let n=0;n<e;n++){let e=this._lib._mid_get_load_request(t,n),o=this._lib.UTF8ToString(e);r.push(o)}return r}_loadSong(t){let e=this._lib._mid_alloc_options(44100,32784,2,16384),r=this._lib._malloc(t.byteLength);this._lib.HEAPU8.set(t,r);let n=this._lib._mid_istream_open_mem(r,t.byteLength),o=this._lib._mid_song_load(n,e);return this._lib._mid_istream_close(n),this._lib._free(e),this._lib._free(r),0===o?this._destroy(new Error("Failed to load MIDI file")):o}async _fetchInstrument(t){if(this._pendingFetches[t])return this._pendingFetches[t];let e=new URL(t,this._options.instruments),r=this._fetch(e);this._pendingFetches[t]=r;let n=await r;return this._writeInstrumentFile(t,n),delete this._pendingFetches[t],n}_writeInstrumentFile(t,e){let r=t.split("/").slice(0,-1).join("/");this._mkdirp(r),this._lib.FS.writeFile(t,e,{encoding:"binary"})}_mkdirp(t){let e=t.split("/"),r="/";for(let t=0;t<e.length;t++){let n=e[t];try{this._lib.FS.mkdir(`${r}${n}`)}catch(t){}r+=n+"/"}}async _fetch(e){let r=await t.fetch(e,{mode:"cors",credentials:"same-origin"});if(200!==r.status)throw new Error("Could not load "+e);let n=await r.arrayBuffer();return new Uint8Array(n)}play(){if(this.destroyed)throw new Error("play() called after destroy()");this._audioContext.resume(),this._playing=!0,this._ready&&!this._currentUrlOrBuf&&(r.emit("playing"),this._startInterval())}_onAudioProcess(t){let e=this._songPtr&&this._playing?this._readMidiData():0;e>0&&this._currentUrlOrBuf&&(this._currentUrlOrBuf=null,r.emit("playing"),this._startInterval());let n=t.outputBuffer.getChannelData(0),o=t.outputBuffer.getChannelData(1);for(let t=0;t<e;t++)n[t]=this._array[2*t]/32767,o[t]=this._array[2*t+1]/32767;for(let t=e;t<16384;t++)n[t]=0,o[t]=0;this._songPtr&&this._playing&&0===e&&(this.seek(0),this.pause(),this._lib._mid_song_start(this._songPtr),r.emit("ended"))}_readMidiData(){let t=this._lib._mid_song_read_wave(this._songPtr,this._bufferPtr,65536),e=t/4;return 0===e?0:(this._array.set(this._lib.HEAP16.subarray(this._bufferPtr/2,(this._bufferPtr+t)/2)),e)}pause(){if(this.destroyed)throw new Error("pause() called after destroy()");this._playing=!1,this._stopInterval(),r.emit("paused")}seek(t){if(this.destroyed)throw new Error("seek() called after destroy()");if(!this._songPtr)return;let e=Math.floor(1e3*t);this._lib._mid_song_seek(this._songPtr,e),this._onTimeupdate()}get currentTime(){return this.destroyed||!this._songPtr?0:this._lib._mid_song_get_time(this._songPtr)/1e3}get duration(){return this.destroyed||!this._songPtr?1:this._lib._mid_song_get_total_time(this._songPtr)/1e3}_onTimeupdate(){r.emit("timeupdate",this.currentTime)}_startInterval(){this._onTimeupdate(),this._interval=setInterval(()=>this._onTimeupdate(),1e3)}_stopInterval(){this._onTimeupdate(),clearInterval(this._interval),this._interval=null}destroy(){if(this.destroyed)throw new Error("destroy() called after destroy()");this._destroy()}_destroy(t){this.destroyed||(this.destroyed=!0,this._stopInterval(),this._array=null,this._songPtr&&this._destroySong(),this._bufferPtr&&(this._lib._free(this._bufferPtr),this._bufferPtr=0),this._node&&(this._node.disconnect(),this._node.removeEventListener("audioprocess",this._onAudioProcess)),this._audioContext&&this._audioContext.close(),t&&r.emit("error",t))}_destroySong(){this._lib._mid_song_free(this._songPtr),this._songPtr=0}}t.MidiFurAlles=t.MidiFurAlles||i,e.exports=i}("undefined"!=typeof window?window:{},"undefined"!=typeof module?module:{});