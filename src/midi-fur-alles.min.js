!function(e,t){const r=e.AudioContext||e.webkitAudioContext,n=function(t){t=t||{};let r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,n=void 0!==t?t:{};var o,i;n.ready=new Promise((function(e,t){o=e,i=t}));var a,s={};for(a in n)n.hasOwnProperty(a)&&(s[a]=n[a]);var u,l,c=[],d="";document.currentScript&&(d=document.currentScript.src),r&&(d=r),d=0!==d.indexOf("blob:")?d.substr(0,d.lastIndexOf("/")+1):"",u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText};var _,f,p=n.print||console.log.bind(console),h=n.printErr||console.warn.bind(console);for(a in s)s.hasOwnProperty(a)&&(n[a]=s[a]);s=null,n.arguments&&(c=n.arguments),n.thisProgram&&n.thisProgram,n.quit&&n.quit,n.wasmBinary&&(_=n.wasmBinary),n.noExitRuntime&&n.noExitRuntime,"object"!=typeof WebAssembly&&X("no native wasm support detected");var m,g,w,v,y,E=new WebAssembly.Table({initial:15,maximum:15,element:"anyfunc"}),k=!1,b="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function D(e,t,r){for(var n=t+r,o=t;e[o]&&!(o>=n);)++o;if(o-t>16&&e.subarray&&b)return b.decode(e.subarray(t,o));for(var i="";t<o;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var u=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(a);else{var l=a-65536;i+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else i+=String.fromCharCode((31&a)<<6|s)}else i+=String.fromCharCode(a)}return i}function S(e,t){return e?D(w,e,t):""}function F(e,t,r,n){if(!(n>0))return 0;for(var o=r,i=r+n-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(r>=i)break;t[r++]=s}else if(s<=2047){if(r+1>=i)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=i)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=i)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-o}function P(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}function T(e){m=e,n.HEAP8=g=new Int8Array(e),n.HEAP16=v=new Int16Array(e),n.HEAP32=y=new Int32Array(e),n.HEAPU8=w=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}var A=10736,x=n.INITIAL_MEMORY||16777216;function C(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?n.dynCall_v(r):n.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t(n)}}(f=n.wasmMemory?n.wasmMemory:new WebAssembly.Memory({initial:x/65536,maximum:32768}))&&(m=f.buffer),x=m.byteLength,T(m),y[A>>2]=5253776;var M=[],R=[],B=[],L=[],N=!1,O=Math.abs,z=Math.ceil,H=Math.floor,U=Math.min,I=0,j=null,W=null;function q(e){I++,n.monitorRunDependencies&&n.monitorRunDependencies(I)}function G(e){if(I--,n.monitorRunDependencies&&n.monitorRunDependencies(I),0==I&&(null!==j&&(clearInterval(j),j=null),W)){var t=W;W=null,t()}}function X(e){n.onAbort&&n.onAbort(e),h(e+=""),k=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}function V(e){return t=e,r="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(r):0===t.indexOf(r);var t,r}n.preloadedImages={},n.preloadedAudios={};var K,$,Y,J="libmfa.wasm";function Q(){try{if(_)return new Uint8Array(_);if(l)return l(J);throw"both async and sync fetching of the wasm failed"}catch(e){X(e)}}function Z(){var e=function(){var e=new Error;if(!e.stack){try{throw new Error}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}();return n.extraStackTrace&&(e+="\n"+n.extraStackTrace()),e.replace(/\b_Z[\w\d_]+/g,(function(e){return e==e?e:e+" ["+e+"]"}))}function ee(e){return y[pe()>>2]=e,e}V(J)||(K=J,J=n.locateFile?n.locateFile(K,d):d+K),R.push({func:function(){_e()}});var te={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var r=0,n=e.length-1;n>=0;n--){var o=e[n];"."===o?e.splice(n,1):".."===o?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=te.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=te.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(e){if("/"===e)return"/";var t=e.lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return te.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return te.normalize(e.join("/"))},join2:function(e,t){return te.normalize(e+"/"+t)}},re={resolve:function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:ie.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,t="/"===n.charAt(0)}return(t?"/":"")+(e=te.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."},relative:function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=re.resolve(e).substr(1),t=re.resolve(t).substr(1);for(var n=r(e.split("/")),o=r(t.split("/")),i=Math.min(n.length,o.length),a=i,s=0;s<i;s++)if(n[s]!==o[s]){a=s;break}var u=[];for(s=a;s<n.length;s++)u.push("..");return(u=u.concat(o.slice(a))).join("/")}},ne={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){ne.ttys[e]={input:[],output:[],ops:t},ie.registerDevice(e,ne.stream_ops)},stream_ops:{open:function(e){var t=ne.ttys[e.node.rdev];if(!t)throw new ie.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,r,n,o){if(!e.tty||!e.tty.ops.get_char)throw new ie.ErrnoError(60);for(var i=0,a=0;a<n;a++){var s;try{s=e.tty.ops.get_char(e.tty)}catch(e){throw new ie.ErrnoError(29)}if(void 0===s&&0===i)throw new ie.ErrnoError(6);if(null==s)break;i++,t[r+a]=s}return i&&(e.node.timestamp=Date.now()),i},write:function(e,t,r,n,o){if(!e.tty||!e.tty.ops.put_char)throw new ie.ErrnoError(60);try{for(var i=0;i<n;i++)e.tty.ops.put_char(e.tty,t[r+i])}catch(e){throw new ie.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),i}},default_tty_ops:{get_char:function(t){if(!t.input.length){var r=null;if(void 0!==e&&"function"==typeof e.prompt?null!==(r=e.prompt("Input: "))&&(r+="\n"):"function"==typeof readline&&null!==(r=readline())&&(r+="\n"),!r)return null;t.input=le(r,!0)}return t.input.shift()},put_char:function(e,t){null===t||10===t?(p(D(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(p(D(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(h(D(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(h(D(e.output,0)),e.output=[])}}},oe={ops_table:null,mount:function(e){return oe.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(ie.isBlkdev(r)||ie.isFIFO(r))throw new ie.ErrnoError(63);oe.ops_table||(oe.ops_table={dir:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr,lookup:oe.node_ops.lookup,mknod:oe.node_ops.mknod,rename:oe.node_ops.rename,unlink:oe.node_ops.unlink,rmdir:oe.node_ops.rmdir,readdir:oe.node_ops.readdir,symlink:oe.node_ops.symlink},stream:{llseek:oe.stream_ops.llseek}},file:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr},stream:{llseek:oe.stream_ops.llseek,read:oe.stream_ops.read,write:oe.stream_ops.write,allocate:oe.stream_ops.allocate,mmap:oe.stream_ops.mmap,msync:oe.stream_ops.msync}},link:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr,readlink:oe.node_ops.readlink},stream:{}},chrdev:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr},stream:ie.chrdev_stream_ops}});var o=ie.createNode(e,t,r,n);return ie.isDir(o.mode)?(o.node_ops=oe.ops_table.dir.node,o.stream_ops=oe.ops_table.dir.stream,o.contents={}):ie.isFile(o.mode)?(o.node_ops=oe.ops_table.file.node,o.stream_ops=oe.ops_table.file.stream,o.usedBytes=0,o.contents=null):ie.isLink(o.mode)?(o.node_ops=oe.ops_table.link.node,o.stream_ops=oe.ops_table.link.stream):ie.isChrdev(o.mode)&&(o.node_ops=oe.ops_table.chrdev.node,o.stream_ops=oe.ops_table.chrdev.stream),o.timestamp=Date.now(),e&&(e.contents[t]=o),o},getFileDataAsRegularArray:function(e){if(e.contents&&e.contents.subarray){for(var t=[],r=0;r<e.usedBytes;++r)t.push(e.contents[r]);return t}return e.contents},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t){if(0==t)return e.contents=null,void(e.usedBytes=0);if(!e.contents||e.contents.subarray){var r=e.contents;return e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),void(e.usedBytes=t)}if(e.contents||(e.contents=[]),e.contents.length>t)e.contents.length=t;else for(;e.contents.length<t;)e.contents.push(0);e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=ie.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,ie.isDir(e.mode)?t.size=4096:ie.isFile(e.mode)?t.size=e.usedBytes:ie.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&oe.resizeFileStorage(e,t.size)},lookup:function(e,t){throw ie.genericErrors[44]},mknod:function(e,t,r,n){return oe.createNode(e,t,r,n)},rename:function(e,t,r){if(ie.isDir(e.mode)){var n;try{n=ie.lookupNode(t,r)}catch(e){}if(n)for(var o in n.contents)throw new ie.ErrnoError(55)}delete e.parent.contents[e.name],e.name=r,t.contents[r]=e,e.parent=t},unlink:function(e,t){delete e.contents[t]},rmdir:function(e,t){var r=ie.lookupNode(e,t);for(var n in r.contents)throw new ie.ErrnoError(55);delete e.contents[t]},readdir:function(e){var t=[".",".."];for(var r in e.contents)e.contents.hasOwnProperty(r)&&t.push(r);return t},symlink:function(e,t,r){var n=oe.createNode(e,t,41471,0);return n.link=r,n},readlink:function(e){if(!ie.isLink(e.mode))throw new ie.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,r,n,o){var i=e.node.contents;if(o>=e.node.usedBytes)return 0;var a=Math.min(e.node.usedBytes-o,n);if(a>8&&i.subarray)t.set(i.subarray(o,o+a),r);else for(var s=0;s<a;s++)t[r+s]=i[o+s];return a},write:function(e,t,r,n,o,i){if(t.buffer===g.buffer&&(i=!1),!n)return 0;var a=e.node;if(a.timestamp=Date.now(),t.subarray&&(!a.contents||a.contents.subarray)){if(i)return a.contents=t.subarray(r,r+n),a.usedBytes=n,n;if(0===a.usedBytes&&0===o)return a.contents=t.slice(r,r+n),a.usedBytes=n,n;if(o+n<=a.usedBytes)return a.contents.set(t.subarray(r,r+n),o),n}if(oe.expandFileStorage(a,o+n),a.contents.subarray&&t.subarray)a.contents.set(t.subarray(r,r+n),o);else for(var s=0;s<n;s++)a.contents[o+s]=t[r+s];return a.usedBytes=Math.max(a.usedBytes,o+n),n},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&ie.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new ie.ErrnoError(28);return n},allocate:function(e,t,r){oe.expandFileStorage(e.node,t+r),e.node.usedBytes=Math.max(e.node.usedBytes,t+r)},mmap:function(e,t,r,n,o,i){var a,s,u;if(0===t||X("Assertion failed: "+a),!ie.isFile(e.node.mode))throw new ie.ErrnoError(43);var l=e.node.contents;if(2&i||l.buffer!==m){if((n>0||n+r<l.length)&&(l=l.subarray?l.subarray(n,n+r):Array.prototype.slice.call(l,n,n+r)),u=!0,!(s=ie.mmapAlloc(r)))throw new ie.ErrnoError(48);g.set(l,s)}else u=!1,s=l.byteOffset;return{ptr:s,allocated:u}},msync:function(e,t,r,n,o){if(!ie.isFile(e.node.mode))throw new ie.ErrnoError(43);return 2&o||oe.stream_ops.write(e,t,0,n,r,!1),0}}},ie={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,handleFSError:function(e){if(!(e instanceof ie.ErrnoError))throw e+" : "+Z();return ee(e.errno)},lookupPath:function(e,t){if(t=t||{},!(e=re.resolve(ie.cwd(),e)))return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===t[n]&&(t[n]=r[n]);if(t.recurse_count>8)throw new ie.ErrnoError(32);for(var o=te.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),i=ie.root,a="/",s=0;s<o.length;s++){var u=s===o.length-1;if(u&&t.parent)break;if(i=ie.lookupNode(i,o[s]),a=te.join2(a,o[s]),ie.isMountpoint(i)&&(!u||u&&t.follow_mount)&&(i=i.mounted.root),!u||t.follow)for(var l=0;ie.isLink(i.mode);){var c=ie.readlink(a);if(a=re.resolve(te.dirname(a),c),i=ie.lookupPath(a,{recurse_count:t.recurse_count}).node,l++>40)throw new ie.ErrnoError(32)}}return{path:a,node:i}},getPath:function(e){for(var t;;){if(ie.isRoot(e)){var r=e.mount.mountpoint;return t?"/"!==r[r.length-1]?r+"/"+t:r+t:r}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%ie.nameTable.length},hashAddNode:function(e){var t=ie.hashName(e.parent.id,e.name);e.name_next=ie.nameTable[t],ie.nameTable[t]=e},hashRemoveNode:function(e){var t=ie.hashName(e.parent.id,e.name);if(ie.nameTable[t]===e)ie.nameTable[t]=e.name_next;else for(var r=ie.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode:function(e,t){var r=ie.mayLookup(e);if(r)throw new ie.ErrnoError(r,e);for(var n=ie.hashName(e.id,t),o=ie.nameTable[n];o;o=o.name_next){var i=o.name;if(o.parent.id===e.id&&i===t)return o}return ie.lookup(e,t)},createNode:function(e,t,r,n){var o=new ie.FSNode(e,t,r,n);return ie.hashAddNode(o),o},destroyNode:function(e){ie.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218},modeStringToFlags:function(e){var t=ie.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return ie.ignorePermissions||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:2},mayLookup:function(e){var t=ie.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return ie.lookupNode(e,t),20}catch(e){}return ie.nodePermissions(e,"wx")},mayDelete:function(e,t,r){var n;try{n=ie.lookupNode(e,t)}catch(e){return e.errno}var o=ie.nodePermissions(e,"wx");if(o)return o;if(r){if(!ie.isDir(n.mode))return 54;if(ie.isRoot(n)||ie.getPath(n)===ie.cwd())return 10}else if(ie.isDir(n.mode))return 31;return 0},mayOpen:function(e,t){return e?ie.isLink(e.mode)?32:ie.isDir(e.mode)&&("r"!==ie.flagsToPermissionString(t)||512&t)?31:ie.nodePermissions(e,ie.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||ie.MAX_OPEN_FDS;for(var r=e;r<=t;r++)if(!ie.streams[r])return r;throw new ie.ErrnoError(33)},getStream:function(e){return ie.streams[e]},createStream:function(e,t,r){ie.FSStream||(ie.FSStream=function(){},ie.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var n=new ie.FSStream;for(var o in e)n[o]=e[o];e=n;var i=ie.nextfd(t,r);return e.fd=i,ie.streams[i]=e,e},closeStream:function(e){ie.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=ie.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new ie.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){ie.devices[e]={stream_ops:t}},getDevice:function(e){return ie.devices[e]},getMounts:function(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push.apply(r,n.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),ie.syncFSRequests++,ie.syncFSRequests>1&&h("warning: "+ie.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=ie.getMounts(ie.root.mount),n=0;function o(e){return ie.syncFSRequests--,t(e)}function i(e){if(e)return i.errored?void 0:(i.errored=!0,o(e));++n>=r.length&&o(null)}r.forEach((function(t){if(!t.type.syncfs)return i(null);t.type.syncfs(t,e,i)}))},mount:function(e,t,r){var n,o="/"===r,i=!r;if(o&&ie.root)throw new ie.ErrnoError(10);if(!o&&!i){var a=ie.lookupPath(r,{follow_mount:!1});if(r=a.path,n=a.node,ie.isMountpoint(n))throw new ie.ErrnoError(10);if(!ie.isDir(n.mode))throw new ie.ErrnoError(54)}var s={type:e,opts:t,mountpoint:r,mounts:[]},u=e.mount(s);return u.mount=s,s.root=u,o?ie.root=u:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),u},unmount:function(e){var t=ie.lookupPath(e,{follow_mount:!1});if(!ie.isMountpoint(t.node))throw new ie.ErrnoError(28);var r=t.node,n=r.mounted,o=ie.getMounts(n);Object.keys(ie.nameTable).forEach((function(e){for(var t=ie.nameTable[e];t;){var r=t.name_next;-1!==o.indexOf(t.mount)&&ie.destroyNode(t),t=r}})),r.mounted=null;var i=r.mount.mounts.indexOf(n);r.mount.mounts.splice(i,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,r){var n=ie.lookupPath(e,{parent:!0}).node,o=te.basename(e);if(!o||"."===o||".."===o)throw new ie.ErrnoError(28);var i=ie.mayCreate(n,o);if(i)throw new ie.ErrnoError(i);if(!n.node_ops.mknod)throw new ie.ErrnoError(63);return n.node_ops.mknod(n,o,t,r)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,ie.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,ie.mknod(e,t,0)},mkdirTree:function(e,t){for(var r=e.split("/"),n="",o=0;o<r.length;++o)if(r[o]){n+="/"+r[o];try{ie.mkdir(n,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,r){return void 0===r&&(r=t,t=438),t|=8192,ie.mknod(e,t,r)},symlink:function(e,t){if(!re.resolve(e))throw new ie.ErrnoError(44);var r=ie.lookupPath(t,{parent:!0}).node;if(!r)throw new ie.ErrnoError(44);var n=te.basename(t),o=ie.mayCreate(r,n);if(o)throw new ie.ErrnoError(o);if(!r.node_ops.symlink)throw new ie.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename:function(e,t){var r,n,o=te.dirname(e),i=te.dirname(t),a=te.basename(e),s=te.basename(t);try{r=ie.lookupPath(e,{parent:!0}).node,n=ie.lookupPath(t,{parent:!0}).node}catch(e){throw new ie.ErrnoError(10)}if(!r||!n)throw new ie.ErrnoError(44);if(r.mount!==n.mount)throw new ie.ErrnoError(75);var u,l=ie.lookupNode(r,a),c=re.relative(e,i);if("."!==c.charAt(0))throw new ie.ErrnoError(28);if("."!==(c=re.relative(t,o)).charAt(0))throw new ie.ErrnoError(55);try{u=ie.lookupNode(n,s)}catch(e){}if(l!==u){var d=ie.isDir(l.mode),_=ie.mayDelete(r,a,d);if(_)throw new ie.ErrnoError(_);if(_=u?ie.mayDelete(n,s,d):ie.mayCreate(n,s))throw new ie.ErrnoError(_);if(!r.node_ops.rename)throw new ie.ErrnoError(63);if(ie.isMountpoint(l)||u&&ie.isMountpoint(u))throw new ie.ErrnoError(10);if(n!==r&&(_=ie.nodePermissions(r,"w")))throw new ie.ErrnoError(_);try{ie.trackingDelegate.willMovePath&&ie.trackingDelegate.willMovePath(e,t)}catch(r){h("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+r.message)}ie.hashRemoveNode(l);try{r.node_ops.rename(l,n,s)}catch(e){throw e}finally{ie.hashAddNode(l)}try{ie.trackingDelegate.onMovePath&&ie.trackingDelegate.onMovePath(e,t)}catch(r){h("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+r.message)}}},rmdir:function(e){var t=ie.lookupPath(e,{parent:!0}).node,r=te.basename(e),n=ie.lookupNode(t,r),o=ie.mayDelete(t,r,!0);if(o)throw new ie.ErrnoError(o);if(!t.node_ops.rmdir)throw new ie.ErrnoError(63);if(ie.isMountpoint(n))throw new ie.ErrnoError(10);try{ie.trackingDelegate.willDeletePath&&ie.trackingDelegate.willDeletePath(e)}catch(t){h("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,r),ie.destroyNode(n);try{ie.trackingDelegate.onDeletePath&&ie.trackingDelegate.onDeletePath(e)}catch(t){h("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=ie.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new ie.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=ie.lookupPath(e,{parent:!0}).node,r=te.basename(e),n=ie.lookupNode(t,r),o=ie.mayDelete(t,r,!1);if(o)throw new ie.ErrnoError(o);if(!t.node_ops.unlink)throw new ie.ErrnoError(63);if(ie.isMountpoint(n))throw new ie.ErrnoError(10);try{ie.trackingDelegate.willDeletePath&&ie.trackingDelegate.willDeletePath(e)}catch(t){h("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,r),ie.destroyNode(n);try{ie.trackingDelegate.onDeletePath&&ie.trackingDelegate.onDeletePath(e)}catch(t){h("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=ie.lookupPath(e).node;if(!t)throw new ie.ErrnoError(44);if(!t.node_ops.readlink)throw new ie.ErrnoError(28);return re.resolve(ie.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var r=ie.lookupPath(e,{follow:!t}).node;if(!r)throw new ie.ErrnoError(44);if(!r.node_ops.getattr)throw new ie.ErrnoError(63);return r.node_ops.getattr(r)},lstat:function(e){return ie.stat(e,!0)},chmod:function(e,t,r){var n;if(!(n="string"==typeof e?ie.lookupPath(e,{follow:!r}).node:e).node_ops.setattr)throw new ie.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})},lchmod:function(e,t){ie.chmod(e,t,!0)},fchmod:function(e,t){var r=ie.getStream(e);if(!r)throw new ie.ErrnoError(8);ie.chmod(r.node,t)},chown:function(e,t,r,n){var o;if(!(o="string"==typeof e?ie.lookupPath(e,{follow:!n}).node:e).node_ops.setattr)throw new ie.ErrnoError(63);o.node_ops.setattr(o,{timestamp:Date.now()})},lchown:function(e,t,r){ie.chown(e,t,r,!0)},fchown:function(e,t,r){var n=ie.getStream(e);if(!n)throw new ie.ErrnoError(8);ie.chown(n.node,t,r)},truncate:function(e,t){if(t<0)throw new ie.ErrnoError(28);var r;if(!(r="string"==typeof e?ie.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new ie.ErrnoError(63);if(ie.isDir(r.mode))throw new ie.ErrnoError(31);if(!ie.isFile(r.mode))throw new ie.ErrnoError(28);var n=ie.nodePermissions(r,"w");if(n)throw new ie.ErrnoError(n);r.node_ops.setattr(r,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var r=ie.getStream(e);if(!r)throw new ie.ErrnoError(8);if(0==(2097155&r.flags))throw new ie.ErrnoError(28);ie.truncate(r.node,t)},utime:function(e,t,r){var n=ie.lookupPath(e,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(t,r)})},open:function(e,t,r,o,i){if(""===e)throw new ie.ErrnoError(44);var a;if(r=void 0===r?438:r,r=64&(t="string"==typeof t?ie.modeStringToFlags(t):t)?4095&r|32768:0,"object"==typeof e)a=e;else{e=te.normalize(e);try{a=ie.lookupPath(e,{follow:!(131072&t)}).node}catch(e){}}var s=!1;if(64&t)if(a){if(128&t)throw new ie.ErrnoError(20)}else a=ie.mknod(e,r,0),s=!0;if(!a)throw new ie.ErrnoError(44);if(ie.isChrdev(a.mode)&&(t&=-513),65536&t&&!ie.isDir(a.mode))throw new ie.ErrnoError(54);if(!s){var u=ie.mayOpen(a,t);if(u)throw new ie.ErrnoError(u)}512&t&&ie.truncate(a,0),t&=-131713;var l=ie.createStream({node:a,path:ie.getPath(a),flags:t,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1},o,i);l.stream_ops.open&&l.stream_ops.open(l),!n.logReadFiles||1&t||(ie.readFiles||(ie.readFiles={}),e in ie.readFiles||(ie.readFiles[e]=1,h("FS.trackingDelegate error on read file: "+e)));try{if(ie.trackingDelegate.onOpenFile){var c=0;1!=(2097155&t)&&(c|=ie.tracking.openFlags.READ),0!=(2097155&t)&&(c|=ie.tracking.openFlags.WRITE),ie.trackingDelegate.onOpenFile(e,c)}}catch(t){h("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return l},close:function(e){if(ie.isClosed(e))throw new ie.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{ie.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,r){if(ie.isClosed(e))throw new ie.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new ie.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new ie.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read:function(e,t,r,n,o){if(n<0||o<0)throw new ie.ErrnoError(28);if(ie.isClosed(e))throw new ie.ErrnoError(8);if(1==(2097155&e.flags))throw new ie.ErrnoError(8);if(ie.isDir(e.node.mode))throw new ie.ErrnoError(31);if(!e.stream_ops.read)throw new ie.ErrnoError(28);var i=void 0!==o;if(i){if(!e.seekable)throw new ie.ErrnoError(70)}else o=e.position;var a=e.stream_ops.read(e,t,r,n,o);return i||(e.position+=a),a},write:function(e,t,r,n,o,i){if(n<0||o<0)throw new ie.ErrnoError(28);if(ie.isClosed(e))throw new ie.ErrnoError(8);if(0==(2097155&e.flags))throw new ie.ErrnoError(8);if(ie.isDir(e.node.mode))throw new ie.ErrnoError(31);if(!e.stream_ops.write)throw new ie.ErrnoError(28);e.seekable&&1024&e.flags&&ie.llseek(e,0,2);var a=void 0!==o;if(a){if(!e.seekable)throw new ie.ErrnoError(70)}else o=e.position;var s=e.stream_ops.write(e,t,r,n,o,i);a||(e.position+=s);try{e.path&&ie.trackingDelegate.onWriteToFile&&ie.trackingDelegate.onWriteToFile(e.path)}catch(t){h("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return s},allocate:function(e,t,r){if(ie.isClosed(e))throw new ie.ErrnoError(8);if(t<0||r<=0)throw new ie.ErrnoError(28);if(0==(2097155&e.flags))throw new ie.ErrnoError(8);if(!ie.isFile(e.node.mode)&&!ie.isDir(e.node.mode))throw new ie.ErrnoError(43);if(!e.stream_ops.allocate)throw new ie.ErrnoError(138);e.stream_ops.allocate(e,t,r)},mmap:function(e,t,r,n,o,i){if(0!=(2&o)&&0==(2&i)&&2!=(2097155&e.flags))throw new ie.ErrnoError(2);if(1==(2097155&e.flags))throw new ie.ErrnoError(2);if(!e.stream_ops.mmap)throw new ie.ErrnoError(43);return e.stream_ops.mmap(e,t,r,n,o,i)},msync:function(e,t,r,n,o){return e&&e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,o):0},munmap:function(e){return 0},ioctl:function(e,t,r){if(!e.stream_ops.ioctl)throw new ie.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile:function(e,t){if((t=t||{}).flags=t.flags||"r",t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var r,n=ie.open(e,t.flags),o=ie.stat(e).size,i=new Uint8Array(o);return ie.read(n,i,0,o,0),"utf8"===t.encoding?r=D(i,0):"binary"===t.encoding&&(r=i),ie.close(n),r},writeFile:function(e,t,r){(r=r||{}).flags=r.flags||"w";var n=ie.open(e,r.flags,r.mode);if("string"==typeof t){var o=new Uint8Array(P(t)+1),i=F(t,o,0,o.length);ie.write(n,o,0,i,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");ie.write(n,t,0,t.byteLength,void 0,r.canOwn)}ie.close(n)},cwd:function(){return ie.currentPath},chdir:function(e){var t=ie.lookupPath(e,{follow:!0});if(null===t.node)throw new ie.ErrnoError(44);if(!ie.isDir(t.node.mode))throw new ie.ErrnoError(54);var r=ie.nodePermissions(t.node,"x");if(r)throw new ie.ErrnoError(r);ie.currentPath=t.path},createDefaultDirectories:function(){ie.mkdir("/tmp"),ie.mkdir("/home"),ie.mkdir("/home/web_user")},createDefaultDevices:function(){var e;if(ie.mkdir("/dev"),ie.registerDevice(ie.makedev(1,3),{read:function(){return 0},write:function(e,t,r,n,o){return n}}),ie.mkdev("/dev/null",ie.makedev(1,3)),ne.register(ie.makedev(5,0),ne.default_tty_ops),ne.register(ie.makedev(6,0),ne.default_tty1_ops),ie.mkdev("/dev/tty",ie.makedev(5,0)),ie.mkdev("/dev/tty1",ie.makedev(6,0)),"object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);e=function(){return crypto.getRandomValues(t),t[0]}}e||(e=function(){X("random_device")}),ie.createDevice("/dev","random",e),ie.createDevice("/dev","urandom",e),ie.mkdir("/dev/shm"),ie.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){ie.mkdir("/proc"),ie.mkdir("/proc/self"),ie.mkdir("/proc/self/fd"),ie.mount({mount:function(){var e=ie.createNode("/proc/self","fd",16895,73);return e.node_ops={lookup:function(e,t){var r=+t,n=ie.getStream(r);if(!n)throw new ie.ErrnoError(8);var o={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return n.path}}};return o.parent=o,o}},e}},{},"/proc/self/fd")},createStandardStreams:function(){n.stdin?ie.createDevice("/dev","stdin",n.stdin):ie.symlink("/dev/tty","/dev/stdin"),n.stdout?ie.createDevice("/dev","stdout",null,n.stdout):ie.symlink("/dev/tty","/dev/stdout"),n.stderr?ie.createDevice("/dev","stderr",null,n.stderr):ie.symlink("/dev/tty1","/dev/stderr"),ie.open("/dev/stdin","r"),ie.open("/dev/stdout","w"),ie.open("/dev/stderr","w")},ensureErrnoError:function(){ie.ErrnoError||(ie.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},ie.ErrnoError.prototype=new Error,ie.ErrnoError.prototype.constructor=ie.ErrnoError,[44].forEach((function(e){ie.genericErrors[e]=new ie.ErrnoError(e),ie.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){ie.ensureErrnoError(),ie.nameTable=new Array(4096),ie.mount(oe,{},"/"),ie.createDefaultDirectories(),ie.createDefaultDevices(),ie.createSpecialDirectories(),ie.filesystems={MEMFS:oe}},init:function(e,t,r){ie.init.initialized=!0,ie.ensureErrnoError(),n.stdin=e||n.stdin,n.stdout=t||n.stdout,n.stderr=r||n.stderr,ie.createStandardStreams()},quit:function(){ie.init.initialized=!1;var e=n._fflush;e&&e(0);for(var t=0;t<ie.streams.length;t++){var r=ie.streams[t];r&&ie.close(r)}},getMode:function(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r},joinPath:function(e,t){var r=te.join.apply(null,e);return t&&"/"==r[0]&&(r=r.substr(1)),r},absolutePath:function(e,t){return re.resolve(t,e)},standardizePath:function(e){return te.normalize(e)},findObject:function(e,t){var r=ie.analyzePath(e,t);return r.exists?r.object:(ee(r.error),null)},analyzePath:function(e,t){try{e=(n=ie.lookupPath(e,{follow:!t})).path}catch(e){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=ie.lookupPath(e,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=te.basename(e),n=ie.lookupPath(e,{follow:!t}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot="/"===n.path}catch(e){r.error=e.errno}return r},createFolder:function(e,t,r,n){var o=te.join2("string"==typeof e?e:ie.getPath(e),t),i=ie.getMode(r,n);return ie.mkdir(o,i)},createPath:function(e,t,r,n){e="string"==typeof e?e:ie.getPath(e);for(var o=t.split("/").reverse();o.length;){var i=o.pop();if(i){var a=te.join2(e,i);try{ie.mkdir(a)}catch(e){}e=a}}return a},createFile:function(e,t,r,n,o){var i=te.join2("string"==typeof e?e:ie.getPath(e),t),a=ie.getMode(n,o);return ie.create(i,a)},createDataFile:function(e,t,r,n,o,i){var a=t?te.join2("string"==typeof e?e:ie.getPath(e),t):e,s=ie.getMode(n,o),u=ie.create(a,s);if(r){if("string"==typeof r){for(var l=new Array(r.length),c=0,d=r.length;c<d;++c)l[c]=r.charCodeAt(c);r=l}ie.chmod(u,146|s);var _=ie.open(u,"w");ie.write(_,r,0,r.length,0,i),ie.close(_),ie.chmod(u,s)}return u},createDevice:function(e,t,r,n){var o=te.join2("string"==typeof e?e:ie.getPath(e),t),i=ie.getMode(!!r,!!n);ie.createDevice.major||(ie.createDevice.major=64);var a=ie.makedev(ie.createDevice.major++,0);return ie.registerDevice(a,{open:function(e){e.seekable=!1},close:function(e){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,t,n,o,i){for(var a=0,s=0;s<o;s++){var u;try{u=r()}catch(e){throw new ie.ErrnoError(29)}if(void 0===u&&0===a)throw new ie.ErrnoError(6);if(null==u)break;a++,t[n+s]=u}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,r,o,i){for(var a=0;a<o;a++)try{n(t[r+a])}catch(e){throw new ie.ErrnoError(29)}return o&&(e.node.timestamp=Date.now()),a}}),ie.mkdev(o,i,a)},createLink:function(e,t,r,n,o){var i=te.join2("string"==typeof e?e:ie.getPath(e),t);return ie.symlink(r,i)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;var t=!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!u)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=le(u(e.url),!0),e.usedBytes=e.contents.length}catch(e){t=!1}return t||ee(29),t},createLazyFile:function(e,t,r,n,o){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}},i.prototype.setDataGetter=function(e){this.getter=e},i.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",r,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+r+". Status: "+e.status);var t,n=Number(e.getResponseHeader("Content-length")),o=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,i=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,a=1048576;o||(a=n);var s=this;s.setDataGetter((function(e){var t=e*a,o=(e+1)*a-1;if(o=Math.min(o,n-1),void 0===s.chunks[e]&&(s.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>n-1)throw new Error("only "+n+" bytes available! programmer error!");var o=new XMLHttpRequest;if(o.open("GET",r,!1),n!==a&&o.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(o.responseType="arraybuffer"),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.send(null),!(o.status>=200&&o.status<300||304===o.status))throw new Error("Couldn't load "+r+". Status: "+o.status);return void 0!==o.response?new Uint8Array(o.response||[]):le(o.responseText||"",!0)}(t,o)),void 0===s.chunks[e])throw new Error("doXHR failed!");return s.chunks[e]})),!i&&n||(a=n=1,n=this.getter(0).length,a=n,p("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a={isDevice:!1,url:r},s=ie.createFile(e,t,a,n,o);a.contents?s.contents=a.contents:a.url&&(s.contents=null,s.url=a.url),Object.defineProperties(s,{usedBytes:{get:function(){return this.contents.length}}});var u={};return Object.keys(s.stream_ops).forEach((function(e){var t=s.stream_ops[e];u[e]=function(){if(!ie.forceLoadFile(s))throw new ie.ErrnoError(29);return t.apply(null,arguments)}})),u.read=function(e,t,r,n,o){if(!ie.forceLoadFile(s))throw new ie.ErrnoError(29);var i=e.node.contents;if(o>=i.length)return 0;var a=Math.min(i.length-o,n);if(i.slice)for(var u=0;u<a;u++)t[r+u]=i[o+u];else for(u=0;u<a;u++)t[r+u]=i.get(o+u);return a},s.stream_ops=u,s},createPreloadedFile:function(e,t,r,o,i,a,s,u,l,c){Browser.init();var d=t?re.resolve(te.join2(e,t)):e;function _(r){function _(r){c&&c(),u||ie.createDataFile(e,t,r,o,i,l),a&&a(),G()}var f=!1;n.preloadPlugins.forEach((function(e){f||e.canHandle(d)&&(e.handle(r,d,_,(function(){s&&s(),G()})),f=!0)})),f||_(r)}q(),"string"==typeof r?Browser.asyncLoad(r,(function(e){_(e)}),s):_(r)},indexedDB:function(){return e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB},DB_NAME:function(){return"EM_FS_"+e.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=ie.indexedDB();try{var o=n.open(ie.DB_NAME(),ie.DB_VERSION)}catch(e){return r(e)}o.onupgradeneeded=function(){p("creating db"),o.result.createObjectStore(ie.DB_STORE_NAME)},o.onsuccess=function(){var n=o.result.transaction([ie.DB_STORE_NAME],"readwrite"),i=n.objectStore(ie.DB_STORE_NAME),a=0,s=0,u=e.length;function l(){0==s?t():r()}e.forEach((function(e){var t=i.put(ie.analyzePath(e).object.contents,e);t.onsuccess=function(){++a+s==u&&l()},t.onerror=function(){s++,a+s==u&&l()}})),n.onerror=r},o.onerror=r},loadFilesFromDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=ie.indexedDB();try{var o=n.open(ie.DB_NAME(),ie.DB_VERSION)}catch(e){return r(e)}o.onupgradeneeded=r,o.onsuccess=function(){var n=o.result;try{var i=n.transaction([ie.DB_STORE_NAME],"readonly")}catch(e){return void r(e)}var a=i.objectStore(ie.DB_STORE_NAME),s=0,u=0,l=e.length;function c(){0==u?t():r()}e.forEach((function(e){var t=a.get(e);t.onsuccess=function(){ie.analyzePath(e).exists&&ie.unlink(e),ie.createDataFile(te.dirname(e),te.basename(e),t.result,!0,!0,!0),++s+u==l&&c()},t.onerror=function(){u++,s+u==l&&c()}})),i.onerror=r},o.onerror=r},mmapAlloc:function(e){for(var t=function(e,t){return t||(t=16),Math.ceil(e/t)*t}(e,16384),r=fe(t);e<t;)g[r+e++]=0;return r}},ae={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t){if("/"!==t[0]){var r;if(-100===e)r=ie.cwd();else{var n=ie.getStream(e);if(!n)throw new ie.ErrnoError(8);r=n.path}t=te.join2(r,t)}return t},doStat:function(e,t,r){try{var n=e(t)}catch(e){if(e&&e.node&&te.normalize(t)!==te.normalize(ie.getPath(e.node)))return-54;throw e}return y[r>>2]=n.dev,y[r+4>>2]=0,y[r+8>>2]=n.ino,y[r+12>>2]=n.mode,y[r+16>>2]=n.nlink,y[r+20>>2]=n.uid,y[r+24>>2]=n.gid,y[r+28>>2]=n.rdev,y[r+32>>2]=0,Y=[n.size>>>0,($=n.size,+O($)>=1?$>0?(0|U(+H($/4294967296),4294967295))>>>0:~~+z(($-+(~~$>>>0))/4294967296)>>>0:0)],y[r+40>>2]=Y[0],y[r+44>>2]=Y[1],y[r+48>>2]=4096,y[r+52>>2]=n.blocks,y[r+56>>2]=n.atime.getTime()/1e3|0,y[r+60>>2]=0,y[r+64>>2]=n.mtime.getTime()/1e3|0,y[r+68>>2]=0,y[r+72>>2]=n.ctime.getTime()/1e3|0,y[r+76>>2]=0,Y=[n.ino>>>0,($=n.ino,+O($)>=1?$>0?(0|U(+H($/4294967296),4294967295))>>>0:~~+z(($-+(~~$>>>0))/4294967296)>>>0:0)],y[r+80>>2]=Y[0],y[r+84>>2]=Y[1],0},doMsync:function(e,t,r,n,o){var i=w.slice(e,e+r);ie.msync(t,i,o,r,n)},doMkdir:function(e,t){return"/"===(e=te.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),ie.mkdir(e,t,0),0},doMknod:function(e,t,r){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return ie.mknod(e,t,r),0},doReadlink:function(e,t,r){if(r<=0)return-28;var n=ie.readlink(e),o=Math.min(r,P(n)),i=g[t+o];return F(n,w,t,r+1),g[t+o]=i,o},doAccess:function(e,t){if(-8&t)return-28;var r;if(!(r=ie.lookupPath(e,{follow:!0}).node))return-44;var n="";return 4&t&&(n+="r"),2&t&&(n+="w"),1&t&&(n+="x"),n&&ie.nodePermissions(r,n)?-2:0},doDup:function(e,t,r){var n=ie.getStream(r);return n&&ie.close(n),ie.open(e,t,0,r,r).fd},doReadv:function(e,t,r,n){for(var o=0,i=0;i<r;i++){var a=y[t+8*i>>2],s=y[t+(8*i+4)>>2],u=ie.read(e,g,a,s,n);if(u<0)return-1;if(o+=u,u<s)break}return o},doWritev:function(e,t,r,n){for(var o=0,i=0;i<r;i++){var a=y[t+8*i>>2],s=y[t+(8*i+4)>>2],u=ie.write(e,g,a,s,n);if(u<0)return-1;o+=u}return o},varargs:void 0,get:function(){return ae.varargs+=4,y[ae.varargs-4>>2]},getStr:function(e){return S(e)},getStreamFromFD:function(e){var t=ie.getStream(e);if(!t)throw new ie.ErrnoError(8);return t},get64:function(e,t){return e}};function se(e){try{return f.grow(e-m.byteLength+65535>>>16),T(f.buffer),1}catch(e){}}var ue=function(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=ie.nextInode++,this.name=t,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n};function le(e,t,r){var n=r>0?r:P(e)+1,o=new Array(n),i=F(e,o,0,o.length);return t&&(o.length=i),o}Object.defineProperties(ue.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return ie.isDir(this.mode)}},isDevice:{get:function(){return ie.isChrdev(this.mode)}}}),ie.FSNode=ue,ie.staticInit(),n.FS_createFolder=ie.createFolder,n.FS_createPath=ie.createPath,n.FS_createDataFile=ie.createDataFile,n.FS_createPreloadedFile=ie.createPreloadedFile,n.FS_createLazyFile=ie.createLazyFile,n.FS_createLink=ie.createLink,n.FS_createDevice=ie.createDevice,n.FS_unlink=ie.unlink;var ce,de={c:function(e,t,r){ae.varargs=r;try{var n=ae.getStreamFromFD(e);switch(t){case 0:return(o=ae.get())<0?-28:ie.open(n.path,n.flags,0,o).fd;case 1:case 2:return 0;case 3:return n.flags;case 4:var o=ae.get();return n.flags|=o,0;case 12:return o=ae.get(),v[o+0>>1]=2,0;case 13:case 14:return 0;case 16:case 8:return-28;case 9:return ee(28),-1;default:return-28}}catch(e){return void 0!==ie&&e instanceof ie.ErrnoError||X(e),-e.errno}},h:function(e,t,r){ae.varargs=r;try{var n=ae.getStreamFromFD(e);switch(t){case 21509:case 21505:return n.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return n.tty?0:-59;case 21519:if(!n.tty)return-59;var o=ae.get();return y[o>>2]=0,0;case 21520:return n.tty?-28:-59;case 21531:return o=ae.get(),ie.ioctl(n,t,o);case 21523:case 21524:return n.tty?0:-59;default:X("bad ioctl syscall "+t)}}catch(e){return void 0!==ie&&e instanceof ie.ErrnoError||X(e),-e.errno}},i:function(e,t,r){ae.varargs=r;try{var n=ae.getStr(e),o=ae.get();return ie.open(n,t,o).fd}catch(e){return void 0!==ie&&e instanceof ie.ErrnoError||X(e),-e.errno}},e:function(e,t,r){w.copyWithin(e,t,t+r)},f:function(e){e>>>=0;var t=w.length;if(e>2147483648)return!1;for(var r,n,o=1;o<=4;o*=2){var i=t*(1+.2/o);if(i=Math.min(i,e+100663296),se(Math.min(2147483648,((r=Math.max(16777216,e,i))%(n=65536)>0&&(r+=n-r%n),r))))return!0}return!1},a:function(e){try{var t=ae.getStreamFromFD(e);return ie.close(t),0}catch(e){return void 0!==ie&&e instanceof ie.ErrnoError||X(e),e.errno}},g:function(e,t,r,n){try{var o=ae.getStreamFromFD(e),i=ae.doReadv(o,t,r);return y[n>>2]=i,0}catch(e){return void 0!==ie&&e instanceof ie.ErrnoError||X(e),e.errno}},d:function(e,t,r,n,o){try{var i=ae.getStreamFromFD(e),a=4294967296*r+(t>>>0);return a<=-9007199254740992||a>=9007199254740992?-61:(ie.llseek(i,a,n),Y=[i.position>>>0,($=i.position,+O($)>=1?$>0?(0|U(+H($/4294967296),4294967295))>>>0:~~+z(($-+(~~$>>>0))/4294967296)>>>0:0)],y[o>>2]=Y[0],y[o+4>>2]=Y[1],i.getdents&&0===a&&0===n&&(i.getdents=null),0)}catch(e){return void 0!==ie&&e instanceof ie.ErrnoError||X(e),e.errno}},b:function(e,t,r,n){try{var o=ae.getStreamFromFD(e),i=ae.doWritev(o,t,r);return y[n>>2]=i,0}catch(e){return void 0!==ie&&e instanceof ie.ErrnoError||X(e),e.errno}},memory:f,table:E},_e=(function(){var e={a:de};function t(e,t){var r=e.exports;n.asm=r,G()}function r(e){t(e.instance)}function o(t){return(_||"function"!=typeof fetch?new Promise((function(e,t){e(Q())})):fetch(J,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+J+"'";return e.arrayBuffer()})).catch((function(){return Q()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){h("failed to asynchronously prepare wasm: "+e),X(e)}))}if(q(),n.instantiateWasm)try{return n.instantiateWasm(e,t)}catch(e){return h("Module.instantiateWasm callback failed with error: "+e),!1}!function(){if(_||"function"!=typeof WebAssembly.instantiateStreaming||V(J)||"function"!=typeof fetch)return o(r);fetch(J,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return h("wasm streaming compile failed: "+e),h("falling back to ArrayBuffer instantiation"),o(r)}))}))}()}(),n.___wasm_call_ctors=function(){return(_e=n.___wasm_call_ctors=n.asm.j).apply(null,arguments)}),fe=n._malloc=function(){return(fe=n._malloc=n.asm.k).apply(null,arguments)},pe=(n._free=function(){return(n._free=n.asm.l).apply(null,arguments)},n._mid_song_start=function(){return(n._mid_song_start=n.asm.m).apply(null,arguments)},n._mid_song_seek=function(){return(n._mid_song_seek=n.asm.n).apply(null,arguments)},n._mid_song_get_total_time=function(){return(n._mid_song_get_total_time=n.asm.o).apply(null,arguments)},n._mid_song_get_time=function(){return(n._mid_song_get_time=n.asm.p).apply(null,arguments)},n._mid_song_read_wave=function(){return(n._mid_song_read_wave=n.asm.q).apply(null,arguments)},n._mid_istream_open_mem=function(){return(n._mid_istream_open_mem=n.asm.r).apply(null,arguments)},n._mid_istream_close=function(){return(n._mid_istream_close=n.asm.s).apply(null,arguments)},n._mid_exit=function(){return(n._mid_exit=n.asm.t).apply(null,arguments)},n._mid_init=function(){return(n._mid_init=n.asm.u).apply(null,arguments)},n._mid_song_load=function(){return(n._mid_song_load=n.asm.v).apply(null,arguments)},n._mid_song_free=function(){return(n._mid_song_free=n.asm.w).apply(null,arguments)},n._mid_alloc_options=function(){return(n._mid_alloc_options=n.asm.x).apply(null,arguments)},n._mid_get_load_request_count=function(){return(n._mid_get_load_request_count=n.asm.y).apply(null,arguments)},n._mid_get_load_request=function(){return(n._mid_get_load_request=n.asm.z).apply(null,arguments)},n.___errno_location=function(){return(pe=n.___errno_location=n.asm.A).apply(null,arguments)});function he(e){function t(){ce||(ce=!0,n.calledRun=!0,k||(N=!0,n.noFSInit||ie.init.initialized||ie.init(),ne.init(),C(R),ie.ignorePermissions=!1,C(B),o(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),L.unshift(e);var e;C(L)}()))}e=e||c,I>0||(function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),M.unshift(e);var e;C(M)}(),I>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),t()}),1)):t()))}if(n.getMemory=function(e){return N?fe(e):function(e){var t=y[A>>2],r=t+e+15&-16;return y[A>>2]=r,t}(e)},n.UTF8ToString=S,n.addRunDependency=q,n.removeRunDependency=G,n.FS_createFolder=ie.createFolder,n.FS_createPath=ie.createPath,n.FS_createDataFile=ie.createDataFile,n.FS_createPreloadedFile=ie.createPreloadedFile,n.FS_createLazyFile=ie.createLazyFile,n.FS_createLink=ie.createLink,n.FS_createDevice=ie.createDevice,n.FS_unlink=ie.unlink,n.FS=ie,W=function e(){ce||he(),ce||(W=e)},n.run=he,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return he(),t.ready};class o{constructor(t){this._options={baseUrl:"/",instruments:"/",dispatch:e=>{},...t},this._options.baseUrl.endsWith("/")||(this._options.baseUrl+="/"),this._options.baseUrl=new URL(this._options.baseUrl,e.location.origin).href,this._options.instruments=new URL(this._options.instruments,e.location.origin).href,this._ready=!1,this._destroyed=!1,this._songPtr=0,this._bufferPtr=0,this._interval=null,this._loop=!1,this._syncCallback=!1,this._reverb={},this._array=new Int16Array(32768),this._pendingFetches={},this._currentUrlOrBuf=null,this._audioContext=new r,this._playing=!1,this._node=this._audioContext.createScriptProcessor(16384,0,2),this._onAudioProcess=this._onAudioProcess.bind(this),this._node.addEventListener("audioprocess",this._onAudioProcess),this.gainNode=this._audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this._audioContext.destination),this._node.connect(this.gainNode),n({locateFile:e=>new URL(e,this._options.baseUrl).href}).then(e=>{this._lib=e,this._onLibReady()})}_onLibReady(){if(this._lib.FS.writeFile("/timidity.cfg","\ndrumset 0\n\n 25\tDrum_000/025_Snare_Roll.pat \n 26\tDrum_000/026_Snap.pat \n 27\tDrum_000/027_High_Q.pat \n 31\tDrum_000/031_Sticks.pat \n 32\tDrum_000/032_Square_Click.pat \n 33\tDrum_000/033_Metronome_Click.pat \n 34\tDrum_000/034_Metronome_Bell.pat \n 35\tDrum_000/035_Kick_1.pat amp=100\n 36\tDrum_000/036_Kick_2.pat amp=100\n 37\tDrum_000/037_Stick_Rim.pat \n 38\tDrum_000/038_Snare_1.pat \n 39\tDrum_000/039_Clap_Hand.pat amp=100\n 40\tDrum_000/040_Snare_2.pat \n 41\tDrum_000/041_Tom_Low_2.pat amp=100\n 42\tDrum_000/042_Hi-Hat_Closed.pat \n 43\tDrum_000/043_Tom_Low_1.pat amp=100\n 44\tDrum_000/044_Hi-Hat_Pedal.pat \n 45\tDrum_000/045_Tom_Mid_2.pat amp=100\n 46\tDrum_000/046_Hi-Hat_Open.pat \n 47\tDrum_000/047_Tom_Mid_1.pat amp=100\n 48\tDrum_000/048_Tom_High_2.pat amp=100\n 49\tDrum_000/049_Cymbal_Crash_1.pat \n 50\tDrum_000/050_Tom_High_1.pat amp=100\n 51\tDrum_000/051_Cymbal_Ride_1.pat \n 52\tDrum_000/052_Cymbal_Chinese.pat \n 53\tDrum_000/053_Cymbal_Ride_Bell.pat amp=100\n 54\tDrum_000/054_Tombourine.pat \n 55\tDrum_000/055_Cymbal_Splash.pat \n 56\tDrum_000/056_Cow_Bell.pat \n 57\tDrum_000/057_Cymbal_Crash_2.pat \n 58\tDrum_000/058_Vibra-Slap.pat \n 59\tDrum_000/059_Cymbal_Ride_2.pat \n 60\tDrum_000/060_Bongo_High.pat \n 61\tDrum_000/061_Bongo_Low.pat \n 62\tDrum_000/062_Conga_High_1_Mute.pat \n 63\tDrum_000/063_Conga_High_2_Open.pat \n 64\tDrum_000/064_Conga_Low.pat \n 65\tDrum_000/065_Timbale_High.pat \n 66\tDrum_000/066_Timbale_Low.pat \n 67\tDrum_000/067_Agogo_High.pat \n 68\tDrum_000/068_Agogo_Low.pat \n 69\tDrum_000/069_Cabasa.pat amp=100\n 70\tDrum_000/070_Maracas.pat \n 71\tDrum_000/071_Whistle_1_High_Short.pat \n 72\tDrum_000/072_Whistle_2_Low_Long.pat \n 73\tDrum_000/073_Guiro_1_Short.pat \n 74\tDrum_000/074_Guiro_2_Long.pat \n 75\tDrum_000/075_Claves.pat amp=100\n 76\tDrum_000/076_Wood_Block_1_High.pat \n 77\tDrum_000/077_Wood_Block_2_Low.pat \n 78\tDrum_000/078_Cuica_1_Mute.pat amp=100\n 79\tDrum_000/079_Cuica_2_Open.pat amp=100\n 80\tDrum_000/080_Triangle_1_Mute.pat \n 81\tDrum_000/081_Triangle_2_Open.pat \n 82\tDrum_000/082_Shaker.pat \n 84\tDrum_000/084_Belltree.pat \n\nbank 0\n\n 0\tTone_000/000_Acoustic_Grand_Piano.pat amp=120 pan=center\n 1\tTone_000/001_Acoustic_Brite_Piano.pat \n 2\tTone_000/002_Electric_Grand_Piano.pat \n 4\tTone_000/004_Electric_Piano_1_Rhodes.pat \n 5\tTone_000/005_Electric_Piano_2_Chorused_Yamaha_DX.pat \n 6\tTone_000/006_Harpsichord.pat \n 7\tTone_000/007_Clavinet.pat \n 8\tTone_000/008_Celesta.pat \n 9\tTone_000/009_Glockenspiel.pat \n 13\tTone_000/013_Xylophone.pat \n 14\tTone_000/014_Tubular_Bells.pat \n 15\tTone_000/015_Dulcimer.pat \n 16\tTone_000/016_Hammond_Organ.pat \n 19\tTone_000/019_Church_Organ.pat \n 21\tTone_000/021_Accordion.pat \n 23\tTone_000/023_Tango_Accordion.pat \n 24\tTone_000/024_Nylon_Guitar.pat \n 25\tTone_000/025_Steel_Guitar.pat \n 26\tTone_000/026_Jazz_Guitar.pat \n 27\tTone_000/027_Clean_Electric_Guitar.pat \n 28\tTone_000/028_Muted_Electric_Guitar.pat \n 29\tTone_000/029_Overdriven_Guitar.pat \n 30\tTone_000/030_Distortion_Guitar.pat \n 32\tTone_000/032_Acoustic_Bass.pat \n 33\tTone_000/033_Finger_Bass.pat \n 34\tTone_000/034_Pick_Bass.pat \n 35\tTone_000/035_Fretless_Bass.pat \n 36\tTone_000/036_Slap_Bass_1.pat \n 37\tTone_000/037_Slap_Bass_2.pat \n 38\tTone_000/038_Synth_Bass_1.pat \n 40\tTone_000/040_Violin.pat \n 42\tTone_000/042_Cello.pat \n 44\tTone_000/044_Tremolo_Strings.pat \n 45\tTone_000/045_Pizzicato_Strings.pat \n 46\tTone_000/046_Harp.pat \n 47\tTone_000/047_Timpani.pat \n 48\tTone_000/048_String_Ensemble_1_Marcato.pat \n 53\tTone_000/053_Voice_Oohs.pat \n 56\tTone_000/056_Trumpet.pat \n 57\tTone_000/057_Trombone.pat \n 58\tTone_000/058_Tuba.pat \n 59\tTone_000/059_Muted_Trumpet.pat \n 60\tTone_000/060_French_Horn.pat \n 61\tTone_000/061_Brass_Section.pat \n 64\tTone_000/064_Soprano_Sax.pat \n 65\tTone_000/065_Alto_Sax.pat \n 66\tTone_000/066_Tenor_Sax.pat \n 67\tTone_000/067_Baritone_Sax.pat \n 68\tTone_000/068_Oboe.pat \n 69\tTone_000/069_English_Horn.pat \n 70\tTone_000/070_Bassoon.pat \n 71\tTone_000/071_Clarinet.pat \n 72\tTone_000/072_Piccolo.pat \n 73\tTone_000/073_Flute.pat \n 74\tTone_000/074_Recorder.pat \n 75\tTone_000/075_Pan_Flute.pat \n 76\tTone_000/076_Bottle_Blow.pat \n 79\tTone_000/079_Ocarina.pat \n 80\tTone_000/080_Square_Wave.pat \n 84\tTone_000/084_Charang.pat \n 88\tTone_000/088_New_Age.pat \n 94\tTone_000/094_Halo_Pad.pat \n 95\tTone_000/095_Sweep_Pad.pat \n 98\tTone_000/098_Crystal.pat \n 101\tTone_000/101_Goblins--Unicorn.pat \n 102\tTone_000/102_Echo_Voice.pat \n 104\tTone_000/104_Sitar.pat \n 114\tTone_000/114_Steel_Drums.pat \n 115\tTone_000/115_Wood_Block.pat \n 120\tTone_000/120_Guitar_Fret_Noise.pat \n 122\tTone_000/122_Seashore.pat \n 125\tTone_000/125_Helicopter.pat \n\n"),0!==this._lib._mid_init("/timidity.cfg"))return this._destroy(new Error("Failed to initialize libmfa"));this._bufferPtr=this._lib._malloc(65536),this._ready=!0,this._onready&&this._onready(),this._options.dispatch("ready")}async load(e){if(this._destroyed)throw new Error("load() called after destroy()");if(this._songPtr&&this._destroySong(),!this._ready)return this._onready=()=>this.load(e);let t;if(this._options.dispatch("buffering"),this._currentUrlOrBuf=e,"string"==typeof e){if(t=await this._fetch(new URL("/"===e.slice(0,1)?e:this._options.baseUrl+e,this._options.baseUrl)),this._currentUrlOrBuf!==e)return}else{if(!(e instanceof Uint8Array))throw new Error("load() expects a `string` or `Uint8Array` argument");t=e}let r=this._loadSong(t),n=this._lib._mid_get_load_request_count(r);if(n>0){let o=this._getMissingInstruments(r,n);if(await Promise.all(o.map(e=>this._fetchInstrument(e))),this._currentUrlOrBuf!==e)return;this._lib._mid_song_free(r),r=this._loadSong(t),n=this._lib._mid_get_load_request_count(r),n>0&&(o=this._getMissingInstruments(r,n))}this._songPtr=r,this._lib._mid_song_start(this._songPtr)}_getMissingInstruments(e,t){let r=[];for(let n=0;n<t;n++){let t=this._lib._mid_get_load_request(e,n),o=this._lib.UTF8ToString(t);r.push(o)}return r}_loadSong(e){let t=this._lib._mid_alloc_options(this._audioContext.sampleRate||44100,32784,2,16384),r=this._lib._malloc(e.byteLength);this._lib.HEAPU8.set(e,r);let n=this._lib._mid_istream_open_mem(r,e.byteLength),o=this._lib._mid_song_load(n,t);return this._lib._mid_istream_close(n),this._lib._free(t),this._lib._free(r),0===o?this._destroy(new Error("Failed to load MIDI file")):o}async _fetchInstrument(e){if(this._pendingFetches[e])return this._pendingFetches[e];let t=new URL(e,this._options.instruments),r=this._fetch(t);this._pendingFetches[e]=r;let n=await r;return this._writeInstrumentFile(e,n),delete this._pendingFetches[e],n}_writeInstrumentFile(e,t){let r=e.split("/").slice(0,-1).join("/");this._mkdirp(r),this._lib.FS.writeFile(e,t,{encoding:"binary"})}_mkdirp(e){let t=e.split("/"),r="/";for(let e=0,n=t.length;e<n;e++){let n=t[e];try{this._lib.FS.mkdir(`${r}${n}`)}catch(e){}r+=n+"/"}}async _fetch(t,r={}){let n={...r,mode:"cors",credentials:"same-origin"},o=await e.fetch(t,n);if(200!==o.status)throw new Error("Could not load "+t);if("arrayBuffer"===r.responseType)return o;let i=await o.arrayBuffer();return new Uint8Array(i)}_onAudioProcess(e){if(!this._playing)return this._audioContext.suspend();this._syncCallback&&(this._syncCallback(),this._syncCallback=!1);let t=this._songPtr&&this._playing?this._readMidiData():0;t>0&&this._currentUrlOrBuf&&(this._currentUrlOrBuf=null,this._options.dispatch("playing"));let r=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1);for(let e=0;e<t;e++)r[e]=this._array[2*e]/32767,n[e]=this._array[2*e+1]/32767;for(let e=t;e<16384;e++)r[e]=0,n[e]=0;this._songPtr&&this._playing&&0===t&&(this.seek(0),this.pause(),this._lib._mid_song_start(this._songPtr),this._options.dispatch("ended"),this._loop&&this.play(this._loop))}_readMidiData(){let e=this._lib._mid_song_read_wave(this._songPtr,this._bufferPtr,65536),t=e/4;return 0===t?0:(this._array.set(this._lib.HEAP16.subarray(this._bufferPtr/2,(this._bufferPtr+e)/2)),t)}async reverb(e){e?(this.reverbConvolver&&(this.reverbConvolver.disconnect(0),this._node.connect(this.gainNode)),this.reverbConvolver=this._audioContext.createConvolver(),this.reverbConvolver.buffer=e,this.reverbConvolver.connect(this.gainNode),this._node.connect(this.reverbConvolver)):(this.reverbConvolver.disconnect(0),this._node.connect(this.gainNode))}play(e={}){if(e.syncCallback&&(this._syncCallback=e.syncCallback),e.volume&&(this.gainNode.gain.value=e.volume),this._destroyed)throw new Error("play() called after destroy()");this._loop=e.loop?!!e.loop:this._loop,this._playing=!0,this._audioContext.resume(),this._ready&&!this._currentUrlOrBuf&&this._options.dispatch("playing")}pause(){if(this._destroyed)throw new Error("pause() called after destroy()");this._audioContext.suspend(),this._playing=!1,this._options.dispatch("paused")}seek(e){if(this._destroyed)throw new Error("seek() called after destroy()");if(!this._songPtr)return;let t=Math.floor(1e3*e);this._lib._mid_song_seek(this._songPtr,t)}volume(e){this.gainNode.gain.value=e}get currentTime(){return this._destroyed||!this._songPtr?0:this._lib._mid_song_get_time(this._songPtr)/1e3}get duration(){return this._destroyed||!this._songPtr?1:this._lib._mid_song_get_total_time(this._songPtr)/1e3}destroy(){if(this._destroyed)throw new Error("destroy() called after destroy()");this._destroy()}_destroy(e){this._destroyed||(this._destroyed=!0,this._array=null,this._songPtr&&this._destroySong(),this._bufferPtr&&(this._lib._free(this._bufferPtr),this._bufferPtr=0),this._node&&(this._node.disconnect(),this._node.removeEventListener("audioprocess",this._onAudioProcess)),this._audioContext&&this._audioContext.close(),e&&this._options.dispatch("error",e))}_destroySong(){this._lib._mid_song_free(this._songPtr),this._songPtr=0}}e.MidiFurAlles=e.MidiFurAlles||o,t.exports=o}("undefined"!=typeof window?window:{},"undefined"!=typeof module?module:{});